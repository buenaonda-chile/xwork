<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="560" Id="main_form" Left="8" OnLoadCompleted="form_OnLoadCompleted" OnTimer="main_form_OnTimer" OnUnloadCompleted="main_form_OnUnloadCompleted" PidAttrib="7" Title="New&#32;Form" Top="8" Ver="1.0" Width="800" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_subfile">
				<Contents>
					<colinfo id="COLUMN_1" size="256" type="STRING"/>
					<colinfo id="COLUMN_2" size="256" type="STRING"/>
					<colinfo id="COLUMN_3" size="256" type="STRING"/>
					<colinfo id="COLUMN_4" size="256" type="STRING"/>
					<colinfo id="COLUMN_5" size="256" type="STRING"/>
					<colinfo id="COLUMN_6" size="256" type="STRING"/>
					<colinfo id="COLUMN_7" size="256" type="STRING"/>
					<colinfo id="COLUMN_8" size="256" type="STRING"/>
					<colinfo id="COLUMN_9" size="256" type="STRING"/>
					<colinfo id="COLUMN_10" size="256" type="STRING"/>
					<record>
						<COLUMN_1>1</COLUMN_1>
						<COLUMN_10>0</COLUMN_10>
						<COLUMN_2>2</COLUMN_2>
						<COLUMN_3>3</COLUMN_3>
						<COLUMN_4>4</COLUMN_4>
						<COLUMN_5>5</COLUMN_5>
						<COLUMN_6>6</COLUMN_6>
						<COLUMN_7>7</COLUMN_7>
						<COLUMN_8>8</COLUMN_8>
						<COLUMN_9>9</COLUMN_9>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_screen">
				<Contents>
					<colinfo id="column0" size="256" type="STRING"/>
					<colinfo id="column1" size="256" type="STRING"/>
					<record>
						<column0>1</column0>
						<column1>4</column1>
					</record>
					<record>
						<column0>2</column0>
						<column1>3</column1>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_head"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_column">
				<Contents></Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_menu">
				<Contents></Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_screenCopy"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_column_p"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_main_p"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_data">
				<Contents>
					<colinfo id="name" size="256" summ="default" type="STRING"/>
					<colinfo id="row" size="256" summ="default" type="STRING"/>
					<colinfo id="col" size="256" summ="default" type="STRING"/>
					<record>
						<col></col>
						<name>more</name>
						<row></row>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_ssoaccount"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_loginYn"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_attr"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_attr_value">
				<Contents>
					<colinfo id="id" size="256" summ="default" type="STRING"/>
					<colinfo id="bkcolor" size="256" summ="default" type="STRING"/>
					<colinfo id="color" size="256" summ="default" type="STRING"/>
					<record>
						<bkcolor></bkcolor>
						<color></color>
						<id>32</id>
					</record>
					<record>
						<bkcolor>gold</bkcolor>
						<color></color>
						<id>33</id>
					</record>
					<record>
						<bkcolor></bkcolor>
						<color>blue</color>
						<id>34</id>
					</record>
					<record>
						<bkcolor>gold</bkcolor>
						<color>blue</color>
						<id>35</id>
					</record>
					<record>
						<bkcolor></bkcolor>
						<color>default</color>
						<id>36</id>
					</record>
					<record>
						<bkcolor>gold</bkcolor>
						<color>default</color>
						<id>37</id>
					</record>
					<record>
						<bkcolor></bkcolor>
						<color>blue</color>
						<id>38</id>
					</record>
					<record>
						<bkcolor></bkcolor>
						<color></color>
						<id>39</id>
					</record>
					<record>
						<bkcolor></bkcolor>
						<color>blue</color>
						<id>40</id>
					</record>
					<record>
						<bkcolor>cyan</bkcolor>
						<color>blue</color>
						<id>41</id>
					</record>
					<record>
						<bkcolor></bkcolor>
						<color>blue</color>
						<id>42</id>
					</record>
					<record>
						<bkcolor></bkcolor>
						<color>blue</color>
						<id>43</id>
					</record>
					<record>
						<bkcolor></bkcolor>
						<color>blue</color>
						<id>44</id>
					</record>
					<record>
						<bkcolor>cyan</bkcolor>
						<color>blue</color>
						<id>45</id>
					</record>
					<record>
						<bkcolor></bkcolor>
						<color></color>
						<id>46</id>
					</record>
					<record>
						<bkcolor></bkcolor>
						<color></color>
						<id>47</id>
					</record>
					<record>
						<bkcolor></bkcolor>
						<color>blue</color>
						<id>48</id>
					</record>
					<record>
						<bkcolor>gold</bkcolor>
						<color>blue</color>
						<id>49</id>
					</record>
					<record>
						<bkcolor></bkcolor>
						<color>orange</color>
						<id>50</id>
					</record>
					<record>
						<bkcolor></bkcolor>
						<color>orange</color>
						<id>51</id>
					</record>
					<record>
						<bkcolor></bkcolor>
						<color></color>
						<id>52</id>
					</record>
					<record>
						<bkcolor></bkcolor>
						<color></color>
						<id>53</id>
					</record>
					<record>
						<bkcolor></bkcolor>
						<color>orange</color>
						<id>54</id>
					</record>
					<record>
						<bkcolor></bkcolor>
						<color>fuchia</color>
						<id>55</id>
					</record>
					<record>
						<bkcolor></bkcolor>
						<color>fuchia</color>
						<id>56</id>
					</record>
					<record>
						<bkcolor>cyan</bkcolor>
						<color>blue</color>
						<id>57</id>
					</record>
					<record>
						<bkcolor></bkcolor>
						<color>blue</color>
						<id>58</id>
					</record>
					<record>
						<bkcolor></bkcolor>
						<color></color>
						<id>59</id>
					</record>
					<record>
						<bkcolor></bkcolor>
						<color>blue</color>
						<id>60</id>
					</record>
					<record>
						<bkcolor>cyan</bkcolor>
						<color>blue</color>
						<id>61</id>
					</record>
					<record>
						<bkcolor></bkcolor>
						<color>magenta</color>
						<id>62</id>
					</record>
					<record>
						<bkcolor></bkcolor>
						<color>magenta</color>
						<id>62</id>
					</record>
					<record>
						<bkcolor>gold</bkcolor>
						<color>blue</color>
						<id>35</id>
					</record>
					<record>
						<bkcolor>gold</bkcolor>
						<color>blue</color>
						<id>33</id>
					</record>
				</Contents>
			</Dataset>
		</Datasets>
		<MAX5250 Bottom="480" Fire_Error="MAX5250_Fire_Error" Fire_Reset="MAX5250_Fire_Reset" Fire_Update="MAX5250_Fire_Update" Height="480" Id="MAX5250" Right="800" Width="800"></MAX5250>
		<Div Height="527" Id="Div5250" OnKeyDown="fnc_OnKeyDown" TabOrder="2" Text="Div0" Visible="FALSE" Width="800">
			<Contents></Contents>
		</Div>
		<Button Height="21" Id="Button0" Left="328" OnClick="Button0_OnClick" TabOrder="5" Text="로그인테스트" Top="504" Visible="FALSE" Width="104"></Button>
		<Button ButtonStyle="TRUE" Height="24" Id="Button1" ImageID="4_btn" Left="32" OnClick="Button1_OnClick" TabOrder="1" Text="변환" Top="504" Width="76"></Button>
		<Button Height="21" Id="Button2" Left="648" OnClick="common_OnClick" TabOrder="7" Text="서브파일&#32;등록" Top="504" Visible="FALSE" Width="104"></Button>
		<Button Height="21" Id="Button3" Left="539" OnClick="Button3_OnClick" TabOrder="6" Text="데이타&#32;변환" Top="504" Visible="FALSE" Width="104"></Button>
		<Button ButtonStyle="TRUE" Height="23" Id="Button4" ImageID="5_btn" Left="187" OnClick="Button4_OnClick" TabOrder="4" Text="정보재전송" Top="504" Width="88"></Button>
		<Button ButtonStyle="TRUE" Enable="FALSE" Height="24" Id="btn_change" ImageID="4_btn" Left="112" OnClick="btn_change_OnClick" TabOrder="3" Text="화면전환" Top="504" Width="76"></Button>
		<Static BKColor="BTNFACE" Border="Flat" BorderColor="BTNSHADOW" Height="26" Id="b_message" TabOrder="9" Top="531" VAlign="Middle" Width="799"></Static>
	</Form>
	<Script><![CDATA[
/*
   Max5250 메인 스크립트 
   개요 
   max5250 컴퍼넌트의 데이타를 받아 마이플랫폼으로 제작된 화면Url을 불러오고
   데이 각 화면에 마이플랫폼형식으로 변환된 데이타를 전송하는 역활을 한다.
   
   공통 스크립트 사용 
   lib_script_common.js
   Mi_screen.js
*/

#include "script::lib_script_common.js";
#include "script::Mi_screen.js";
var screenName ;
var chkData;
var initScreenName;
var sflag = 0;
var pflag = 0;
var popUrl = "";
var rowpos = 0;
var errcode = 0;
var page = 1;
var prevScreen;
var pcnt = 0;
function MAX52500_Fire_Message(obj)
{
	alert("message");
	errcode = 1;
}

function form_OnLoadCompleted(obj)
{
	fn_DivProcess("C");
	max5250.SystemName = "10.72.209.8";
	
	//사용자 정보 조회
	getUser();
}

function Button0_OnClick(obj)
{
	MAX5250.SendToField("ID06053","qsecofr" );
	MAX5250.SendToField("ID07053","secofr");
	MAX5250.SendKeys("[Enter]");
}

//사용자 정보 조회
function getUser()
{
	 var sKind = "getSsoAccount";      
	 var sMethodName = "service::user/selectSsoAccount.do";
	 var sInDataSet  = "";
	 var sOutDataSet = "ds_ssoaccount=ds_ssoaccount";
	 var sArgument   = "";
	
	 sArgument += " USER_ID=" + quote(G_ds_user.GetColumn(0,"USER_Id"));
	 sArgument += " INOUT_GUBN=" + quote("I");
	 sArgument += " COMPANY=" + quote(G_ds_user.GetColumn(0,"COMPANY"));
	 sArgument += " SYSTEM_SEQ=" + quote(8);
	 
	 Transaction(sKind, sMethodName, sInDataSet, sOutDataSet, sArgument, "fnc_callBack");
}
//메뉴정보 조회
function getMenuData(){
			
		var sKind		= "GETMENU";						
		var sMethodName = "service::max5250/getSubFileList.do";     // 서버에서 호출 될 Method 명
		var sInDataSet  = "";                             // 자료 저장 시 보낼 DataSet 명칭
		var sOutDataSet = "ds_menu=ds_menu";    // 조회 후 돌려 받을 DataSet 명칭
		var arg			= " USE_YN=" +quote("Y") ;
	
		Transaction(sKind, sMethodName, sInDataSet, sOutDataSet, arg, "fnc_callBack");
}

//업데이트 이벤트
function MAX5250_Fire_Update(obj)
{
	//trace("1");
	
}


/* #############################################################
  ###############								#################
 #############           RRESET   EVENT       	  ###############
 #############									#################
##############################################################*/
function MAX5250_Fire_Reset(obj)
{

//25라인 메시지 출력
b_message.Text = max5250.GetErrorString();
//메시지 출력
setMessageDirect(max5250.GetString(24,1,80));
	
	fn_DivProcess("F");
	screenName = getScrName(trim(max5250.GetString(1,1,10)));
	if(length(screenName) < 4)
		screenName = getScrName(trim(max5250.GetString(1,15,10)));
	if( prevScreen != screenName) page = 1;
	
	prevScreen =screenName;

		ds_screen.DeleteAll();
		
			
		if(max5250.IsPopupWindow() == 0){
	//		trace("== start url ===");
			fnc_goUrl(screenName); //green 터미널 화면 전환 
		}
		
		//팝업화면 채크
		if(max5250.IsPopupWindow() != 0){
			screenName = screenName+"P";
		}
	
		trace("reset >> screenName "+screenName);
		
		var row  =  ds_menu.FindRow("SCREEN_ID",screenName);

		if(row >= 0) btn_change.Enable = true;
		else btn_change.Enable = false;
		
		
		var sKind		= "GETSCREEN";						
		var sMethodName = "service::max5250/getScreenAttr.do";     				// 서버에서 호출 될 Method 명
		var sInDataSet  = "";                             						// 자료 저장 시 보낼 DataSet 명칭
		var sOutDataSet = "ds_screen=ds_screen ds_screenCopy=ds_screenCopy";    // 조회 후 돌려 받을 DataSet 명칭
		var arg = "";
			arg	= " SCREEN_ID=" + quote(screenName);
			arg	+= " SCR_TYPE=" +quote("1");
		if(pflag == 0){
			Transaction(sKind, sMethodName, sInDataSet, sOutDataSet, arg, "fnc_callBack");
		}
		if(pflag ==0) initScreenName = null;
		pflag = 0;
}



/*#########################################################
#########	xml변환								##########
#########	초기 화면 아이디 로딩..				##########
#########################################################*/
function Button1_OnClick(obj)
{
	ds_screenCopy.DeleteAll();
	var rtn = "";
	var rtnstr = ;
	var filename = "";
	var filepath = "";
	var mainStr;
	var stype;
	if(ds_screen.rowcount < 1) {
		rtn = Dialog("Max5250::convertPop.xml","screenName="+screenName ,152,320);
		rtnstr = split(rtn, "|","webstyle"); 
		filepath = rtnstr[0];
		filename = rtnstr[1];
		rowpos = 0;
	}else{
		rtn = Dialog("Max5250::convertPop2.xml","screenName="+screenName ,152,320);
		rtnstr = split(rtn, "|","webstyle"); 
		filepath = rtnstr[0];
		filename = rtnstr[1];
		rowpos = rtnstr[2];
	}
	
	
	stype = ds_screen.GetColumn(rowpos,"SCR_TYPE");
	if(stype == "") stype = "0";
	if(ds_screen.rowcount > 0) {
	//trace("====  SCR_TYPE ==== " +ds_screen.GetColumn(rowpos,"SCR_TYPE"));
		if(ds_screen.GetColumn(rowpos,"SCR_TYPE") == '1'){
		trace("====  subfile ====");
			var r_pos = ds_screen.GetColumn(rowpos,"REC_POS");
			if(r_pos == "") r_pos = ds_screen.GetColumn(rowpos,"COL_LENGTH");
			mainStr = max5250.GetScreenData(1,0);
			trace(ds_screen.GetColumn(rowpos,"COL_START")+","+ds_screen.GetColumn(rowpos,"COL_HEIGHT")+","+ds_screen.GetColumn(rowpos,"COL_LENGTH")+","+ds_screen.GetColumn(rowpos,"REC_START")+","+ds_screen.GetColumn(rowpos,"REC_COUNT")+","+ds_screen.GetColumn(rowpos,"REC_END")+","+r_pos);
			max5250.SubfileRange(ds_screen.GetColumn(rowpos,"COL_START"),ds_screen.GetColumn(rowpos,"COL_HEIGHT"),ds_screen.GetColumn(rowpos,"COL_LENGTH"),ds_screen.GetColumn(rowpos,"REC_START"),ds_screen.GetColumn(rowpos,"REC_COUNT"),ds_screen.GetColumn(rowpos,"REC_END"),r_pos);
			subStr = max5250.GetSelectData();
			
			fnc_DataXmlConvert(subStr,"ds_subfile",ds_screen.GetColumn(rowpos,"REC_LENGTH"),1);
		
		}else if(ds_screen.GetColumn(rowpos,"SCR_TYPE") == '2'){
		trace("====  pop ====" +ds_screenCopy.SaveXML());
		var r_pos = ds_screen.GetColumn(rowpos,"REC_POS");
		if(r_pos == "") r_pos = ds_screen.GetColumn(rowpos,"COL_LENGTH");
		
			//max5250.PopupRange(ds_screen.GetColumn(rowpos,"POP_STRROW"),ds_screen.GetColumn(rowpos,"POP_START_COL"),ds_screen.GetColumn(rowpos,"POP_END_ROW"),ds_screen.GetColumn(rowpos,"POP_END_COL"));
			max5250.SubfileRange(ds_screen.GetColumn(rowpos,"COL_START"),ds_screen.GetColumn(rowpos,"COL_HEIGHT"),ds_screen.GetColumn(rowpos,"COL_LENGTH"),ds_screen.GetColumn(rowpos,"REC_START"),ds_screen.GetColumn(rowpos,"REC_COUNT"),ds_screen.GetColumn(rowpos,"REC_END"),"");
			mainStr = max5250.GetPopupData();
			subStr = max5250.GetSelectData();
			fnc_DataXmlConvert(subStr,"ds_subfile",ds_screen.GetColumn(rowpos,"REC_LENGTH"),2);
		}else{
			trace("====  normal ====");
			mainStr = max5250.GetScreenData(1,0);
		}
	}else{
		mainStr = max5250.GetScreenData(1,0);
	}
	//trace(ds_head.SaveXML());
	var row = ds_screenCopy.AddRow();
	ds_screenCopy.CopyRow(row,"ds_screen" ,rowpos);
	var subStr = "";
	var sKind		= "CONVERTXML";						
	var sMethodName = "service::max5250/convertxml.do";     // 서버에서 호출 될 Method 명
	var sInDataSet  = "ds_head=ds_head ds_screen=ds_screenCopy";                    // 자료 저장 시 보낼 DataSet 명칭
	var sOutDataSet = "";    // 조회 후 돌려 받을 DataSet 명칭
//	var mainStr = max5250.GetScreenData(1,24);
//	trace(ds_screen.SaveXML());
	
	var arg			= " str=" + quote(mainStr);
		arg			+= " filepath=" + quote(filepath);
		arg			+= " filename=" + quote(filename);
		arg			+= " stype=" + quote(stype);
//	trace(arg);
	Transaction(sKind, sMethodName, sInDataSet, sOutDataSet, arg, "");
	
}

function setField(){
}


//콜백 이벤트
function fnc_callBack(svcId, errCode, errMsg)
{
	
	if(svcId = "GETMENU"){
		//메뉴조회후 로그인처리
		if(getAutoLogin(8) ) //auto login
				setTimer(1,1000);
			else
				max5250.Visible = true;
	}
	if(svcId = "getSsoAccount"){
		trace("=== getuser complete");
		max5250.DeviceName = ds_ssoaccount.GetColumn(0,"SYSTEM_GRU"); //디바이스
		var rtn = max5250.Connect();
		
		if(rtn != 0) {
			max5250.SetKeyHook("VK_TAB");
			getMenuData();
		
	}
	ds_screen.DeleteAll();

	}
	
	if(svcId = "GETSCREEN"){
		//trace("=====       start  subfile range =====");
		
		
		if(ds_screenCopy.rowcount == 1 /*&& ds_screenCopy.GetColumn(0,"SCR_TYPE") == '1'*/) {
		
			var r_pos = ds_screenCopy.GetColumn(0,"REC_POS");
			if(r_pos == "") r_pos = ds_screenCopy.GetColumn(0,"COL_LENGTH");
				max5250.SubfileRange(ds_screenCopy.GetColumn(0,"COL_START"),ds_screenCopy.GetColumn(0,"COL_HEIGHT"),ds_screenCopy.GetColumn(0,"COL_LENGTH"),ds_screenCopy.GetColumn(0,"REC_START"),ds_screenCopy.GetColumn(0,"REC_COUNT"),ds_screenCopy.GetColumn(0,"REC_END"),r_pos);
			
				var data = max5250.GetSelectData();
			//	trace("date:"   +max5250.GetSelectData());
				
				ds_attr.LoadXML(max5250.GetSelectAttribute());
				//trace("attribute:"   +ds_attr.SaveXML());
			//	trace("data = "+data);
			//	fnc_DataXmlConvert(data,"ds_subfile",ds_screenCopy.GetColumn(0,"REC_LENGTH"));
				
				if(max5250.IsPopupWindow() != 0){
					fnc_DataXmlConvert(data,"ds_subfile",ds_screenCopy.GetColumn(0,"REC_LENGTH"),2);
					fnc_popUrl(screenName);
				}else{
					fnc_DataXmlConvert(data,"ds_subfile",ds_screenCopy.GetColumn(0,"REC_LENGTH"),1);
				}
	
		}
		
		MAX5250.SetFocus();	
			
	}
	
}



function common_OnClick(obj)
{
	
	dialog("Max5250::SubFileSave.xml" ,450, 580);
//	Div5250.sendColumn();
}

function screenData()
{
	var subStr = "";
	var sKind		= "CONVERTXML";						
	var sMethodName = "service::max5250/convertxmlData.do";     // 서버에서 호출 될 Method 명
	var sInDataSet  = "";                    // 자료 저장 시 보낼 DataSet 명칭
	var sOutDataSet = "ds_main=ds_main";    // 조회 후 돌려 받을 DataSet 명칭
	var mainStr = max5250.GetScreenData(1,24);
	var arg = " str=" + quote(mainStr);

	Transaction(sKind, sMethodName, sInDataSet, sOutDataSet, arg, "");
}

function Button4_OnClick(obj)
{
	//alert(max5250.GetString(5,50,5));
	getMenuData();
}

function btn_change_OnClick(obj)
{
	changeScreen(sflag);
	if(sflag == 0){
		max5250.SetKeyHook("VK_TAB");
		sflag =  1;
	}else{
		max5250.SetKeyHook("");
		sflag =0;
	}
}
function MAX5250_Fire_Error(obj,sStatus)
{
	//alert(max5250.GetErrorString());
	//global.FrameBottom.messageBox = max5250.GetErrorString();
	//setMessageDirect(max5250.GetString(24,1,80));
	b_message.Text = max5250.GetString(24,1,80);
	//trace("err message : " +max5250.GetErrorString());
	MAX5250.SendKeys("[RESET]");
}

function main_form_OnTimer(obj,nEventID)
{
	if(nEventID == 1) {
		killTimer(1);
		setLogin();
	} 
}

//로그인 처리
function setLogin()
{
		MAX5250.SendToField("FD06053",ds_ssoaccount.GetColumn(0,"SYSTEM_ID"));
		MAX5250.SendToField("FD07053",ds_ssoaccount.GetColumn(0,"SYSTEM_PW"));
		MAX5250.SendKeys("[Enter]");
		Button1.SetFocus();
		MAX5250.SetFocus();	
}
//스크린 업데이트 
function ds_main_OnLoadCompleted(obj,nErrorCode,strErrorMsg,nReason)
{
	//trace("== screen update==");
	//var data = "#b6b6b6; ";
	//Div5250.FD03060.BKColor = data;
}

function main_form_OnUnloadCompleted(obj)
{
	//max5250.Disconnect();
	if(max5250.IsConnected() !=0){
		
	}
}

function fnc_OnKeyDown(obj,objSenderObj,nChar,bShift,bControl,bAlt,nLLParam,nHLParam)
{
	if(nChar == 13){
		div5250.sendColumn();
		div5250.sendField();
	}
}
]]></Script>
</Window>