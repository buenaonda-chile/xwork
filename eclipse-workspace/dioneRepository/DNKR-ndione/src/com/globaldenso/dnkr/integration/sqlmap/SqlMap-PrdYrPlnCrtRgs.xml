<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.globaldenso.dnkr.integration.dao.PrdYrPlnCrtRgsDao">

<!-- 検索結果をMapで受け取る -->
    <resultMap id="PrdYrPlnCrtRgsInput" type="PrdYrPlnCrtRgsDomain">
        <result property="clsCode" column="CLS_CODE" />		<!-- 사업부코드 -->
        <result property="locCode" column="LOC_CODE" />		<!-- 부서코드 -->
        <result property="lineCode" column="LINE_CODE" />	<!-- 라인코드 -->
        <result property="lineNm" column="LINE_NM" /> 		<!-- 라인명 -->
        <result property="code" column="CODE" />			<!-- 작업코드 -->
        <result property="codeNm" column="CODE_NM" /> 		<!-- 작업코드명 -->
        <result property="year" column="YEAR" />			<!-- 시작일 -->
        <result property="iem" column="IEM" />				<!-- 종료일 -->
        <result property="apr" column="APR" />				
        <result property="may" column="MAY" />				
        <result property="jun" column="JUN" />
        <result property="july" column="JULY" />
        <result property="aug" column="AUG" />
        <result property="sep" column="SEP" />
        <result property="oct" column="OCT" />
        <result property="nov" column="NOV" />
        <result property="dec" column="DEC" />
        <result property="jan" column="JAN" />
        <result property="feb" column="FEB" />
        <result property="mar" column="MAR" />
        <result property="totSum" column="TOT_SUM" />
        <result property="regUser" column="REG_USER" />		<!-- 등록자 -->
        <result property="regDate" column="REG_DATE" />		<!-- 등록일 -->
        <result property="modUser" column="MOD_USER" />		<!-- 수정자 -->
        <result property="modDate" column="MOD_DATE" />		<!-- 수정일 -->     
    </resultMap>

    <!-- 検索 SQL文（任意条件） -->
    <select id="searchByCondition" resultMap="PrdYrPlnCrtRgsInput" parameterType="PrdYrPlnCrtRgsDomain">
		
		SELECT
		      AA.YEAR
		    , AA.CLS_CODE
		    , AA.LINE_CODE
		    , AA.LINE_NM
		    , AA.CODE
		    , AA.CODE_NM
		    , AA.LOC_CODE
		    , BB.APR
		    , BB.MAY
		    , BB.JUN
		    , BB.JULY
		    , BB.AUG
		    , BB.SEP
		    , BB.OCT
		    , BB.NOV
		    , BB.DEC
		    , BB.JAN
		    , BB.FEB
		    , BB.MAR
		    , (BB.APR + BB.MAY + BB.JUN + BB.JULY + BB.AUG + BB.SEP + BB.OCT + BB.NOV + BB.DEC + BB.JAN + BB.FEB + BB.MAR) AS TOT_SUM
        FROM (
                 SELECT DISTINCT 
                 		CAST(#{year} AS INTEGER) AS YEAR
                      , A.CLS_CODE
                      , A.LINE_CODE
                      , A.LINE_NM
                      , A.LOC_CODE
                      , B.CODE
                      , B.CODE_NM
                 FROM (
                     SELECT CLS_CODE
                         , LINE_CODE
                         , LINE_NM
                         , 'H' WK_CODE
                         , LOC_CODE
                     FROM PSZDBLIB.FHP010PF
                     WHERE 1=1
                     <if test='locCode != null and !locCode.equalsIgnoreCase("")'>
					  AND LOC_CODE = #{locCode}
					 </if>
                     ) AS A JOIN PSZDBLIB.FHP020PF B
                 ON A.WK_CODE = B.SE
             ) AS AA  LEFT OUTER JOIN PSZDBLIB.FHP120PF BB
                ON AA.YEAR = BB.YEAR AND AA.CLS_CODE = BB.CLS_CODE AND AA.LINE_CODE = BB.LINE_CODE AND AA.LOC_CODE=BB.LOC_CODE AND AA.CODE=BB.IEM
        WHERE 1=1
		<if test='clsCode != null and !clsCode.equalsIgnoreCase("")'>
		  AND AA.CLS_CODE = #{clsCode}
		</if>
		ORDER BY AA.LINE_CODE ASC, AA.CODE ASC   
    </select>
    
    <!-- 検索 SQL文（任意条件 件数取得） -->
  	<select id="searchCount" resultType="java.lang.Integer" parameterType="PrdYrPlnCrtRgsDomain">
        SELECT 
              COUNT(*) AS CNT 
        FROM PSZDBLIB.FHP120PF
		WHERE 1 = 1
		AND YEAR 	  = #{year}   
		AND CLS_CODE  = #{clsCode}
		AND LOC_CODE  = #{locCode}
		AND LINE_CODE = #{lineCode}
		AND IEM 	  = #{iem}
		
    </select>
    
   <!--  登録 SQL文 -->
    <insert id="create" parameterType ="PrdYrPlnCrtRgsDomain">
        INSERT INTO  PSZDBLIB.FHP120PF (
				YEAR 
				, CLS_CODE
				, LOC_CODE
				, LINE_CODE
				, IEM
				, APR
				, MAY
				, JUN
				, JULY
				, AUG
				, SEP
				, OCT
				, NOV
				, DEC
				, JAN
				, FEB
				, MAR
				, REG_USER
				, REG_DATE
        ) values (
        		#{year}
               , #{clsCode}
               , #{locCode}
               , #{lineCode}
               , #{iem}
               , #{apr}
               , #{may}
               , #{jun}
               , #{july}
               , #{aug}
               , #{sep}
               , #{oct}
               , #{nov}
               , #{dec}
               , #{jan}
               , #{feb}
               , #{mar}               
               , #{regUser}
               , REPLACE(CHAR(DATE(CURRENT DATE), ISO), '-','')
        )
    </insert>

	<!-- 更新 SQL文（主キー） -->
    <update id="update" parameterType="PrdYrPlnCrtRgsDomain">
        UPDATE 
               PSZDBLIB.FHP120PF
        SET
        	APR = #{apr}
			, MAY = #{may}
			, JUN = #{jun}
			, JULY = #{july}
			, AUG = #{aug}
			, SEP = #{sep}
			, OCT = #{oct}
			, NOV = #{nov}
			, DEC = #{dec}
			, JAN = #{jan}
			, FEB = #{feb}
			, MAR = #{mar}
         	, MOD_USER  = #{modUser}
            , MOD_DATE  = REPLACE(CHAR(DATE(CURRENT DATE), ISO), '-','')
        WHERE CLS_CODE  = #{clsCode}
        AND   LINE_CODE = #{lineCode}
        AND   LOC_CODE  = #{locCode}
        AND   YEAR 		= #{year}  
        AND   IEM 	    = #{iem}
    </update>

   <!--  削除 SQL文（主キー） -->
    <delete id="delete" parameterType="PrdYrPlnCrtRgsDomain">
        DELETE 
        FROM 
             PSZDBLIB.FHP120PF
        WHERE CLS_CODE  = #{clsCode}
        AND   LINE_CODE = #{lineCode}
        AND   LOC_CODE  = #{locCode}
        AND   YEAR 	 	= CAST(#{year} AS INTEGER)
        AND   IEM 	    = #{iem}
    </delete>

</mapper>