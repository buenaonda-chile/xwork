<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.globaldenso.dnkr.integration.dao.OrderDayShipQtyCheckListDao">

	<!-- 検索結果をMapで受け取る -->
    <resultMap id="OrderDayShipQtyCheckList" type="OrderDayShipQtyCheckListDomain">
    	<result property="selchk" column="SELCHK" />
    	
        <result property="gcomps" column="GCOMPS" />
        <result property="comps" column="COMPS" />
                
        <result property="majcd" column="MAJCD" />        
        <result property="majcd_h" column="MAJCD_H" />        
        <result property="mjchr" column="MJCHR" />
        <result property="majmk" column="MAJMK" />

		<result property="house" column="HOUSE" />
		<result property="pyvnd1" column="PYVND1" />
		<result property="pyvnd2" column="PYVND2" />
		<result property="chldt" column="CHLDT" />
		
		<result property="cusnm" column="CUSNM" />
		<result property="faccd" column="FACCD" />
		<result property="seycd" column="SEYCD" />
		<result property="mkcar" column="MKCAR" />
		<result property="mkpno" column="MKPNO" />
		<result property="pspno" column="PSPNO" />
		<result property="itmnm" column="ITMNM" />
		<result property="makqy" column="MAKQY" />
		<result property="pspqy" column="PSPQY" />
		<result property="suyqy" column="SUYQY" />
		<result property="cllq1" column="CLLQ1" />
		<result property="cllbox1" column="CLLBOX1" />
		<result property="clpq1" column="CLPQ1" />		
		<result property="cllq2" column="CLLQ2" />
		<result property="cllbox2" column="CLLBOX2" />
		<result property="clpq2" column="CLPQ2" />
		<result property="junqy" column="JUNQY" />
		<result property="notqy" column="NOTQY" />
		<result property="trimd" column="TRIMD" />
		<result property="pbsqy" column="PBSQY" />
		<result property="datq0" column="DATQ0" />
		<result property="dat11" column="DAT11" />
		<result property="dat12" column="DAT12" />
		<result property="dat21" column="DAT21" />
		<result property="dat22" column="DAT22" />
		<result property="dat31" column="DAT31" />
		<result property="dat32" column="DAT32" />
		<result property="dat41" column="DAT41" />
		<result property="dat42" column="DAT42" />
		<result property="dat51" column="DAT51" />
		<result property="dat52" column="DAT52" />
		<result property="dat61" column="DAT61" />
		<result property="dat62" column="DAT62" />
		<result property="datqy" column="DATQY" />
		<result property="plqty" column="PLQTY" />
		<result property="boxq1" column="BOXQ1" />
		<result property="boxq2" column="BOXQ2" />
		<result property="dapq0" column="DAPQ0" />
		<result property="dap11" column="DAP11" />
		<result property="dap12" column="DAP12" />
		<result property="dap21" column="DAP21" />
		<result property="dap22" column="DAP22" />
		<result property="dap31" column="DAP31" />
		<result property="dap32" column="DAP32" />
		<result property="dap41" column="DAP41" />
		<result property="dap42" column="DAP42" />
		<result property="dap51" column="DAP51" />
		<result property="dap52" column="DAP52" />
		<result property="dap61" column="DAP61" />
		<result property="dap62" column="DAP62" />
		<result property="slqty" column="SLQTY" />
		<result property="sujq0" column="SUJQ0" />
		<result property="sujq1" column="SUJQ1" />
		<result property="sujq2" column="SUJQ2" />
		<result property="sujq3" column="SUJQ3" />
		<result property="sujq4" column="SUJQ4" />
		<result property="sujq5" column="SUJQ5" />
		<result property="sujq6" column="SUJQ6" />
		<result property="sujq7" column="SUJQ7" />
		<result property="sujq8" column="SUJQ8" />
		<result property="sujq9" column="SUJQ9" />
		<result property="sujq10" column="SUJQ10" />
		<result property="sujq11" column="SUJQ11" />
		<result property="sujq12" column="SUJQ12" />
		<result property="sujqy" column="SUJQY" />
		<result property="dalpr" column="DALPR" />
		<result property="trimds" column="TRIMDS" />
		<result property="pbsqys" column="PBSQYS" />
		<result property="datq0s" column="DATQ0S" />
		<result property="dat11s" column="DAT11S" />
		<result property="dat12s" column="DAT12S" />
		<result property="dat21s" column="DAT21S" />
		<result property="dat22s" column="DAT22S" />
		<result property="dat31s" column="DAT31S" />
		<result property="dat32s" column="DAT32S" />
		<result property="dat41s" column="DAT41S" />
		<result property="dat42s" column="DAT42S" />
		<result property="dat51s" column="DAT51S" />
		<result property="dat52s" column="DAT52S" />
		<result property="dat61s" column="DAT61S" />
		<result property="dat62s" column="DAT62S" />
		<result property="datqys" column="DATQYS" />
		<result property="dapq0s" column="DAPQ0S" />
		<result property="dap11s" column="DAP11S" />
		<result property="dap12s" column="DAP12S" />
		<result property="dap21s" column="DAP21S" />
		<result property="dap22s" column="DAP22S" />
		<result property="dap31s" column="DAP31S" />
		<result property="dap32s" column="DAP32S" />
		<result property="dap41s" column="DAP41S" />
		<result property="dap42s" column="DAP42S" />
		<result property="dap51s" column="DAP51S" />
		<result property="dap52s" column="DAP52S" />
		<result property="dap61s" column="DAP61S" />
		<result property="dap62s" column="DAP62S" />
		<result property="sujq0s" column="SUJQ0S" />
		<result property="sujq1s" column="SUJQ1S" />
		<result property="sujq2s" column="SUJQ2S" />
		<result property="sujq3s" column="SUJQ3S" />
		<result property="sujq4s" column="SUJQ4S" />
		<result property="sujq5s" column="SUJQ5S" />
		<result property="sujq6s" column="SUJQ6S" />
		<result property="sujq7s" column="SUJQ7S" />
		<result property="sujq8s" column="SUJQ8S" />
		<result property="sujq9s" column="SUJQ9S" />
		<result property="sujq10s" column="SUJQ10S" />
		<result property="sujq11s" column="SUJQ11S" />
		<result property="sujq12s" column="SUJQ12S" />
		<result property="sujqys" column="SUJQYS" />
					
		<result property="trimdt" column="TRIMDT" />
		<result property="pbsqyt" column="PBSQYT" />
		<result property="datq0t" column="DATQ0T" />
		<result property="datq1t" column="DATQ1T" />
		<result property="datq2t" column="DATQ2T" />
		<result property="datq3t" column="DATQ3T" />
		<result property="datq4t" column="DATQ4T" />
		<result property="datq5t" column="DATQ5T" />
		<result property="datq6t" column="DATQ6T" />
		<result property="datq7t" column="DATQ7T" />
		<result property="datq8t" column="DATQ8T" />
		<result property="datq9t" column="DATQ9T" />
		<result property="datqat" column="DATQAT" />
		<result property="datqbt" column="DATQBT" />
		<result property="datqct" column="DATQCT" />
		<result property="errcd" column="ERRCD" />
		<result property="errnm" column="ERRNM" />
					
		<result property="pyvnd" column="PYVND" />
		<result property="makdt" column="MAKDT" />
		<result property="makmk" column="MAKMK" />
		<result property="clhcd" column="CLHCD" />
		
		<result property="prcdt" column="PRCDT" />
		<result property="chkdt" column="CHKDT" />
		<result property="chkcnt" column="CHKCNT" />
		<result property="stddt" column="STDDT" />

        <result property="lib1" column="lib1" />
        <result property="lib2" column="lib2" />
        <result property="lib3" column="lib3" />     
    </resultMap>
    
	<select id="selectMST040PF_HOUSE" resultMap="OrderDayShipQtyCheckList" parameterType="OrderDayShipQtyCheckListDomain">
		SELECT
			TRIM(MAJCD) MAJCD,
			SUBSTR(MAJCD,6,1) MAJCD_H,
			TRIM(MJCHR) MJCHR,
			TRIM(MAJMK) MAJMK
		FROM
			${lib2}.MST040PF
		WHERE
			 'SqlMap-OrderDayShipQtyCheckList.selectMST040PF_HOUSE' = 'SqlMap-OrderDayShipQtyCheckList.selectMST040PF_HOUSE'
		  AND COMPS = #{gcomps}
		  AND MAJCD like 'HOUSE%'			
		<if test="comps != null and comps !='' ">
		  AND MJCHR = #{comps}
		</if>	
	</select>

	<select id="selectSPDE141Q_142PF" resultMap="OrderDayShipQtyCheckList" parameterType="OrderDayShipQtyCheckListDomain">
		SELECT 
		A.CHLDT, TRIM(B.CUSNM) AS CUSNM, A.PYVND, A.FACCD, A.SEYCD, A.MKCAR, A.MKPNO, A.PSPNO, TRIM(C.ITDSC) AS ITMNM, 
		A.MAKQY, COALESCE(G.PSPQY,0) AS PSPQY, A.SUYQY,
		A.CLLQ1, 'BOX' AS CLLBOX1, A.CLPQ1, A.CLLQ2, 'BOX' AS CLLBOX2, A.CLPQ2, COALESCE(D.JUNQY,0) AS JUNQY, (A.CLPQ1+A.CLPQ2)- COALESCE(D.JUNQY,0) AS NOTQY, A.TRIMD, A.PBSQY, 
		A.DATQ0, A.DAT11, A.DAT12, A.DAT21, A.DAT22, A.DAT31, A.DAT32, A.DAT41, A.DAT42, A.DAT51, A.DAT52, A.DAT61, A.DAT62,
		A.DATQ0+A.DATQ1+A.DATQ2+A.DATQ3+A.DATQ4+A.DATQ5+A.DATQ6+A.DATQ7+A.DATQ8+A.DATQ9+A.DATQA+A.DATQB+A.DATQC AS DATQY,
		COALESCE(F.SL0QY,0) AS PLQTY,
		DECIMAL(CASE WHEN A.SUYQY!=0 THEN A.CLPQ1/A.SUYQY ELSE 0 END) AS BOXQ1,
		DECIMAL(CASE WHEN A.SUYQY!=0 THEN A.CLPQ2/A.SUYQY ELSE 0 END) AS BOXQ2,
		A.DAPQ0, A.DAP11, A.DAP12, A.DAP21, A.DAP22, A.DAP31, A.DAP32, A.DAP41, A.DAP42, A.DAP51, A.DAP52, A.DAP61, A.DAP62, COALESCE(E.SLQTY,0) AS SLQTY,
		A.SUJQ0, A.SUJQ1, A.SUJQ2, A.SUJQ3, A.SUJQ4, A.SUJQ5, A.SUJQ6, A.SUJQ7, A.SUJQ8, A.SUJQ9, 
		A.SUJQA AS SUJQ10 , A.SUJQB AS SUJQ11, A.SUJQC AS SUJQ12,
		A.SUJQ0+A.SUJQ1+A.SUJQ2+A.SUJQ3+A.SUJQ4+A.SUJQ5+A.SUJQ6+A.SUJQ7+A.SUJQ8+A.SUJQ9+A.SUJQA+A.SUJQB+A.SUJQC AS SUJQY,
		CASE WHEN COALESCE(F.SL0QY,0)!=0 THEN TRUNC(DOUBLE(COALESCE(E.SLQTY,0))/DOUBLE(COALESCE(F.SL0QY,0))*100,2) ELSE 0 END AS DALPR,
			<!-- 합계 -->
		CASE WHEN H.QYEXT='Y' THEN A.TRIMD ELSE 0 END AS TRIMDS,
		CASE WHEN H.QYEXT='Y' THEN A.PBSQY ELSE 0 END AS PBSQYS,
		CASE WHEN H.QYEXT='Y' THEN A.DATQ0 ELSE 0 END AS DATQ0S,
		CASE WHEN H.QYEXT='Y' THEN A.DAT11 ELSE 0 END AS DAT11S,
		CASE WHEN H.QYEXT='Y' THEN A.DAT12 ELSE 0 END AS DAT12S,
		CASE WHEN H.QYEXT='Y' THEN A.DAT21 ELSE 0 END AS DAT21S,
		CASE WHEN H.QYEXT='Y' THEN A.DAT22 ELSE 0 END AS DAT22S,
		CASE WHEN H.QYEXT='Y' THEN A.DAT31 ELSE 0 END AS DAT31S,
		CASE WHEN H.QYEXT='Y' THEN A.DAT32 ELSE 0 END AS DAT32S,
		CASE WHEN H.QYEXT='Y' THEN A.DAT41 ELSE 0 END AS DAT41S,
		CASE WHEN H.QYEXT='Y' THEN A.DAT42 ELSE 0 END AS DAT42S,
		CASE WHEN H.QYEXT='Y' THEN A.DAT51 ELSE 0 END AS DAT51S,
		CASE WHEN H.QYEXT='Y' THEN A.DAT52 ELSE 0 END AS DAT52S,
		CASE WHEN H.QYEXT='Y' THEN A.DAT61 ELSE 0 END AS DAT61S,
		CASE WHEN H.QYEXT='Y' THEN A.DAT62 ELSE 0 END AS DAT62S,
		CASE WHEN H.QYEXT='Y' THEN A.DATQ0+A.DATQ1+A.DATQ2+A.DATQ3+A.DATQ4+A.DATQ5+A.DATQ6+A.DATQ7+A.DATQ8+A.DATQ9+A.DATQA+A.DATQB+A.DATQC ELSE 0 END AS DATQYS,
		CASE WHEN H.QYEXT='Y' THEN A.DAPQ0 ELSE 0 END AS DAPQ0S,
		CASE WHEN H.QYEXT='Y' THEN A.DAP11 ELSE 0 END AS DAP11S,
		CASE WHEN H.QYEXT='Y' THEN A.DAP12 ELSE 0 END AS DAP12S,
		CASE WHEN H.QYEXT='Y' THEN A.DAP21 ELSE 0 END AS DAP21S,
		CASE WHEN H.QYEXT='Y' THEN A.DAP22 ELSE 0 END AS DAP22S,
		CASE WHEN H.QYEXT='Y' THEN A.DAP31 ELSE 0 END AS DAP31S,
		CASE WHEN H.QYEXT='Y' THEN A.DAP32 ELSE 0 END AS DAP32S,
		CASE WHEN H.QYEXT='Y' THEN A.DAP41 ELSE 0 END AS DAP41S,
		CASE WHEN H.QYEXT='Y' THEN A.DAP42 ELSE 0 END AS DAP42S,
		CASE WHEN H.QYEXT='Y' THEN A.DAP51 ELSE 0 END AS DAP51S,
		CASE WHEN H.QYEXT='Y' THEN A.DAP52 ELSE 0 END AS DAP52S,
		CASE WHEN H.QYEXT='Y' THEN A.DAP61 ELSE 0 END AS DAP61S,
		CASE WHEN H.QYEXT='Y' THEN A.DAP62 ELSE 0 END AS DAP62S,
		CASE WHEN H.QYEXT='Y' THEN A.SUJQ0 ELSE 0 END AS SUJQ0S,
		CASE WHEN H.QYEXT='Y' THEN A.SUJQ1 ELSE 0 END AS SUJQ1S,
		CASE WHEN H.QYEXT='Y' THEN A.SUJQ2 ELSE 0 END AS SUJQ2S,
		CASE WHEN H.QYEXT='Y' THEN A.SUJQ3 ELSE 0 END AS SUJQ3S,
		CASE WHEN H.QYEXT='Y' THEN A.SUJQ4 ELSE 0 END AS SUJQ4S,
		CASE WHEN H.QYEXT='Y' THEN A.SUJQ5 ELSE 0 END AS SUJQ5S,
		CASE WHEN H.QYEXT='Y' THEN A.SUJQ6 ELSE 0 END AS SUJQ6S,
		CASE WHEN H.QYEXT='Y' THEN A.SUJQ7 ELSE 0 END AS SUJQ7S,
		CASE WHEN H.QYEXT='Y' THEN A.SUJQ8 ELSE 0 END AS SUJQ8S,
		CASE WHEN H.QYEXT='Y' THEN A.SUJQ9 ELSE 0 END AS SUJQ9S,
		CASE WHEN H.QYEXT='Y' THEN A.SUJQA ELSE 0 END AS SUJQ10S,
		CASE WHEN H.QYEXT='Y' THEN A.SUJQB ELSE 0 END AS SUJQ11S,
		CASE WHEN H.QYEXT='Y' THEN A.SUJQC ELSE 0 END AS SUJQ12S,
		CASE WHEN H.QYEXT='Y' THEN A.SUJQ0+A.SUJQ1+A.SUJQ2+A.SUJQ3+A.SUJQ4+A.SUJQ5+A.SUJQ6+A.SUJQ7+A.SUJQ8+A.SUJQ9+A.SUJQA+A.SUJQB+A.SUJQC ELSE 0 END AS SUJQYS
		FROM 
			PSZDBLIB.SPD142PF A
			LEFT OUTER JOIN ${lib1}.CUSMAS B ON A.PYVND=B.CUSNO
			LEFT OUTER JOIN ${lib1}.BM008PR C ON A.PSPNO=C.ITNBR
			LEFT OUTER JOIN(
				SELECT A.CUSNO, A.SHPNO, A.PRTNO, A.DUEDT, SUM(A.SHPQY) AS JUNQY FROM ${lib1}.ED005LR5 A
				GROUP BY A.CUSNO, A.SHPNO, A.PRTNO, A.DUEDT
				) D ON A.PYVND=D.CUSNO AND D.SHPNO=0 AND A.PSPNO=D.PRTNO AND A.CHLDT=D.DUEDT
			LEFT OUTER JOIN(
				SELECT A.COMPS, A.JPYYM, A.PYVND, A.SHPTO, A.PSPNO, SUM(A.JPSQY) AS SLQTY FROM ${lib2}.SMD113LF A
				GROUP BY A.COMPS, A.JPYYM, A.PYVND, A.SHPTO, A.PSPNO) E ON E.COMPS = #{comps} AND SUBSTR(A.CHLDT,1,6) =E.JPYYM AND A.PYVND= E.PYVND AND E.SHPTO=0 AND A.PSPNO=E.PSPNO
			LEFT OUTER JOIN ${lib2}.SPM110PF F ON F.COMPS = #{comps} AND SUBSTR(A.CHLDT,1,6) = F.PLNYM AND A.PYVND=F.PYVND AND F.SHPTO=0 AND A.PSPNO=F.PSPNO
			LEFT OUTER JOIN (
				SELECT Z.COMPS, Z.ITNBR AS PSPNO, SUM(Z.MOHTQ) AS PSPQY FROM ${lib2}.BDD100PF Z 
					WHERE Z.COMPS = #{comps} AND HOUSE IN #{house}
					GROUP BY Z.COMPS, Z.ITNBR
				) G ON G.COMPS = #{comps} AND A.PSPNO=G.PSPNO
			LEFT OUTER JOIN ${lib2}.MST100PF H ON H.COMPS = #{comps} AND A.PSPNO=H.PRTNO
		WHERE
		      'SqlMap-OrderDayShipQtyCheckList.selectSPDE141Q_142PF' = 'SqlMap-OrderDayShipQtyCheckList.selectSPDE141Q_142PF'									
		AND A.COMPS = #{comps}
		AND A.PYVND BETWEEN #{pyvnd1} AND #{pyvnd2}
		AND A.CHLDT = #{chldt}
		ORDER BY A.PYVND, A.FACCD, A.MKCAR, A.SEYCD 
	</select>
	
	<select id="selectSPDE141Q_148PF" resultMap="OrderDayShipQtyCheckList" parameterType="OrderDayShipQtyCheckListDomain">
		SELECT 
			A.CHLDT, TRIM(B.CUSNM) AS CUSNM, A.PYVND, A.FACCD, A.MKCAR, A.SEYCD, A.MKPNO, A.PSPNO,
			A.TRIMDT, A.PBSQYT, A.DATQ0T, A.DATQ1T, A.DATQ2T, A.DATQ3T, A.DATQ4T, A.DATQ5T, A.DATQ6T,
			A.DATQ7T, A.DATQ8T, A.DATQ9T, A.DATQAT, A.DATQBT, A.DATQCT, A.ERRCD,
			CASE WHEN A.ERRCD = '1' THEN '출하정보 MA미등록' 
			     WHEN A.ERRCD = '2' THEN '수주아이템제어마스타등록'
			     ELSE '' END AS ERRNM
		FROM
			PSZDBLIB.SPD148PF A
			LEFT OUTER JOIN ${lib1}.CUSMAS B ON A.PYVND=B.CUSNO
		WHERE
		      'SqlMap-OrderDayShipQtyCheckList.selectSPDE141Q_148PF' = 'SqlMap-OrderDayShipQtyCheckList.selectSPDE141Q_148PF'
		  AND A.COMPS = #{comps}
	      AND A.PYVND BETWEEN #{pyvnd1} AND #{pyvnd2}
	      AND A.CHLDT = #{chldt}
		  <!-- 업체가 0인것은 필요없음 -->
		  AND A.PYVND !=0
		ORDER BY A.PYVND, A.FACCD, A.MKCAR, A.SEYCD
	</select>

	<select id="selectSAL100_SE" resultMap="OrderDayShipQtyCheckList" parameterType="OrderDayShipQtyCheckListDomain">
		SELECT  
	 		MAKMK, MAKDT, CLHCD
	   	FROM  
	  		${lib2}.SAL100PF
	  	WHERE 
	  		 'SqlMap-OrderDayShipQtyCheckList.selectSAL100_SE' = 'SqlMap-OrderDayShipQtyCheckList.selectSAL100_SE'
	  		 
	  	<if test="comps != null and comps !='' ">
	  	   AND COMPS = #{comps}
	  	</if>
	  	<if test="pyvnd != null and pyvnd !='' ">
	  	   AND PYVND = #{pyvnd}
	  	</if>
	  	<if test="makdt != null and makdt !='' ">
	  	   AND MAKDT <![CDATA[>=]]> #{makdt}
	  	</if>
	  	<if test="chkcnt != null and chkcnt !='' ">
	  	   FETCH FIRST ${chkcnt} ROW ONLY
	  	</if>					
	</select>	
	
	<select id="selectMST090PF" resultMap="OrderDayShipQtyCheckList" parameterType="OrderDayShipQtyCheckListDomain">
		SELECT 
			PRCDT
		FROM 
			${lib2}.MST090PF
		WHERE 
		      'SqlMap-OrderDayShipQtyCheckList.selectMST090PF' = 'SqlMap-OrderDayShipQtyCheckList.selectMST090PF'
		      
	  	<if test="comps != null and comps !='' ">
	  	   AND COMPS = #{comps}
	  	</if>
	  	<if test="prcdt != null and prcdt !='' ">
	  	   AND PRCDT = #{prcdt}
	  	</if>
	  	<if test='chkdt.equals("SDATE")'>
		   AND PRCDT <![CDATA[>=]]> SUBSTR(trim(char(date(current date), ISO)),1,4) || SUBSTR(trim(char(date(current date), ISO)),6,2) || SUBSTR(trim(char(date(current date), ISO)),9,2)
			   FETCH FIRST ${chkcnt} ROW ONLY
	  	</if>
	  	<if test='chkdt.equals("PDATE")'>
		   AND PRCDT <![CDATA[>=]]> #{stddt}
			   FETCH FIRST ${chkcnt} ROW ONLY
	  	</if>
	</select>
	
</mapper>