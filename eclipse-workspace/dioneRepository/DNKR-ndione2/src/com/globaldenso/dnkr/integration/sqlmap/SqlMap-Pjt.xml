<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.globaldenso.dnkr.integration.dao.PjtDao">

	<!-- 検索結果をMapで受け取る -->
    <resultMap id="Pjt" type="PjtDomain">
        <result property="pjtNum" column="PJT_NUM" />
        <result property="empNumber" column="EMP_NUMBER" />
        <result property="empName" column="EMP_NAME" />
        <result property="workDate" column="WORK_DT" />
        <result property="workHour" column="WORK_HOUR" />
        <result property="workCode" column="WORK_TYPE_CD" />
        <result property="workLCode" column="WORK_TYPE_LRG" />
        <result property="workMCode" column="WORK_TYPE_MDM" />
        <result property="workSCode" column="WORK_TYPE_SML" />
        <result property="workLTypeNm" column="WORK_TYPE_LRG_NM" />
        <result property="workMTypeNm" column="WORK_TYPE_MDM_NM" />
        <result property="workTypeNm" column="WORK_TYPE_NM" />
        <result property="relSys" column="RLTN_SYS" />
        <result property="workTrtr" column="WORK_TRTR" />
        <result property="aprvType" column="APRV_TYPE" />
        <result property="aprvEmpNum" column="APRV_EMP_NUMBER" />
        <result property="note" column="NOTE" />
        <result property="workDtlCnts" column="WORK_DTL_CNTS" />
        <result property="regDate" column="REGI_DTM" />
        <result property="startDate" column="REGI_DTM" />
        <result property="endDate" column="REGI_DTM" />
        <result property="aprvDate" column="APRV_DTM" />
        <result property="cmcLangCode" column="CMC_CODE" />
        <collection property="empNumList" column="EMP_NUMBER" javaType="java.util.List" ofType="java.lang.String">
	    </collection>
    </resultMap>
     
    <!-- 検索 SQL文（主キー） -->
    <select id="searchByKey" resultMap="Pjt" parameterType="PjtDomain">
        select 
                PJT_NUM
              , EMP_NUMBER
              , WORK_DT
              , WORK_HOUR
              , WORK_TYPE_CD
              , WORK_TYPE_LRG
              , WORK_TYPE_MDM
              , WORK_TYPE_SML
              , RLTN_SYS
              , WORK_TRTR
              , APRV_TYPE
              , APRV_EMP_NUMBER
              , NOTE
              , REGI_DTM
              , APRV_DTM
        from 
                DNKR_PJT
        where 
                'SqlMap-Pjt.searchByKey' = 'SqlMap-Pjt.searchByKey'
            and PJT_NUM = #{pjtNum}
        
    </select>

    <!-- 検索 SQL文（任意条件） -->
    <select id="searchByCondition" resultMap="Pjt"
        parameterType="PjtDomain">
        select 
                A.PJT_NUM
              , A.EMP_NUMBER
              , A.WORK_DT
              , A.WORK_HOUR
              , A.WORK_TYPE_CD
              , A.WORK_TYPE_LRG
              , A.WORK_TYPE_MDM
              , A.WORK_TYPE_SML
          <if test="cmcLangCode != null and cmcLangCode == 'kr'">
          	  , B.WORK_TYPE_NM WORK_TYPE_NM
              , C.WORK_TYPE_NM WORK_TYPE_LRG_NM
              , D.WORK_TYPE_NM WORK_TYPE_MDM_NM
          </if>
          <if test="cmcLangCode != null and cmcLangCode == 'en'">
          	  , B.WORK_TYPE_EN_NM WORK_TYPE_NM
              , C.WORK_TYPE_EN_NM WORK_TYPE_LRG_NM
              , D.WORK_TYPE_EN_NM WORK_TYPE_MDM_NM
          </if>
          <if test="cmcLangCode != null and cmcLangCode == 'ja'">
          	  , B.WORK_TYPE_JA_NM WORK_TYPE_NM
              , C.WORK_TYPE_JA_NM WORK_TYPE_LRG_NM
              , D.WORK_TYPE_JA_NM WORK_TYPE_MDM_NM
          </if>    
              , A.RLTN_SYS
              , A.WORK_TRTR
              , A.APRV_TYPE
              , A.APRV_EMP_NUMBER
              , A.NOTE
              , A.WORK_DTL_CNTS
              , A.REGI_DTM
              , A.APRV_DTM
        from 
                DNKR_PJT A
        left join
                DNKR_WORK_TYPE B
        on    A.WORK_TYPE_CD = B.WORK_TYPE_CD
        left join
                DNKR_WORK_TYPE C
        on    A.WORK_TYPE_LRG = C.WORK_TYPE_CD
        left join
                DNKR_WORK_TYPE D
        on    A.WORK_TYPE_MDM = D.WORK_TYPE_CD     
        where 
                'SqlMap-Pjt.searchByCondition' = 'SqlMap-Pjt.searchByCondition'
        <if test="pjtNum != null and pjtNum != ''">
            and	A.PJT_NUM = #{pjtNum}
        </if>
        <if test="empNumber != null and empNumber != ''">
            and A.EMP_NUMBER = #{empNumber}
        </if>
        <if test="workDate != null and workDate != ''">
            and A.WORK_DT = #{workDate}
        </if>
        <if test="workHour != null and workHour != ''">
            and A.WORK_HOUR = #{workHour}
        </if>
        <if test="workCode != null and workCode != ''">
            and A.WORK_TYPE_CD = #{workCode}
        </if>
        <if test="workLCode != null and workLCode != ''">
            and A.WORK_TYPE_LRG = #{workLCode}
        </if>
        <if test="workMCode != null and workMCode != ''">
            and A.WORK_TYPE_MDM = #{workMCode}
        </if>
        <if test="workSCode != null and workSCode != ''">
            and A.WORK_TYPE_SML = #{workSCode}
        </if>
        <if test="relSys != null and relSys != ''">
            and A.RLTN_SYS LIKE '%' || #{relSys} || '%'
        </if>
        <if test="workTrtr != null and workTrtr != ''">
            and A.WORK_TRTR = #{workTrtr}
        </if>
        <if test="aprvType != null and aprvType != ''">
            and A.APRV_TYPE = #{aprvType}
        </if>
        <if test="aprvEmpNum != null and aprvEmpNum != ''">
            and A.APRV_EMP_NUMBER = #{aprvEmpNum}
        </if>
        <if test="note != null and note != ''">
            and A.NOTE = #{note}
        </if>
        <if test="regDate != null and regDate != ''">
            and A.REGI_DTM = #{regDate}
        </if>
         <if test="startDate != null and startDate != ''">
            and A.WORK_DT >= #{startDate}
        </if>
         <if test="endDate != null and endDate != ''">
            and #{endDate} >= A.WORK_DT
        </if>
        <if test="aprvDate != null and aprvDate != ''">
            and A.APRV_DTM = #{aprvDate}
        </if>
        order by 
                PJT_NUM desc
    </select>
    
    <!-- 検索 SQL文（任意条件） -->
    <select id="relSysList" resultType="java.lang.String"
        parameterType="PjtDomain">
        select  
        		DISTINCT
                RLTN_SYS
        from 
                DNKR_PJT     
        where 
                'SqlMap-Pjt.searchByCondition' = 'SqlMap-Pjt.searchByCondition'
        <if test="empNumList != null">
         	and EMP_NUMBER in
        	<foreach collection="empNumList" item="empNum" index="index" separator="," open="(" close=")">
        		#{empNum}
        	</foreach>
        </if>
        order by 
                RLTN_SYS
    </select>
    
     <!-- 検索 SQL文（任意条件） -->
    <select id="searchPjtRegStatus" resultMap="Pjt"
        parameterType="PjtDomain">
	   select *    
	       from
	       (
	        select 
	                A.WORK_DT
	              , A.EMP_NUMBER
	              , B.EMP_NAME
	              , A.WORK_HOUR
	        from 
	             (
	             	select
	             		  WORK_DT
	             		, SUM(WORK_HOUR) WORK_HOUR
	             		, EMP_NUMBER
	             	from 
	             	      DNKR_PJT
	         	    where 
	         	    	'SqlMap-Pjt.searchByCondition' = 'SqlMap-Pjt.searchByCondition'
	         	        <if test="workDate != null and workDate != ''">
	         	        	and WORK_DT = #{workDate}
	       	        	</if>    
	       	        	group by EMP_NUMBER, WORK_DT
	       	      ) A
	        left join
	                DNKR_EMP B
	        on    A.EMP_NUMBER = B.EMP_NUMBER
	        )
	        
            <if test="empNumber != null and empNumber != ''">
     	        where EMP_NUMBER = #{empNumber}
 	        </if>
    </select>

    <!-- 検索 SQL文（任意条件、ページング用） -->
    <select id="searchByConditionForPaging" resultMap="Pjt"
        parameterType="PjtDomain">
        select 
                PJT_NUM
              , EMP_NUMBER
              , WORK_DT
              , WORK_HOUR
              , WORK_TYPE_CD
              , WORK_TYPE_LRG
              , WORK_TYPE_MDM
              , WORK_TYPE_SML
              , WORK_TYPE_NM
              , WORK_TYPE_LRG_NM
              , WORK_TYPE_MDM_NM
              , RLTN_SYS
              , WORK_TRTR
              , APRV_TYPE
              , APRV_EMP_NUMBER
              , NOTE
              , WORK_DTL_CNTS
              , REGI_DTM
              , APRV_DTM
              , ROW_NUM
        from (
       		select
	            	A.PJT_NUM
	              , A.EMP_NUMBER
	              , A.WORK_DT
	              , A.WORK_HOUR
	              , A.WORK_TYPE_CD
	              , A.WORK_TYPE_LRG
	              , A.WORK_TYPE_MDM
	              , A.WORK_TYPE_SML
	          <if test="cmcLangCode != null and cmcLangCode == 'kr'">
	          	  , B.WORK_TYPE_NM WORK_TYPE_NM
	              , C.WORK_TYPE_NM WORK_TYPE_LRG_NM
	              , D.WORK_TYPE_NM WORK_TYPE_MDM_NM
	          </if>
	          <if test="cmcLangCode != null and cmcLangCode == 'en'">
	          	  , B.WORK_TYPE_EN_NM WORK_TYPE_NM
	              , C.WORK_TYPE_EN_NM WORK_TYPE_LRG_NM
	              , D.WORK_TYPE_EN_NM WORK_TYPE_MDM_NM
	          </if>
	          <if test="cmcLangCode != null and cmcLangCode == 'ja'">
	          	  , B.WORK_TYPE_JA_NM WORK_TYPE_NM
	              , C.WORK_TYPE_JA_NM WORK_TYPE_LRG_NM
	              , D.WORK_TYPE_JA_NM WORK_TYPE_MDM_NM
	          </if>    
	              , A.RLTN_SYS
	              , A.WORK_TRTR
	              , A.APRV_TYPE
	              , A.APRV_EMP_NUMBER
	              , A.NOTE
	              , A.WORK_DTL_CNTS
	              , A.REGI_DTM
	              , A.APRV_DTM
                  , row_number() over (order by PJT_NUM desc) ROW_NUM
            from 
                    DNKR_PJT A
	        left join
	                DNKR_WORK_TYPE B
	        on    A.WORK_TYPE_CD = B.WORK_TYPE_CD
	        left join
	                DNKR_WORK_TYPE C
	        on    A.WORK_TYPE_LRG = C.WORK_TYPE_CD
	        left join
	                DNKR_WORK_TYPE D
	        on    A.WORK_TYPE_MDM = D.WORK_TYPE_CD     
	        where 
                    'SqlMap-Pjt.searchByConditionForPaging' = 'SqlMap-Pjt.searchByConditionForPaging'
        <if test="pjtNum != null and pjtNum != ''">
            and	A.PJT_NUM = #{pjtNum}
        </if>
        <if test="empNumber != null and empNumber != ''">
            and A.EMP_NUMBER = #{empNumber}
        </if>
        <if test="workDate != null and workDate != ''">
            and A.WORK_DT = #{workDate}
        </if>
        <if test="workHour != null and workHour != ''">
            and A.WORK_HOUR = #{workHour}
        </if>
        <if test="workCode != null and workCode != ''">
            and A.WORK_TYPE_CD = #{workCode}
        </if>
        <if test="workLCode != null and workLCode != ''">
            and A.WORK_TYPE_LRG = #{workLCode}
        </if>
        <if test="workMCode != null and workMCode != ''">
            and A.WORK_TYPE_MDM = #{workMCode}
        </if>
        <if test="workSCode != null and workSCode != ''">
            and A.WORK_TYPE_SML = #{workSCode}
        </if>
        <if test="relSys != null and relSys != ''">
            and A.RLTN_SYS LIKE '%' || #{relSys} || '%'
        </if>
        <if test="workTrtr != null and workTrtr != ''">
            and A.WORK_TRTR = #{workTrtr}
        </if>
        <if test="aprvType != null and aprvType != ''">
            and A.APRV_TYPE = #{aprvType}
        </if>
        <if test="aprvEmpNum != null and aprvEmpNum != ''">
            and A.APRV_EMP_NUMBER = #{aprvEmpNum}
        </if>
        <if test="note != null and note != ''">
            and A.NOTE = #{note}
        </if>
        <if test="regDate != null and regDate != ''">
            and A.REGI_DTM = #{regDate}
        </if>
         <if test="startDate != null and startDate != ''">
            and A.WORK_DT >= #{startDate}
        </if>
         <if test="endDate != null and endDate != ''">
            and #{endDate} >= A.WORK_DT
        </if>
        <if test="aprvDate != null and aprvDate != ''">
            and A.APRV_DTM = #{aprvDate}
        </if>
	        )
	    where 
            	ROW_NUM between #{rowNumFrom} and #{rowNumTo}
    </select>

    <!-- 検索 SQL文（任意条件 件数取得） -->
    <select id="searchCount" resultType="java.lang.Integer"
        parameterType="PjtDomain">
        select 
                count(rownum) 
        from 
                DNKR_PJT   
        where  
                'SqlMap-Pjt.searchCount' = 'SqlMap-Pjt.searchCount'
      	<if test="pjtNum != null and pjtNum != ''">
            and	PJT_NUM = #{pjtNum}
        </if>
        <if test="empNumber != null and empNumber != ''">
            and EMP_NUMBER = #{empNumber}
        </if>
        <if test="workDate != null and workDate != ''">
            and WORK_DT = #{workDate}
        </if>
        <if test="workHour != null and workHour != ''">
            and WORK_HOUR = #{workHour}
        </if>
        <if test="workCode != null and workCode != ''">
            and WORK_TYPE_CD = #{workCode}
        </if>
        <if test="workLCode != null and workLCode != ''">
            and WORK_TYPE_LRG = #{workLCode}
        </if>
        <if test="workMCode != null and workMCode != ''">
            and WORK_TYPE_MDM = #{workMCode}
        </if>
        <if test="workSCode != null and workSCode != ''">
            and WORK_TYPE_SML = #{workSCode}
        </if>
        <if test="relSys != null and relSys != ''">
            and RLTN_SYS LIKE '%' || #{relSys} || '%'
        </if>
        <if test="workTrtr != null and workTrtr != ''">
            and WORK_TRTR = #{workTrtr}
        </if>
        <if test="aprvType != null and aprvType != ''">
            and APRV_TYPE = #{aprvType}
        </if>
        <if test="aprvEmpNum != null and aprvEmpNum != ''">
            and APRV_EMP_NUMBER = #{aprvEmpNum}
        </if>
        <if test="note != null and note != ''">
            and NOTE = #{note}
        </if>
        <if test="regDate != null and regDate != ''">
            and REGI_DTM = #{regDate}
        </if>
         <if test="startDate != null and startDate != ''">
            and WORK_DT >= #{startDate}
        </if>
         <if test="endDate != null and endDate != ''">
            and #{endDate} >= WORK_DT
        </if>
        <if test="aprvDate != null and aprvDate != ''">
            and APRV_DTM = #{aprvDate}
        </if>
    </select>
    
     <!-- 検索 SQL文（任意条件 件数取得） -->
    <select id="searchMaxPjtNum" resultType="java.lang.Integer" parameterType="PjtDomain">
        select 
                max(PJT_NUM)
        from 
                DNKR_PJT
        where 
                'SqlMap-Pjt.searchCount' = 'SqlMap-Pjt.searchCount'           	
    </select>

    <!-- 登録 SQL文 -->
    <insert id="create" parameterType ="PjtDomain">
        insert into DNKR_PJT (
                /* SqlMap-Pjt.create */
	        <if test="pjtNum != 0">
	            PJT_NUM,
	        </if>
	        <if test="empNumber != null">
	            EMP_NUMBER,
	        </if>
	        <if test="workHour != null">
	            WORK_HOUR,
	        </if>
	        <if test="workCode != null">
	            WORK_TYPE_CD,
	            WORK_TYPE_SML,
	        </if>
	        <if test="workLCode != null">
	            WORK_TYPE_LRG,
	        </if>
	        <if test="workMCode != null">
	            WORK_TYPE_MDM,
	        </if>
	        <if test="relSys != null">
            	RLTN_SYS,
	        </if>
	        <if test="workTrtr != null">
            	WORK_TRTR,
	        </if>
	        <if test="aprvType != null">
            	APRV_TYPE,
	        </if>
	        <if test="aprvEmpNum != null">
            	APRV_EMP_NUMBER,
	        </if>
	        <if test="note != null">
            	NOTE,
	        </if>
	         <if test="workDtlCnts != null">
            	WORK_DTL_CNTS,
	        </if>
	        <if test="aprvDate != null">
            	APRV_DTM,
	        </if>
	            WORK_DT,
	        	REGI_DTM
        ) values (
            <if test="pjtNum != 0">
	            #{pjtNum},
	        </if>
	        <if test="empNumber != null">
	            #{empNumber},
	        </if>
	        <if test="workHour != null">
	            #{workHour},
	        </if>
	        <if test="workCode != null">
	            #{workCode},
	            #{workCode},
	        </if>
	        <if test="workLCode != null">
	            #{workLCode},
	        </if>
	        <if test="workMCode != null">
	            #{workMCode},
	        </if>
	        <if test="relSys != null">
            	#{relSys},
	        </if>
	        <if test="workTrtr != null">
            	#{workTrtr},
	        </if>
	        <if test="aprvType != null">
            	#{aprvType},
	        </if>
	        <if test="aprvEmpNum != null">
            	#{aprvEmpNum},
	        </if>
	        <if test="note != null">
            	#{note},
	        </if>
	        <if test="workDtlCnts != null">
            	#{workDtlCnts},
	        </if>
	        <if test="aprvDate != null">
            	#{aprvDate},
	        </if>
	        <if test="workDate != null">
            	#{workDate},
	        </if>
	        	SYSTIMESTAMP
        )
    </insert>

    <!-- 更新 SQL文（主キー） -->
    <update id="update" parameterType="PjtDomain">
        update 
                DNKR_PJT 
        set
            <if test="empNumber != null and empNumber != ''">
	            EMP_NUMBER = #{workTypeNm},
	        </if>
	        <if test="workDate != null and workDate != ''">
	            WORK_DT = #{workDate},
	        </if>
	        <if test="workCode != null and workCode != ''">
	            WORK_TYPE_CD = #{workCode},
	        </if>
	        <if test="workLCode != null and workLCode != ''">
	            WORK_TYPE_LRG = #{workLCode},
	        </if>
	        <if test="workMCode != null and workMCode != ''">
	            WORK_TYPE_MDM = #{workMCode},
	        </if>
	        <if test="workSCode != null and workSCode != ''">
	            WORK_TYPE_SML = #{workSCode},
	        </if>
	        <if test="relSys != null and relSys != ''">
	            RLTN_SYS = #{relSys},
	        </if>
	        <if test="workTrtr != null and workTrtr != ''">
	            WORK_TRTR = #{workTrtr},
	        </if>
	        <if test="aprvType != null and aprvType != ''">
	            APRV_TYPE = #{aprvType},
	        </if>
	        <if test="aprvEmpNum != null and aprvEmpNum != ''">
	            APRV_EMP_NUMBER = #{aprvEmpNum},
	        </if>
	         <if test="aprvEmpNum != null and aprvEmpNum != ''">
	            APRV_DTM = SYSTIMESTAMP,
	        </if>
	        <if test="note != null and note != ''">
	            NOTE = #{note},
	        </if>
	        <if test="workDtlCnts != null and workDtlCnts != ''">
	            WORK_DTL_CNTS = #{workDtlCnts},
	        </if>
	        <if test="aprvDate != null and aprvDate != ''">
	            APRV_DTM = #{aprvDate}
	        </if>
	        <if test="workHour != null and workHour != ''">
	            WORK_HOUR = #{workHour},
	        </if>
	        <if test="workHour == null or workHour == ''">
	            WORK_HOUR = WORK_HOUR,
	        </if>
	            REGI_DTM = REGI_DTM
	        
        where 
                'SqlMap-Pjt.update' = 'SqlMap-Pjt.update'
            and PJT_NUM = #{pjtNum}
    </update>

    <!-- 削除 SQL文（主キー） -->
    <delete id="delete" parameterType="PjtDomain">
        delete from 
                DNKR_PJT
        where 
                'SqlMap-Pjt.delete' = 'SqlMap-Pjt.delete'
            and PJT_NUM = #{pjtNum}
    </delete>
    
</mapper>