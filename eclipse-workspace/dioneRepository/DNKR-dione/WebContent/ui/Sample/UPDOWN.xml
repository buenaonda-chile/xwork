<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="619" Id="SAMPLE" Left="8" OnLoadCompleted="on_LoadCompleted" PidAttrib="7" Title="UPDOWN" ToolTipFont="Default,0" Top="8" Ver="1.0" Width="1062" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="Dataset0">
				<Contents>
					<colinfo id="cd" size="256" type="STRING"/>
					<colinfo id="cdnm" size="256" type="STRING"/>
					<record>
						<cd></cd>
						<cdnm>선택</cdnm>
					</record>
					<record>
						<cd>C1</cd>
						<cdnm>C1</cdnm>
					</record>
					<record>
						<cd>E1</cd>
						<cdnm>E1</cdnm>
					</record>
					<record>
						<cd>H1</cd>
						<cdnm>H1</cdnm>
					</record>
					<record>
						<cd>S1</cd>
						<cdnm>S1</cdnm>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="Dataset0_0">
				<Contents>
					<colinfo id="cd" size="256" type="STRING"/>
					<colinfo id="cdnm" size="256" type="STRING"/>
					<record>
						<cd></cd>
						<cdnm>선택</cdnm>
					</record>
					<record>
						<cd>C1</cd>
						<cdnm>C1</cdnm>
					</record>
					<record>
						<cd>E1</cd>
						<cdnm>E1</cdnm>
					</record>
					<record>
						<cd>H1</cd>
						<cdnm>H1</cdnm>
					</record>
					<record>
						<cd>S1</cd>
						<cdnm>S1</cdnm>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="Dataset2">
				<Contents>
					<colinfo id="cd" size="256" type="STRING"/>
					<colinfo id="cdnm" size="256" type="STRING"/>
					<record>
						<cd></cd>
						<cdnm>선택</cdnm>
					</record>
					<record>
						<cd>A</cd>
						<cdnm>A</cdnm>
					</record>
					<record>
						<cd>C</cd>
						<cdnm>C</cdnm>
					</record>
					<record>
						<cd>D</cd>
						<cdnm>D</cdnm>
					</record>
					<record>
						<cd>Q</cd>
						<cdnm>Q</cdnm>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_excel_imp">
				<Contents></Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_list2">
				<Contents>
					<colinfo id="cd" size="256" type="STRING"/>
					<colinfo id="cdnm" size="256" type="STRING"/>
					<record>
						<cd>16</cd>
						<cdnm>현장지원</cdnm>
					</record>
					<record>
						<cd></cd>
						<cdnm></cdnm>
					</record>
					<record>
						<cd></cd>
						<cdnm></cdnm>
					</record>
					<record>
						<cd></cd>
						<cdnm></cdnm>
					</record>
					<record>
						<cd></cd>
						<cdnm></cdnm>
					</record>
					<record>
						<cd></cd>
						<cdnm></cdnm>
					</record>
					<record>
						<cd></cd>
						<cdnm></cdnm>
					</record>
					<record>
						<cd></cd>
						<cdnm></cdnm>
					</record>
					<record>
						<cd></cd>
						<cdnm></cdnm>
					</record>
					<record>
						<cd></cd>
						<cdnm></cdnm>
					</record>
					<record>
						<cd></cd>
						<cdnm></cdnm>
					</record>
					<record>
						<cd></cd>
						<cdnm></cdnm>
					</record>
					<record>
						<cd></cd>
						<cdnm></cdnm>
					</record>
					<record>
						<cd></cd>
						<cdnm></cdnm>
					</record>
					<record>
						<cd></cd>
						<cdnm></cdnm>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_list3">
				<Contents>
					<colinfo id="cd" size="256" type="STRING"/>
					<colinfo id="cdnm" size="256" type="STRING"/>
					<record>
						<cd></cd>
						<cdnm></cdnm>
					</record>
					<record>
						<cd></cd>
						<cdnm></cdnm>
					</record>
					<record>
						<cd></cd>
						<cdnm></cdnm>
					</record>
					<record>
						<cd></cd>
						<cdnm></cdnm>
					</record>
					<record>
						<cd></cd>
						<cdnm></cdnm>
					</record>
					<record>
						<cd></cd>
						<cdnm></cdnm>
					</record>
					<record>
						<cd></cd>
						<cdnm></cdnm>
					</record>
					<record>
						<cd></cd>
						<cdnm></cdnm>
					</record>
					<record>
						<cd></cd>
						<cdnm></cdnm>
					</record>
					<record>
						<cd></cd>
						<cdnm></cdnm>
					</record>
					<record>
						<cd></cd>
						<cdnm></cdnm>
					</record>
					<record>
						<cd></cd>
						<cdnm></cdnm>
					</record>
					<record>
						<cd></cd>
						<cdnm></cdnm>
					</record>
					<record>
						<cd></cd>
						<cdnm></cdnm>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_list">
				<Contents>
					<colinfo id="col1" size="256" summ="default" type="STRING"/>
					<colinfo id="col2" size="256" summ="default" type="STRING"/>
					<colinfo id="col3" size="256" summ="default" type="STRING"/>
					<colinfo id="col4" size="256" summ="default" type="STRING"/>
					<colinfo id="col5" size="256" summ="default" type="STRING"/>
					<record>
						<col1>세금계산</col1>
						<col2>세금계산서</col2>
						<col3>20040923</col3>
						<col4>671</col4>
						<col5>0</col5>
					</record>
					<record>
						<col1>AL&#32;ASSY(DC23&#32;65A)</col1>
						<col2>02121-70220P</col2>
						<col3>20040923</col3>
						<col4>671</col4>
						<col5>0</col5>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_main"></Dataset>
		</Datasets>
		<Grid AutoEnter="TRUE" BindDataset="ds_list" BkColor2="default" BoldHead="true" Border="Flat" BorderColor="#b4b4b4" Bottom="200" CellMoving="TRUE" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" FillArea="TRUE" HeadBorder="Flat" HeadHeight="25" Height="136" Id="MainGrid" InputPanel="FALSE" LineColor="#b4b4b4" OnCellClick="onCellCilck" Right="1059" ScrollCell="true" TabOrder="1" TabStop="true" Top="64" UseDBuff="true" UsePopupMenu="true" UseSelColor="FALSE" Visible="true" VLineColor="#b4b4b4" WheelScrollRow="1" Width="1059">
			<contents>
				<format id="Default">
					<columns>
						<col width="223"/>
						<col width="495"/>
						<col width="132"/>
						<col width="100"/>
						<col width="100"/>
					</columns>
					<head>
						<cell bkcolor="#dfdfdf" col="0" color="#002043" display="text" text="DOWNLOAD&#32;내역"/>
						<cell bkcolor="#dfdfdf" col="1" color="#002043" display="text" text="DOWNLOAD&#32;내역"/>
						<cell bkcolor="#dfdfdf" col="2" color="#002043" display="text" text="처리년월"/>
						<cell bkcolor="#dfdfdf" col="3" color="#002043" display="text" text="엑셀"/>
						<cell bkcolor="#dfdfdf" col="4" color="#002043" display="text" text="텍스트"/>
					</head>
					<body>
						<cell align="center" col="0" colid="col1" display="normal"/>
						<cell align="center" col="1" colid="col1" display="normal"/>
						<cell align="center" autosizing="none" col="2" display="text" edit="normal" limit="8" Mask="####-##"/>
						<cell align="center" autosizing="none" col="3" display="button" text="다운로드"/>
						<cell align="center" autosizing="none" col="4" display="button" text="다운로드"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Image FillType="STRETCH" Height="28" Id="titleBar" ImageID="main_tit_bak" Left="-2" TabOrder="4" Width="1060"></Image>
		<Static Color="#333333" Font="돋움,9,Bold" Height="13" Id="title_text" Left="40" TabOrder="2" Text="업로드&#32;&amp;&#32;다운로드&#32;샘플" Top="8" Width="382"></Static>
		<Image Height="28" Id="Image3" ImageID="main_tit_icon" Left="1" OnClick="Image3_OnClick" TabOrder="3" Width="29"></Image>
		<File Bottom="480" Height="24" Id="File" Left="16" Right="40" TabOrder="17" Top="456" Width="24"></File>
		<FileDialog Bottom="480" FileNameList="|" Filter="ALL&#32;File(xls.*)|*.xls" Height="24" Id="FileDialog0" Left="48" MultiSelect="TRUE" Right="72" TabOrder="19" Top="456" Type="Save" Width="24"></FileDialog>
		<Grid AutoEnter="TRUE" BindDataset="ds_main" BkColor2="default" BoldHead="true" Border="Flat" BorderColor="#b4b4b4" Bottom="888" CellMoving="TRUE" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" FillArea="TRUE" HeadBorder="Flat" HeadHeight="25" Height="232" Id="Grid1" InputPanel="FALSE" LineColor="#b4b4b4" OnCellClick="onCellCilck" Right="1059" ScrollCell="true" TabOrder="5" TabStop="true" Top="656" UseDBuff="true" UsePopupMenu="true" UseSelColor="FALSE" Visible="true" VLineColor="#b4b4b4" WheelScrollRow="1" Width="1059">
			<contents>
				<format id="Default">
					<columns>
						<col width="160"/>
						<col width="222"/>
						<col width="132"/>
						<col width="160"/>
						<col width="222"/>
						<col width="132"/>
						<col width="132"/>
					</columns>
					<head>
						<cell bkcolor="#dfdfdf" col="0" color="#002043" display="text"/>
						<cell bkcolor="#dfdfdf" col="1" color="#002043" display="text"/>
						<cell bkcolor="#dfdfdf" col="2" color="#002043" display="text" text="&#32;"/>
						<cell bkcolor="#dfdfdf" col="3" color="#002043" display="text" text="&#32;"/>
						<cell bkcolor="#dfdfdf" col="4" color="#002043" display="text" text="&#32;"/>
						<cell bkcolor="#dfdfdf" col="5" color="#002043" display="text" text="&#32;"/>
						<cell bkcolor="#dfdfdf" col="6" color="#002043" display="text" text="&#32;"/>
					</head>
					<body>
						<cell align="center" col="0" colid="COMPS" display="normal"/>
						<cell align="center" col="1" colid="MAJCD" display="normal"/>
						<cell align="center" autosizing="none" col="2" colid="MJINT" display="text" edit="normal" limit="8" Mask="####-##"/>
						<cell align="center" col="3" colid="MJCHR" display="normal"/>
						<cell align="center" col="4" colid="MAJTM" display="normal"/>
						<cell align="center" autosizing="none" col="5" colid="MAJDT" display="text" edit="normal" limit="8" Mask="####-##"/>
						<cell align="center" autosizing="none" col="6" colid="MAJMK" display="text" edit="normal" limit="8" Mask="####-##"/>
					</body>
				</format>
			</contents>
		</Grid>
	</Form>
	<Script><![CDATA[#include "script::lib_script_common.js";

function on_LoadCompleted(obj)
{
	getTitle();
}

function Button0_OnClick(obj)
{
	//dialog("Group1::MSTZ100FMP.xml", 800, 600);
	var aaa = Grid0.GetCSVData(true);
	alert(aaa);
	
	var ret = ext_Ds2CsvEx("ds_list","",0,0,"$$","\r\n");	
}


function Image3_OnClick(obj,nX,nY)
{
	
}

function Button1_OnClick(obj)
{
	//파일 선택
	FileDialog0.Type = "SAVE";
	if (!FileDialog0.Open()) {
		alert(setPopMessage("1009"));	// 20110103l-koowgnojeel, 1009 == 파일 선택 창을 여는데 실패하였습니다.
		return;
	}
	
	var file_name = FileDialog0.FileName;
	var file_path = FileDialog0.FilePath;
	var path = file_path + "\\" + file_name + ".xls";


	alert(path);
	MainGrid.SaveExcel(path,"sheet1");

}

function ccc(obj)
{
	//파일 선택
	FileDialog0.Type = "SAVE";
	if (!FileDialog0.Open()) {
		alert(setPopMessage("1009"));	// 20110103l-koowgnojeel, 1009 == 파일 선택 창을 여는데 실패하였습니다.
		return;
	}

	var buff;
	var file_name = FileDialog0.FileName;
	var file_path = FileDialog0.FilePath;
	var path = file_path + "\\" + file_name;
	
	File.FileName = path;
	File.Open("r");
	buff = File.Read();
	File.Close();

	Csv2Ds(buff,ds_excel_imp);
}

function Csv2Ds(csv_buff, ds_obj)
{
	var row, col;
	var	arr_rec=array(-1);
	var	arr_col=array(-1);
	var tot_col = 0;	

	ds_excel_imp.ClearData();
	arr_rec = Split(csv_buff, "\r\n");

	for( row = 0 ; row < arr_rec.Length() ; row++ )
	{
		arr_col = Split(arr_rec[row], ",");
		for( col = 0 ; col < arr_col.Length() ; col++ )
		{
			tot_col = col;
		}
	}

	for(i=0; i<=tot_col;i++)
	{
		ds_obj.AddColumn("column"+i);
	}

	addcol(tot_col);

	for( row = 0 ; row < arr_rec.Length() ; row++ )
	{
		arr_col = Split(arr_rec[row], ",");
		ds_obj.AddRow();

		for( col = 0 ; col <= arr_col.Length() ; col++ )
		{
			ds_obj.SetColumn(row, col, arr_col[col]);
		}
	}	
	ds_obj.Row = 0;
	
	alert(ds_excel_imp.colcount);

}

var sContents ;
var cont;
var i = 0;

function addcol(colCnt)
{
	setgrd();
	i=0;
	cont = sContents;
	Grid1.redraw = false;
		for(; i <= toNumber(ds_main.colcount); i++){
			cont = replace(cont,"</columns>","<col width=\"80\"/>\n</columns>");	//컬럼 갯수에 대해 지정합니다.
			cont = replace(cont,"</head>","<cell col=\""+i+"\" display=\"text\" text=\"column"+i+"\"/>\n</head>");	//head에 대한 속성을 지정합니다.
			cont = replace(cont,"</body>","<cell align=\"center\" col=\""+i+"\" colid=\"column"+i+"\" display=\"text\"/>\n</body>");	//body에 대한 속성을 지정합니다.
			trace (i);
		}
	Grid1.contents = cont;
	Grid1.redraw = true;
	trace(cont);
}

function setgrd()
{
	Grid1.redraw = false;
	sContents = "<contents>
					<format id='Default'>
						<columns>
						</columns>
						<head>
						</head>
						<body>
						</body>
					</format>
				</contents>";
				
	Grid1.Contents = sContents;
	Grid1.redraw = true;
}


function on_LoadCompleted(obj)
{
	
}

















// 엑셀파일 다운로드
function onCellCilck(obj,nRow,nCell,nX,nY,nPivotIndex)
{
	if(nCell == 3)
	{
		getDataSet();
		saveExcel();
	}
}


function getDataSet()
{
	ds_main.DeleteAll();
	
	var Lib = "PSEDBLIB";
	http.Sync = true;
	var sKind		= "SEARCH00";						
	var sMethodName = "service::sample/sample.do";     // 서버에서 호출 될 Method 명
	var sInDataSet  = "";                             // 자료 저장 시 보낼 DataSet 명칭
	var sOutDataSet = "ds_main=ds_main";    // 조회 후 돌려 받을 DataSet 명칭
	var arg			= " LIB=" + quote(Lib);
	Transaction(sKind, sMethodName, sInDataSet, sOutDataSet, arg, "");	
}


function saveExcel()
{
	//파일 선택
	FileDialog0.Type = "SAVE";
	if (!FileDialog0.Open()) {
		alert("파일선택창을 여는데 실패하였습니다.");
		return;
	}
	var file_name = FileDialog0.FileName;
	var file_path = FileDialog0.FilePath;
	var path = file_path + "\\" + file_name + ".xls";
	Grid1.SaveExcel(path,"sheet1");
}
]]></Script>
</Window>