<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="619" Id="SAMPLE" Left="8" OnLoadCompleted="on_LoadCompleted" PidAttrib="7" Title="다운로드" ToolTipFont="Default,0" Top="8" Ver="1.0" Width="1062" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_list">
				<Contents>
					<colinfo id="title" size="256" type="STRING"/>
					<colinfo id="text" size="256" type="STRING"/>
					<colinfo id="date" size="256" type="STRING"/>
					<colinfo id="tableNm" size="256" type="STRING"/>
					<colinfo id="gridNm" size="256" type="STRING"/>
					<colinfo id="fileType" size="256" type="STRING"/>
					<record>
						<date></date>
						<fileType></fileType>
						<gridNm>GRD_TABLEA</gridNm>
						<tableNm>SVH454PF</tableNm>
						<text>WIP&#32;REPORT&#32;DOWN</text>
						<title>SVH454PF</title>
					</record>
					<record>
						<date></date>
						<fileType></fileType>
						<gridNm>GRD_TABLEB</gridNm>
						<tableNm>DWH107PF</tableNm>
						<text>영업출하현황&#32;DOWN</text>
						<title>DWHC107CP</title>
					</record>
					<record>
						<date></date>
						<fileType></fileType>
						<gridNm>GRD_TABLEC</gridNm>
						<tableNm>DWH104PF</tableNm>
						<text>&#32;3.지급BOM오류（무상）&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</text>
						<title>DWHC104CP</title>
					</record>
					<record>
						<date></date>
						<fileType></fileType>
						<gridNm>GRD_TABLED</gridNm>
						<tableNm>DWH352PF</tableNm>
						<text>56.가매출CHECK&#32;LIST&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</text>
						<title>DWHC352CP</title>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_main"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_fileType">
				<Contents>
					<colinfo id="code" size="256" summ="default" type="STRING"/>
					<colinfo id="name" size="256" summ="default" type="STRING"/>
					<record>
						<code></code>
						<name>선택</name>
					</record>
					<record>
						<code>1</code>
						<name>엑셀</name>
					</record>
					<record>
						<code>2</code>
						<name>텍스트</name>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_main2"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_list2">
				<Contents>
					<colinfo id="title" size="256" summ="default" type="STRING"/>
					<colinfo id="text" size="256" summ="default" type="STRING"/>
					<colinfo id="date" size="256" summ="default" type="STRING"/>
					<colinfo id="tableNm" size="256" summ="default" type="STRING"/>
					<colinfo id="gridNm" size="256" summ="default" type="STRING"/>
					<colinfo id="fileType" size="256" summ="default" type="STRING"/>
					<record>
						<date>200901</date>
						<fileType></fileType>
						<gridNm>GRD_TABLEA</gridNm>
						<tableNm>DWH251PF</tableNm>
						<text>WIP&#32;REPORT&#32;DOWN</text>
						<title>DWHC251CP</title>
					</record>
					<record>
						<date>20091201</date>
						<fileType></fileType>
						<gridNm>GRD_TABLEB</gridNm>
						<tableNm>TABLEX</tableNm>
						<text>영업출하현황&#32;DOWN</text>
						<title>DWHC107CP</title>
					</record>
				</Contents>
			</Dataset>
		</Datasets>
		<Image FillType="STRETCH" Height="28" Id="titleBar" ImageID="main_tit_bak" Left="-2" TabOrder="3" Width="1060"></Image>
		<Static Color="#333333" Font="돋움,9,Bold" Height="13" Id="title_text" Left="40" TabOrder="1" Text="다운로드" Top="8" Width="910"></Static>
		<Image Height="28" Id="Image3" ImageID="main_tit_icon" Left="1" TabOrder="2" Width="29"></Image>
		<File Bottom="24" Height="24" Id="File" Left="1000" Right="1024" TabOrder="17" Width="24"></File>
		<FileDialog Bottom="24" FileNameList="|" Height="24" Id="FileDialog0" Left="1032" Right="1056" TabOrder="19" Width="24"></FileDialog>
		<Grid AutoEnter="TRUE" BindDataset="ds_main" BkColor2="default" BoldHead="true" Border="Flat" BorderColor="#b4b4b4" Bottom="696" CellMoving="TRUE" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" FillArea="TRUE" HeadBorder="Flat" HeadHeight="25" Height="32" Id="GRD_TABLEB" InputPanel="FALSE" Left="8" LineColor="#b4b4b4" OnCellClick="onCellCilck" Right="320" ScrollCell="true" TabOrder="4" TabStop="true" Top="664" UseDBuff="true" UsePopupMenu="true" UseSelColor="FALSE" Visible="true" VLineColor="#b4b4b4" WheelScrollRow="1" Width="312">
			<contents>
				<format id="Default">
					<columns>
						<col width="50"/>
						<col width="50"/>
					</columns>
					<body>
						<cell align="center" col="0" colid="AKEY" display="normal"/>
						<cell align="center" col="1" colid="ANAME" display="normal"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Grid AutoEnter="TRUE" AutoFitEndLine="Hide" BindDataset="ds_list" BkColor2="default" BoldHead="true" Border="Flat" BorderColor="#b4b4b4" Bottom="328" CellMoving="TRUE" ColSelect="TRUE" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="25" Height="296" Id="grd_board" InputPanel="FALSE" LineColor="#dfdfdf" OnCellClick="onCellCilck" Right="1056" TabOrder="5" TabStop="true" Top="32" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="INACTIVECAPTION" WheelScrollRow="1" Width="1056">
			<contents>
				<format id="Default">
					<columns>
						<col width="219"/>
						<col width="530"/>
						<col width="104"/>
						<col width="100"/>
						<col width="100"/>
					</columns>
					<head>
						<cell bkcolor="#dfdfdf" col="0" color="#002043" display="text" text="다운로드&#32;내역"/>
						<cell bkcolor="#dfdfdf" col="1" color="#002043" display="text" text="설명"/>
						<cell bkcolor="#dfdfdf" col="2" color="#002043" display="text" text="처리년월"/>
						<cell bkcolor="#dfdfdf" col="3" color="#002043" display="text" text="파일형식"/>
						<cell bkcolor="#dfdfdf" col="4" color="#002043" display="text" text="다운로드"/>
					</head>
					<body>
						<cell align="center" col="0" colid="title" display="normal"/>
						<cell align="center" col="1" colid="text" combocol="code1" combodataset="ds_mdtp" combotext="code_name" display="normal"/>
						<cell align="center" autosizing="none" bkcolor="lightcoral" col="2" colid="date" display="date" edit="date" limit="6" LimitDec="0" Mask="yyyy-MM"/>
						<cell align="center" bkcolor="lightcoral" col="3" colid="fileType" combocol="code" combodataset="ds_fileType" combotext="name" display="combo" edit="combo" text="선택"/>
						<cell align="center" bkcolor="lightcoral" col="4" color="#333333" display="text" text="실행"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Grid AutoEnter="TRUE" BindDataset="ds_main" BkColor2="default" BoldHead="true" Border="Flat" BorderColor="#b4b4b4" Bottom="656" CellMoving="TRUE" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" FillArea="TRUE" HeadBorder="Flat" HeadHeight="25" Height="32" Id="GRD_TABLEA" InputPanel="FALSE" Left="8" LineColor="#b4b4b4" OnCellClick="onCellCilck" Right="320" ScrollCell="true" TabOrder="6" TabStop="true" Top="624" UseDBuff="true" UsePopupMenu="true" UseSelColor="FALSE" Visible="true" VLineColor="#b4b4b4" WheelScrollRow="1" Width="312">
			<contents>
				<format id="Default">
					<columns>
						<col width="307"/>
					</columns>
					<body>
						<cell align="center" col="0" colid="PCDATA" display="normal"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Grid AutoFitEndLine="Hide" BindDataset="ds_list2" BkColor2="default" BoldHead="true" Border="Flat" BorderColor="#b4b4b4" Bottom="616" CellMoving="TRUE" ColSelect="TRUE" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="25" Height="280" Id="Grid0" InputPanel="FALSE" LineColor="#dfdfdf" OnCellClick="onCellCilck" Right="1056" TabOrder="7" TabStop="true" Top="336" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="INACTIVECAPTION" WheelScrollRow="1" Width="1056">
			<contents>
				<format id="Default">
					<columns>
						<col width="219"/>
						<col width="530"/>
						<col width="104"/>
						<col width="100"/>
						<col width="100"/>
					</columns>
					<head>
						<cell bkcolor="#dfdfdf" col="0" color="#002043" display="text" text="다운로드&#32;내역"/>
						<cell bkcolor="#dfdfdf" col="1" color="#002043" display="text" text="설명"/>
						<cell bkcolor="#dfdfdf" col="2" color="#002043" display="text" text="처리년월"/>
						<cell bkcolor="#dfdfdf" col="3" color="#002043" display="text" text="파일형식"/>
						<cell bkcolor="#dfdfdf" col="4" color="#002043" display="text" text="다운로드"/>
					</head>
					<body>
						<cell align="center" col="0" colid="title" display="normal"/>
						<cell align="center" col="1" colid="text" combocol="code1" combodataset="ds_mdtp" combotext="code_name" display="normal"/>
						<cell align="center" autosizing="none" col="2" colid="date" display="text" limit="6" LimitDec="0" Mask="####-##"/>
						<cell align="center" bkcolor="lightcoral" col="3" colid="fileType" combocol="code" combodataset="ds_fileType" comboseltext="선택" combotext="name" display="combo" edit="combo" text="선택"/>
						<cell align="center" bkcolor="lightcoral" col="4" color="#333333" display="text" text="실행"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Grid AutoEnter="TRUE" BindDataset="ds_main" BkColor2="default" BoldHead="true" Border="Flat" BorderColor="#b4b4b4" Bottom="848" CellMoving="TRUE" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" FillArea="TRUE" HeadBorder="Flat" HeadHeight="25" Height="144" Id="GRD_TABLEC" InputPanel="FALSE" LineColor="#b4b4b4" OnCellClick="onCellCilck" Right="752" ScrollCell="true" TabOrder="8" TabStop="true" Top="704" UseDBuff="true" UsePopupMenu="true" UseSelColor="FALSE" Visible="true" VLineColor="#b4b4b4" WheelScrollRow="1" Width="752">
			<contents>
				<format id="Default">
					<columns>
						<col width="63"/>
						<col width="68"/>
						<col width="80"/>
						<col width="80"/>
						<col width="80"/>
					</columns>
					<body>
						<cell align="center" col="0" colid="PNITNO" display="normal"/>
						<cell col="1" colid="ITCLS1" display="text"/>
						<cell col="2" colid="PNCITN" display="text"/>
						<cell col="3" colid="RMATC" display="text"/>
						<cell col="4" colid="TRNCON" display="text"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Grid BindDataset="ds_main" BkColor2="default" BoldHead="true" Bottom="664" Enable="true" EndLineColor="default" Height="40" Id="GRD_TABLED" InputPanel="FALSE" Left="336" LineColor="default" Right="664" TabOrder="11" TabStop="true" Top="624" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="328">
			<contents>
				<format id="Default">
					<columns>
						<col width="80"/>
					</columns>
					<body>
						<cell col="0" colid="COMPS" display="normal"/>
					</body>
				</format>
			</contents>
		</Grid>
	</Form>
	<Script><![CDATA[#include "script::lib_script_common.js";

var Lib = "PSCDBLIB";
var returnMSG ;

function on_LoadCompleted(obj)
{
	getTitle();
	ds_fileType.row = 0;
}

function onCellCilck(obj,nRow,nCell,nX,nY,nPivotIndex)
{
	var tableNm = ds_list.GetColumn(nRow,"tableNm");
	var gridNm 	= ds_list.GetColumn(nRow,"gridNm");
	var yyyymm  = ds_list.GetColumn(nRow,"date");
	var fileType  = ds_list.GetColumn(nRow,"fileType");
	var ntitle  = ds_list.GetColumn(nRow,"title");

	if(nCell == 4){
		if(fileType == "1"){
			// 다운로드할 데이터셋 호출
			getDataSet(tableNm,yyyymm);
			// 엑셀파일 다운로드
			saveExcel(gridNm,ntitle,yyyymm);		
		} else if (fileType == "2") {
			// 다운로드할 데이터셋 호출
			getDataSet(tableNm,yyyymm);	
			//  텍스트파일 다운로드
			saveText(gridNm,ntitle,yyyymm);	
		} else {
			alert(setPopMessage("2015"));	// 20110103l-koowgnojeel, 2015 == 파일형식을 선택하세요.
		}
	}  
}


function getDataSet(tableNm,yyyymm)
{
	ds_main.DeleteAll();

	http.Sync 		= true;
	var sKind		= "SEARCH00";						
	var sMethodName = "service::sample/selectDownLoad.do";
	var sInDataSet  = "";
	var sOutDataSet = "ds_main=ds_main";
	var arg			= " LIB=" + quote(Lib) + " TABLENM=" + quote(tableNm) + " YYYYMM=" + quote(yyyymm);

	Transaction(sKind, sMethodName, sInDataSet, sOutDataSet, arg, "");	
	
	alert(ds_main.rowcount);
	
}


function saveExcel(gridNm,ntitle,yyyymm)
{

	FileDialog0.FileName = ntitle + "(" + yyyymm + ")" + ".xls";
	FileDialog0.Filter = "ALL File(xls.*)|*.xls";
	FileDialog0.Type = "SAVE";

	if (!FileDialog0.Open()) {
		//alert("저장경로를 선택하는데 실패하였습니다.");
		return;
	}
	
	var path = FileDialog0.FilePath + "\\" + FileDialog0.FileName + ".xls";
	object(gridNm).SaveExcel(path,"sheet1","A1",false,true);

}


function saveText(gridNm,ntitle,yyyymm)
{
	FileDialog0.FileName = ntitle + "(" + yyyymm + ")" + ".xls";
	FileDialog0.Filter = "ALL File(txt.*)|*.txt";
	FileDialog0.Type = "SAVE";
	if (!FileDialog0.Open()) {
		//alert("저장경로를 선택하는데 실패하였습니다.");
		return;
	}

	var path = FileDialog0.FilePath + "\\" + FileDialog0.FileName + ".txt";
	
	file.FileName = path;
	file.open("wt");
	
	var buff = "";
	for(i=0; i<ds_main.rowcount; i++)
	{
		for(j=0; j<ds_main.colcount; j++)
		{
			//RPad(strString,strPadChar,nCount);
			buff += ds_main.GetColumn(i,j);
		}
		buff += "\r\n";
	}
	file.Write(buff); 
	//alert(returnMSG);
	/*
	RPad(strString,strPadChar,nCount);
	
	▣ Parameters 
	strString (String) : 원본 문자열. 
	strPadChar (String) : 오른쪽에 채울 문자. 입력된 문자열의 첫 1글자만을 사용합니다. 
	nCount (Integer) : 출력될 문자열의 길이. 
	ex)Rpad("ab", "?", 4);	
	*/
}


function fn_CallBack(sMethodName, ErrorCode, ErrorMSG) {
	if(ErrorCode != 0)
	{
		returnMSG = ErrorMSG;
	} else {
		returnMSG = "처리되었습니다.                 ";
	}
}










]]></Script>
</Window>