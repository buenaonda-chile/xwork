<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="584" Id="UserList" Left="8" OnLoadCompleted="on_LoadCompleted" PidAttrib="7" Title="사용자권한" TooltipFont="Default,0" Top="8" Ver="1.0" Width="528" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_menuAuth">
				<Contents></Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_menuAuthGroup"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_ComCode_PWCP">
				<Contents>
					<colinfo id="cd" size="256" summ="default" type="STRING"/>
					<colinfo id="cdnm" size="256" summ="default" type="STRING"/>
					<record>
						<cd>00</cd>
						<cdnm>공통</cdnm>
					</record>
					<record>
						<cd>PS</cd>
						<cdnm>PS</cdnm>
					</record>
					<record>
						<cd>PE</cd>
						<cdnm>PE</cdnm>
					</record>
					<record>
						<cd>0S</cd>
						<cdnm>공통_PS</cdnm>
					</record>
					<record>
						<cd>0E</cd>
						<cdnm>공통_PE</cdnm>
					</record>
					<record>
						<cd>KR</cd>
						<cdnm>KR</cdnm>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_tmenuLev"></Dataset>
		</Datasets>
		<Static BKColor="white" Border="Flat" BorderColor="#b4b4b4" Height="29" Id="searchBar" Left="1" TabOrder="10" Top="30" Width="523"></Static>
		<Static BKColor="#dfdfdf" Border="Flat" BorderColor="#b4b4b4" Height="25" Id="Static2" Left="272" TabOrder="14" Top="32" Width="91"></Static>
		<Static BKColor="#dfdfdf" Border="Flat" BorderColor="#b4b4b4" Height="25" Id="Static5" Left="3" TabOrder="9" Top="32" Width="91"></Static>
		<Image FillType="STRETCH" Height="28" Id="titleBar" ImageID="main_tit_bak" Left="-2" TabOrder="4" Width="527"></Image>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" AutoFitEndLine="Hide" BindDataset="ds_menuAuth" BkColor2="default" BoldHead="true" Border="Flat" BorderColor="#888888" Bottom="582" CellMoving="TRUE" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="25" Height="518" Id="menuGrd2" InputPanel="FALSE" LineColor="#888888" MinWidth="100" OnHeadDBLClick="allCehck" Right="524" TabOrder="1" TabStop="true" Top="64" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="#94c1ea" WheelScrollRow="1" Width="524">
			<contents>
				<format id="Default">
					<columns>
						<col width="150"/>
						<col width="150"/>
						<col width="150"/>
						<col width="70"/>
					</columns>
					<head>
						<cell bkcolor="#dfdfdf" col="0" color="#002043" display="text" text="대메뉴"/>
						<cell bkcolor="#dfdfdf" col="1" color="#002043" display="text" text="중메뉴"/>
						<cell bkcolor="#dfdfdf" col="2" color="#002043" display="text" text="소메뉴"/>
						<cell bkcolor="#dfdfdf" col="3" color="#002043" display="text" text="메뉴권한"/>
					</head>
					<body>
						<cell align="left" col="0" colid="STEP1_NAME" display="normal" suppress="1" SuppressAlign="Middle"/>
						<cell align="left" col="1" colid="STEP2_NAME" display="normal" suppress="2" SuppressAlign="Middle"/>
						<cell align="left" autosizing="none" col="2" colid="STEP3_NAME" display="normal"/>
						<cell align="center" bkcolor="lightcoral" col="3" colid="USER_YN" display="checkbox" edit="checkbox" LimitDec="0"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Button Cursor="HAND" Height="20" Id="Button3" ImageID="comBtn_save" Left="464" OnClick="fn_save" TabOrder="2" Text="검색" Top="4" Width="51"></Button>
		<Static Align="Center" Color="#333333" Font="돋움,9,Bold" Height="13" Id="title_user" Left="40" TabOrder="3" Top="8" Width="104"></Static>
		<Static Color="#333333" Font="돋움,9" Height="13" Id="Static0" Left="152" TabOrder="5" Text="메뉴권한&#32;정보" Top="8" Width="104"></Static>
		<Combo Border="Flat" BorderColor="SCROLLBAR" CodeColumn="MENU_ID" Color="#333333" DataColumn="MENU_NAME" Height="24" Id="cb_group" ImeMode="none" INDEX="0" InnerDataset="ds_menuAuthGroup" Left="94" OnChanged="companyChange" ResetIndex="FIRST" TabOrder="6" Top="32" Width="157"></Combo>
		<Shape BKColor="#888888" Bottom="46" Height="5" Id="Shape2" Left="15" LineColor="#dceaf7" Right="20" TabOrder="7" Top="41" Type="Ellipse" Width="5"></Shape>
		<Static Border="None" Color="#333333" Font="굴림,9,Bold" Height="16" Id="Static6" Left="25" Style="static" TabOrder="8" Text="대메뉴" Top="37" VAlign="Middle" Width="69"></Static>
		<Shape BKColor="#888888" Bottom="46" Height="5" Id="Shape0" Left="284" LineColor="#dceaf7" Right="289" TabOrder="12" Top="41" Type="Ellipse" Width="5"></Shape>
		<Static Border="None" Color="#333333" Font="굴림,9,Bold" Height="16" Id="Static1" Left="294" Style="static" TabOrder="13" Text="사업부" Top="37" VAlign="Middle" Width="69"></Static>
		<Combo Border="Flat" BorderColor="SCROLLBAR" CodeColumn="cd" Color="#333333" DataColumn="cdnm" Height="24" Id="Combo0" ImeMode="none" INDEX="0" InnerDataset="ds_ComCode_PWCP" Left="363" OnChanged="companyChange" ResetIndex="FIRST" TabOrder="11" Top="32" Width="157"></Combo>
	</Form>
	<Script><![CDATA[ /*--------------------------------------------------------------
 * @version               : 1.0 
 * @author                : 황규철
 * @see
 * ● SYSTEM NAME          : DIONE
 * ● PROGRAM NO.          : UserAuth.xml
 * ● PROGRAM DESCRIPTION  : 사용자 권한 관리
 * ● DATE WRITTEN         : 2010.11.11
----------------------------------------------------------------*/

#include "script::lib_script_common.js";


/********************************************************************** 
 * 개 발 자 : 황규철 
 * 개발일자 : 2010-11-26
 * 내용설명 : 화면 로드
 * 주요변수 : 
 **********************************************************************/ 
 /*
function on_LoadCompleted(obj)
{

	title_user.Value = USER_ID;

	http.Sync 	= true;

	Transaction("getUserAuthGroup", "service::user/menuAuthGroup.do", "", "ds_menuAuthGroup=ds_menuAuthGroup", "", "");	

	ds_menuAuthGroup.InsertRow(0);
	ds_menuAuthGroup.SetColumn(0,"MENU_ID","");
	ds_menuAuthGroup.SetColumn(0,"MENU_NAME","[전체]");
	cb_group.index = 0;	
	

	var sKind		= "getUserAuth";		
	var sMethodName = "service::user/menuAuth.do";  					
	var sInDataSet  = "";
	var sOutDataSet = "ds_menuAuth=ds_menuAuth";
	var sArgument   = "";
		sArgument   += " USER_ID=" + quote(USER_ID);
	Transaction(sKind, sMethodName, sInDataSet, sOutDataSet, sArgument, "");
		

}
*/
//2012.04.09 제환복변경 
//사유 : MRP메뉴 추가
function on_LoadCompleted(obj)
{
	var TOP_MENU =getTmenuLev(); //return 값을 변수로 사용함. 2012.04.09 제환복 추가

	title_user.Value = USER_ID;

	http.Sync 	= true;

	Transaction("getUserAuthGroup", "service::user/menuAuthGroup.do", "", "ds_menuAuthGroup=ds_menuAuthGroup", " TOP_MENU=" + quote(TOP_MENU), "");	

	ds_menuAuthGroup.InsertRow(0);
	ds_menuAuthGroup.SetColumn(0,"MENU_ID","");
	ds_menuAuthGroup.SetColumn(0,"MENU_NAME","[전체]");
	cb_group.index = 0;	
	


	var sKind		= "getUserAuth";		
	var sMethodName = "service::user/menuAuth.do";  					
	var sInDataSet  = "";
	var sOutDataSet = "ds_menuAuth=ds_menuAuth";
	var sArgument   = "";
		sArgument   += " USER_ID=" + quote(USER_ID);
		sArgument   += " TOP_MENU=" + quote(TOP_MENU);//추가
	Transaction(sKind, sMethodName, sInDataSet, sOutDataSet, sArgument, "");

}

/* 스크립트로 전환
#include "script::lib_script_common.js";

function getTmenuLev(){
	var sKind		= "getTmenuLev";						
	var sMethodName = "service::user/selectTmenuLev.do";  					
	var sInDataSet  = "";
	var sOutDataSet = "ds_tmenuLev=ds_tmenuLev";
	var sArgument   = "";
	http.Sync=true;
	Transaction(sKind, sMethodName, sInDataSet, sOutDataSet, sArgument, "");
	http.Sync=false;
	
	var topVal="('";	//treemenu에 해당하는 menu값
	var topLevel="";	//level값
	var chklev="";	//indexOf의 return 값
	var chkval="m"; //체크 문자열
	var chkcnt=0;
	for (i=0; i<ds_tmenuLev.GetRowCount(); i++){
		topLevel = ds_tmenuLev.GetColumn(i,"TOP_MENU");
		chklev=indexOf(topLevel,chkval);
		if(chklev!=-1){
			if(chkcnt!=0){
				topVal+="', '";
			}
			topVal+=topLevel;
			chkcnt=1;
		}
	}
	if(length(topVal)==2){
		topVal+="1')"; //topmenu level 1은 무조건 포함됨.
	}
	else {
		topVal+="', '1')";
	}
	
	return topVal;
}
*/
/*
function getTmenuLev(){
	var sKind		= "getTmenuLev";						
	var sMethodName = "service::user/selectTmenuLev.do";  					
	var sInDataSet  = "";
	var sOutDataSet = "ds_tmenuLev=ds_tmenuLev";
	var sArgument   = "";
	http.Sync=true;
	Transaction(sKind, sMethodName, sInDataSet, sOutDataSet, sArgument, "");
	http.Sync=false;
	
	var topVal="(";	//treemenu에 해당하는 menu값
	var topNgVal="(";	//treemenu에 제외되는 menu값
	var topLevel="";	//level값
	var chklev="";	//indexOf의 return 값
	var chkval="m"; //체크 문자열
	var chkcnt=0;
	var chkNgcnt=0;
	for (i=0; i<ds_tmenuLev.GetRowCount(); i++){
		topLevel = ds_tmenuLev.GetColumn(i,"TOP_MENU");
		chklev=indexOf(topLevel,chkval);
//alert("chklev==>"+chklev);
//alert("topLevel==>"+topLevel);
		if(chklev!=-1){
			if(chkcnt!=0){
				topVal+=",";
			}
			topVal+=topLevel;
			chkcnt=1;
		}
		else if(chklev==-1){
			if(chkNgcnt!=0){
				topNgVal+=",";
			}
			topNgVal+=topLevel;
			chkNgcnt=1;
		}
	}
	topVal+=")";
	topNgVal+=")";
	alert("topVal==>"+topVal+"topNgVal==>"+topNgVal);
}
*/

//여기까지
/********************************************************************** 
 * 개 발 자 : 황규철 
 * 개발일자 : 2010-11-26
 * 내용설명 : 전체 체크
 * 주요변수 : 
 **********************************************************************/ 
var chkStatus = 0;
function allCehck(obj,nCell,nX,nY,nPivotIndex)
{
	chkStatus = 1 - chkStatus;
	for(i=0;i<ds_menuAuth.rowcount;i++){
		ds_menuAuth.SetColumn(i,"USER_YN",chkStatus) ;
	}
}

/********************************************************************** 
 * 개 발 자 : 황규철 
 * 개발일자 : 2010-11-26
 * 내용설명 : 화면 저장
 * 주요변수 : 
 **********************************************************************/ 
function fn_save(obj)
{
	var sKind		= "setMenuAuth";						
	var sMethodName = "service::user/saveMenuAuth.do";
	var sInDataSet  = "ds_menuAuth=ds_menuAuth:U";
	var sOutDataSet = "";
	Transaction(sKind, sMethodName, sInDataSet, sOutDataSet, "", "callback");
}

/********************************************************************** 
 * 개 발 자 : 황규철 
 * 개발일자 : 2010-11-26
 * 내용설명 : Transaction 리턴후 실행 함수
 * 주요변수 : 
 * 			- sMethodName	Transaction 고유 ID
 * 			- ErrorCode 	에러코드
 * 			- ErrorMSG 		에러 메세지
 **********************************************************************/ 
function callback(svcId, rtnCd, rtnMsg){
	if(rtnCd == 0){
		alert(setPopMessage("2005"));	// 20110103l-koowgnojeel, 2005 == 처리 되었습니다.
		Close();
	}
}


/********************************************************************** 
 * 개 발 자 : 황규철 
 * 개발일자 : 2010-11-26
 * 내용설명 : 그리드 필터링
 * 주요변수 : 
 **********************************************************************/ 
function groupChange(obj,strCode,strText,nOldIndex,nNewIndex)
{
	if(cb_group.Value == ""){
		ds_menuAuth.UnFilter();
		ds_menuAuth.Filter("COMPANY=='" + Combo0.Value + "'" );		
	} else {
		ds_menuAuth.Filter("STEP1_CODE=='" + cb_group.Value + "' && COMPANY=='" + Combo0.Value + "'" );
	}
}


function companyChange(obj,strCode,strText,nOldIndex,nNewIndex)
{
	if(Combo0.Value == "00"){
		if(cb_group.Value == ""){
			ds_menuAuth.UnFilter();
		} else {
			ds_menuAuth.Filter("STEP1_CODE=='" + cb_group.Value + "'" );
		}
	}else if(Combo0.Value == "0S"){
		if(cb_group.Value == ""){
			ds_menuAuth.Filter("COMPANY== '00' || COMPANY== 'PS'" );
		} else {
			ds_menuAuth.Filter("STEP1_CODE=='" + cb_group.Value + "' && (COMPANY== '00' || COMPANY== 'PS')");
		}
	}else if(Combo0.Value == "0E"){
		if(cb_group.Value == ""){
			ds_menuAuth.Filter("COMPANY== '00' || COMPANY== 'PE'" );
		} else {
			ds_menuAuth.Filter("STEP1_CODE=='" + cb_group.Value + "' && (COMPANY== '00' || COMPANY== 'PE')");
		}
	}else {
		if(cb_group.Value == ""){
			ds_menuAuth.Filter("COMPANY=='" + Combo0.Value + "'" );
		} else {
			ds_menuAuth.Filter("STEP1_CODE=='" + cb_group.Value + "' && COMPANY=='" + Combo0.Value + "'");
		}
	}	
	
}]]></Script>
</Window>