<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="624" Id="userList" Left="8" OnFocus="menu_OnFocus" OnLoadCompleted="on_LoadCompleted" PidAttrib="7" Title="경비예산TX&#32;항목생성" TooltipFont="Default,0" Top="8" Ver="1.0" Width="1062" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_ComCode_PLNT">
				<Contents>
					<colinfo id="CODE2" size="256" summ="default" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_yyyy">
				<Contents>
					<colinfo id="yyyy" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_GUB">
				<Contents>
					<colinfo id="CODE" size="256" summ="default" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" summ="default" type="STRING"/>
					<record>
						<CODE>P0</CODE>
						<CODE_NAME>년계획</CODE_NAME>
					</record>
					<record>
						<CODE>P1</CODE>
						<CODE_NAME>수정계획</CODE_NAME>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_SEND" UseClientLayout="1">
				<Contents>
					<colinfo id="CATNO" size="256" summ="default" type="STRING"/>
					<colinfo id="VNDNR" size="256" summ="default" type="STRING"/>
					<colinfo id="COMPE" size="256" summ="default" type="STRING"/>
					<colinfo id="NEWIT" size="256" summ="default" type="STRING"/>
					<colinfo id="CATQY" size="256" summ="default" type="STRING"/>
					<colinfo id="CATAM" size="256" summ="default" type="STRING"/>
					<colinfo id="AMT04" size="256" summ="default" type="STRING"/>
					<colinfo id="AMT05" size="256" summ="default" type="STRING"/>
					<colinfo id="AMT06" size="256" summ="default" type="STRING"/>
					<colinfo id="AMT07" size="256" summ="default" type="STRING"/>
					<colinfo id="AMT08" size="256" summ="default" type="STRING"/>
					<colinfo id="AMT09" size="256" summ="default" type="STRING"/>
					<colinfo id="AMT10" size="256" summ="default" type="STRING"/>
					<colinfo id="AMT11" size="256" summ="default" type="STRING"/>
					<colinfo id="AMT12" size="256" summ="default" type="STRING"/>
					<colinfo id="AMT01" size="256" summ="default" type="STRING"/>
					<colinfo id="AMT02" size="256" summ="default" type="STRING"/>
					<colinfo id="AMT03" size="256" summ="default" type="STRING"/>
					<colinfo id="R2294" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_MIZ230"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_ERCHK">
				<Contents>
					<colinfo id="X" size="256" summ="default" type="STRING"/>
					<colinfo id="Y" size="256" summ="default" type="STRING"/>
					<colinfo id="ERRNM" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_MIZZ220"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_MST650PF"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_MIZZ229UC_CHECK"></Dataset>
		</Datasets>
		<Image FillType="STRETCH" Font="돋움,9,Bold" Height="28" Id="titleBar" ImageID="main_tit_bak" Left="-2" TabOrder="1" Width="1060"></Image>
		<Static Color="#333333" Font="돋움,9,Bold" Height="13" Id="title_text" Left="16" TabOrder="1" Top="8" Width="1032"></Static>
		<FileDialog AppendExtDefault="TRUE" Bottom="24" FileNameList="|" Filter="ALL&#32;File(xls.*)|*.xls" Height="24" Id="FileDialog0" Left="1000" Right="1024" TabOrder="4" Type="Save" Width="24"></FileDialog>
		<File Bottom="24" Height="24" Id="File" Left="1032" Right="1056" TabOrder="3" Width="24"></File>
		<Static BKColor="white" Border="Flat" BorderColor="#b4b4b4" Height="304" Id="searchBar1" Left="256" TabOrder="2" Top="136" Width="512"></Static>
		<Button Height="27" Id="btnSave" ImageID="sum_save" Left="496" OnClick="setMIZZ229UC" TabOrder="2" TabStop="FALSE" Text="Button2" Top="392" Width="72"></Button>
		<Static Border="Flat" BorderColor="#b4b4b4" Color="#333333" Font="굴림,9,Bold" Height="26" Id="Static1" Left="436" Style="static" TabOrder="5" Top="155" VAlign="Middle" Width="96"></Static>
		<Static Align="Center" BKColor="lightsalmon" Border="Flat" BorderColor="#b4b4b4" Font="Default,9,Bold" Height="26" Id="Static4" Left="320" TabOrder="5" Text="사&#32;&#32;&#32;업&#32;&#32;&#32;부" Top="155" VAlign="Middle" Width="116"></Static>
		<Combo CodeColumn="code2" DataColumn="code_name" Height="19" Id="ComboBoxPlant" INDEX="0" InnerDataset="ds_ComCode_PLNT" Left="440" OnChanged="ComboBoxPlant_OnChanged" TabOrder="3" Top="158" Width="88"></Combo>
		<Static Align="Center" BKColor="lightsalmon" Border="Flat" BorderColor="#b4b4b4" Font="Default,9,Bold" Height="26" Id="Static3" Left="320" TabOrder="6" Text="년&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;도" Top="196" VAlign="Middle" Width="116"></Static>
		<Static Border="Flat" BorderColor="#b4b4b4" Color="#333333" Font="굴림,9,Bold" Height="26" Id="Static5" Left="436" Style="static" TabOrder="6" Top="196" VAlign="Middle" Width="96"></Static>
		<Combo CodeColumn="yyyy" DataColumn="yyyy" Height="19" Id="cmb_yyyy" InnerDataset="ds_yyyy" Left="440" OnChanged="common_OnChanged" TabOrder="4" Top="199" Width="88"></Combo>
		<Static Border="None" BorderColor="#b4b4b4" Color="#333333" Font="굴림,9" Height="70" Id="Static0" Left="320" Style="static" TabOrder="10" Text="▶&#32;상반기&#13;&#10;&#32;&#32;&#32;&#32;전년&#32;상반기&#32;확정예산의&#32;항목만&#32;생성합니다.&#32;금액은&#32;zero&#13;&#10;&#13;&#10;▶&#32;하반기&#13;&#10;&#32;&#32;&#32;&#32;작업년도&#32;4~9월은&#32;실적&#32;,&#32;10~3월은&#32;상반기확정예산을&#32;생성합니다." Top="306" VAlign="Middle" Width="384"></Static>
		<Static Align="Center" BKColor="lightsalmon" Border="Flat" BorderColor="#b4b4b4" Font="Default,9,Bold" Height="26" Id="Static2" Left="320" TabOrder="11" Text="상하반기&#32;구분" Top="234" VAlign="Middle" Width="116"></Static>
		<Static Border="Flat" BorderColor="#b4b4b4" Color="#333333" Font="굴림,9,Bold" Height="26" Id="Static6" Left="436" Style="static" TabOrder="12" Top="234" VAlign="Middle" Width="96"></Static>
		<Combo CodeColumn="CODE" DataColumn="CODE_NAME" Height="19" Id="cmb_CATGB" INDEX="0" InnerDataset="ds_GUB" Left="440" OnChanged="common_OnChanged" TabOrder="5" Top="237" Width="88"></Combo>
		<Static Align="Center" BKColor="lightsalmon" Border="Flat" BorderColor="#b4b4b4" Font="Default,9,Bold" Height="26" Id="Static9" Left="320" TabOrder="15" Text="부&#32;서&#32;선&#32;택" Top="274" VAlign="Middle" Width="116"></Static>
		<Static Border="Flat" BorderColor="#b4b4b4" Color="#333333" Font="굴림,9,Bold" Height="26" Id="Static10" Left="436" Style="static" TabOrder="16" Top="274" VAlign="Middle" Width="96"></Static>
		<Edit Height="19" Id="ed_DPTCD" Left="440" MaxLength="4" Number="TRUE" OnChanged="ed_DPTCD_OnChanged" TabOrder="17" Top="278" Width="88"></Edit>
		<Static Height="18" Id="st_DPTCD" Left="538" TabOrder="18" Top="279" VAlign="Middle" Width="158"></Static>
		<Pie Height="2" Id="Pie0" Left="538" LineColor="SCROLLBAR" TabOrder="19" Top="298" Width="157"></Pie>
	</Form>
	<Script><![CDATA[/*--------------------------------------------------------------
 * @@version               : 1.0 
 * @@Revision History      :
 * @@author                : LSK
 * @@see
 * ● SYSTEM NAME          : Denso Platform
 * ● PROGRAM NO.          : MIZZ229UC.xml
 * ● PROGRAM DESCRIPTION  : 기초경비예산 Host up
 * ● DATE WRITTEN         : 2016.06.23
 ----------------------------------------------------------------*/
#include "script::lib_script_common.js";
#include "script::Grid_Script.js";
#include "script::spare_common.js";

var strSeparator = "	";
var Lib1 = G_ds_user.GetColumn(0,"LIB1"); // cigma library(pereslib,psreslib)
var Lib2 = G_ds_user.GetColumn(0,"LIB2"); // 회사 library(psedblib,pscdblib)
var Lib3 = G_ds_user.GetColumn(0,"LIB3"); // 사업부 library(psedblib,pscdblib,pshdblib,pssdblib)
var company = G_ds_user.GetColumn(0,"COMPANY");
var comps = G_ds_user.GetColumn(0,"PLANT_CD");
var nowDate = today();

function on_LoadCompleted(obj){
	getTitle();
	//getDesign();
	getComCode();	
	SetYYYY13(substr(nowDate,0,4),ds_yyyy);
	cmb_yyyy.Value = substr(nowDate,0,4);
	gFcOnTopButtonColor("0"); //상단 버튼 활성화 여부 (조회,저장,excel)	
	if(ComboBoxPlant.Value == "E1"){
		ed_DPTCD.Text = "1700";
	}else if(ComboBoxPlant.Value == "C1"){
		ed_DPTCD.Text = "3004";
	}else if(ComboBoxPlant.Value == "H1"){
		ed_DPTCD.Text = "3286";
	}else if(ComboBoxPlant.Value == "S1"){
		ed_DPTCD.Text = "2204";
	}else{
		ed_DPTCD.Text = "9999";
	}
	ed_DPTCD_OnChanged(ed_DPTCD,ed_DPTCD.Text);
}

function getComCode(){
	setCompsName(ds_ComCode_PLNT);
	//ds_ComCode_PLNT.InsertRow(0);
	//ds_ComCode_PLNT.SetColumn(0,"CODE2","");
	//ds_ComCode_PLNT.SetColumn(0,"CODE_NAME","[전체]");
	ComboBoxPlant.Value=comps;
}

function getCategory(){
	
	var sKind		= "getCategory";						
	var sMethodName = "service::budget/getCategoryList"; 
	var sInDataSet  = "";
	var sOutDataSet = "ds_Category=ds_Category";
	var sArgument   = "";
	http.Sync=true;
	Transaction(sKind, sMethodName, sInDataSet, sOutDataSet, sArgument, "");
	http.Sync=false;
	ds_Category.InsertRow(0);
	ds_Category.SetColumn(0,"CD","");
	ds_Category.SetColumn(0,"CDNM","[전체]");
	cmb_Category.index = 0;	
}

function getDesign(){
	//MainGrid_229UP.ToolTipText = setPopMessage("2053");
	//MainGrid_229UP.BkColor = G_ds_design.GetColumn(0,"BkColor");
	//MainGrid_229UP.BkColor2 = G_ds_design.GetColumn(0,"BkColor2");
	//MainGrid_229UP.BkSelColor = G_ds_design.GetColumn(0,"BkSelColor");
	//MainGrid_229UP.Face3dColor = G_ds_design.GetColumn(0,"Face3dColor");

	//searchBar.Width = G_ds_design.GetColumn(0,"Width");           //1048
	//searchBar.Top = G_ds_design.GetColumn(0,"SBTop");	          //32
	//searchBar.Height = G_ds_design.GetColumn(0,"SBHeight");	      //29
}

 /********************************************************************** 
 * 내용설명 : Excel data Host UP
 **********************************************************************/  
function setMIZZ229UC(){
	// 확정 유무 Check
	if (!checkMIZ230()){
		alert("[경고] 경비예산이 확정되어 진행할 수 없습니다. 확인바랍니다."); 
		return;
	}
	
	if(confirm("기존data는 삭제합니다. 생성하시겠습니까? ") == false) return;
	
	var targetCATGB;
	var targetYYYY;
	if(cmb_CATGB.Value == "P0") {
		targetYYYY = toNumber(cmb_yyyy.Value) - 1;
		targetCATGB ="P0"; // 전년 확정계획
	}else if(cmb_CATGB.Value == "P1") {
		targetYYYY = toNumber(cmb_yyyy.Value);
		targetCATGB ="A0"; // 실적
	}else{
		alert("[경고] System오류. "); 
		return;
	}
	var sKind		= "setMIZZ229UC";						
	var sMethodName = "service::budget/setMIZZ229UCList";     // 서버에서 호출 될 Method 명
	var sInDataSet  = "ds_SEND=ds_SEND";     
	var sOutDataSet = "ds_MIZZ229UP_CHECK=ds_MIZZ229UP_CHECK";     
	var sArgument   = "";
		sArgument += " COMPS=" + quote(ComboBoxPlant.Value);
		sArgument += " CATYY=" + quote(cmb_yyyy.Value);
		sArgument += " CATGB=" + quote(cmb_CATGB.Value);
		sArgument += " DPTCD=" + quote(ed_DPTCD.Text);
		sArgument += " USERID=" + quote(trim(G_ds_user.GetColumn(0,"USER_ID")));
		sArgument += " CATGB_YYYY=" + quote(targetYYYY);      // 전년계획 or 상반기계획
		sArgument += " CATGB_TARGET=" + quote(targetCATGB);   // P0:상반기예산
	http.Sync=true;
	Transaction(sKind, sMethodName, sInDataSet, sOutDataSet, sArgument, "callback");
	http.Sync=false;
}

/********************************************************************** 
 * 내용설명 : Transaction 리턴후 실행 함수
 * 주요변수 : 
 * 			- sMethodName	Transaction 고유 ID
 * 			- ErrorCode 	에러코드
 * 			- ErrorMSG 		에러 메세지
 **********************************************************************/ 
function callback(svcId, rtnCd, rtnMsg){
	if (ds_MIZZ229UC_CHECK.GetRowCount() > 0){
		for(var i=0;i<ds_MIZZ229UC_CHECK.GetRowCount();i++){
			alert("항목코드 : " +ds_MIZZ229UC_CHECK.GetColumn(i,"CATNO") + " = " + ds_MIZZ229UC_CHECK.GetColumn(i,"RTMSG"));
		}
		getMIZZ229UC();  //error항목이 존재시에는 재조회
		return;
	}// tran 실패
	if(rtnCd<0){
		alert(setPopMessage("1002"));
		setMessage("1002");
	}else{
		alert(setPopMessage("1001"));
		setMessage("1001");	
	}
}

/********************************************************************** 
 * 내용설명 : 확정Check
 **********************************************************************/ 
 function checkMIZ230(){
	http.Sync = true;
	var sKind		= "getMIZZ230";						
	var sMethodName = "service::budget/getMIZZ230List";     		// 서버에서 호출 될 Method 명
	var sInDataSet  = "";                            				// 자료 저장 시 보낼 DataSet 명칭
	var sOutDataSet = "ds_MIZ230=ds_MIZ230";    				// 조회 후 돌려 받을 DataSet 명칭
	var sArgument   = "";
		sArgument += " COMPS=" + quote(ComboBoxPlant.Value);
		sArgument += " CATYY=" + quote(cmb_yyyy.Value);
		sArgument += " CATGB=" + quote(cmb_CATGB.Value);   //P0:상반기예산  P1:하반기예산 
	Transaction(sKind, sMethodName, sInDataSet, sOutDataSet, sArgument, "");
	http.Sync = false;
	if(ds_MIZ230.rowcount > 0){
		return false;
	}else{
		return true;
	}
 }
 
/********************************************************************** 
 * 내용설명 : 엑셀파일로 저장
 **********************************************************************/ 
function setExcel()
{
}

function common_OnChanged(obj,strText)
{
	ds_MST650PF.ClearData();
}

 /*--------------------------------------------------------------
 * 아래 함수는 콩통함수 이므로 모든 화면에 필요
 * 함수명 변경 불가
 * 버튼 컨트롤
----------------------------------------------------------------*/
function fn_Favorite()
{
	alert("fn_Favorite");
}

function fn_Search()
{
	alert(setPopMessage("9999"));
	setMessage("9999");
}

function fn_Input()
{
	alert(setPopMessage("9999"));
	setMessage("9999");
}

function fn_Delete()
{
	alert(setPopMessage("9999"));
	setMessage("9999");
}

function fn_Save()
{
	alert(setPopMessage("9999"));
	setMessage("9999");
}

function fn_print()
{
	alert(setPopMessage("9999"));
	setMessage("9999");
}

function fn_Excel()
{
	alert(setPopMessage("9999"));
	setMessage("9999");
}

function fn_Help()
{
	alert(setPopMessage("9999"));
	setMessage("9999");
}

function menu_OnFocus(obj)
{
	gFcOnTopButtonColor("0");
}





function ed_DPTCD_OnKillFocus(obj)
{
	var sKind		= "getMST650PF";						
	var sMethodName = "service::budget/getMST650PF"; 
	var sInDataSet  = "";
	var sOutDataSet = "ds_MST650PF=ds_MST650PF";
	var sArgument   = "";
	http.Sync=true;
	Transaction(sKind, sMethodName, sInDataSet, sOutDataSet, sArgument, "");
	http.Sync=false;
}

function ed_DPTCD_OnChanged(obj,strText)
{
	if(length(trim(strText)) == 4){
		var Lib9="";
		if(ComboBoxPlant.Value == "E1"){
			Lib9="PSEDBLIB";
		}else if(ComboBoxPlant.Value == "R1"){
			Lib9="PSRDBLIB";
		}else{
			Lib9="PSCDBLIB";
		}
		var sKind		= "getMST650PFList";						
		var sMethodName = "service::budget/getMST650PFList"; 
		var sInDataSet  = "";
		var sOutDataSet = "ds_MST650PF=ds_MST650PF";
		var sArgument   = "";
			sArgument += " COMPS=" + quote(ComboBoxPlant.Value);
			sArgument += " LIB9=" + quote(Lib9);
			sArgument += " DPTCD=" + quote(strText);
		http.Sync=true;
		Transaction(sKind, sMethodName, sInDataSet, sOutDataSet, sArgument, "");
		http.Sync=false;
		if(ds_MST650PF.rowcount > 0){
			st_DPTCD = ds_MST650PF.GetColumn(0,"DPDPNM");
		}else{
			st_DPTCD = "";
			alert("[경고] 부서코드를 확인바랍니다."); 
			return;
		}
	}else{
		st_DPTCD = "";
	}
}

function ComboBoxPlant_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
	ds_SEND.ClearData();
	ds_ERCHK.ClearData();
	ds_MST650PF.ClearData();
	if(ComboBoxPlant.Value == "E1"){
		ed_DPTCD.Text = "1700";
	}else if(ComboBoxPlant.Value == "C1"){
		ed_DPTCD.Text = "3004";
	}else if(ComboBoxPlant.Value == "H1"){
		ed_DPTCD.Text = "3286";
	}else if(ComboBoxPlant.Value == "S1"){
		ed_DPTCD.Text = "2204";
	}else{
		ed_DPTCD.Text = "9999";
	}
	ed_DPTCD_OnChanged(ed_DPTCD,ed_DPTCD.Text);
}
]]></Script>
</Window>