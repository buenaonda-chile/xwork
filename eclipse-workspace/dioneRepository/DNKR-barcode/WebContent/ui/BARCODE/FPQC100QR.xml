<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="624" Id="UserList" Left="8" OnFocus="menu_OnFocus" OnLoadCompleted="on_LoadCompleted" PidAttrib="7" Title="DNKA&#32;사내용&#32;TAG&#32;발행" ToolTipFont="Default,0" Top="8" Ver="1.0" Width="1062" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_FPQC100QR"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_LOAD"></Dataset>
		</Datasets>
		<Image FillType="STRETCH" Font="돋움,9,Bold" Height="28" Id="titleBar" ImageID="main_tit_bak" Left="-2" TabOrder="1" Width="1061"></Image>
		<Static Color="#333333" Font="돋움,9,Bold" Height="13" Id="title_text" Left="16" TabOrder="1" Top="8" Width="1032"></Static>
		<FileDialog AppendExtDefault="TRUE" Bottom="24" FileNameList="|" Filter="ALL&#32;File(xls.*)|*.xls" Height="24" Id="FileDialog0" Left="1000" Right="1024" TabOrder="5" Type="Save" Width="24"></FileDialog>
		<File Bottom="24" Height="24" Id="File0" Left="1032" Right="1056" TabOrder="4" Width="24"></File>
		<Ubi Bottom="600" Height="574" Id="Ubi0" Right="1048" Top="26" Width="1048">
			<_PersistData>&#13;&#10;/6yTdP4L/wAAAQBQbAAAd1M7APjy//7//fL4/PcMDwACBVQAWQBfUABFADD48QH+8C8DMQAyLwABNQH99S8CXgBuSQR0+vn+8C8L&#13;&#10;MgA1agAsOwBrCQRlD28FAfv07vGhAxQGswT+NAIHRABlAGYAH2EAdQBsVwP48pkB7Pn71wTwv/r0BVMAxWjCAGVXAQID+fUDdF+t&#13;&#10;vLm0zNQHFPr0cwIwLwD+9AExAA==&#13;&#10;</_PersistData>
		</Ubi>
	</Form>
	<Script><![CDATA[ /*--------------------------------------------------------------
 * @@version               : 1.0 
 * @@author                : LEE S K
 * @@see
 * ● SYSTEM NAME          : DIONE
 * ● PROGRAM NO.          : FPQC100QR.xml
 * ● PROGRAM DESCRIPTION  : DNKA 부품식별표 발행
 * ● DATE WRITTEN         : 2014.06.06
----------------------------------------------------------------*/

#include "script::lib_script_common.js";
#include "script::Grid_Script.js"

var strSeparator = "	";
var Lib1 = G_ds_user.GetColumn(0,"LIB1");
var Lib2 = G_ds_user.GetColumn(0,"LIB2");
var company = G_ds_user.GetColumn(0,"COMPANY");

var nowDate = today();

/********************************************************************** 
 * 내용설명 : 화면로드
 * 주요변수 : 
 **********************************************************************/ 
function on_LoadCompleted(obj){
	getTitle();	
	//getDesign();	
	//gFcOnTopButtonColor("1"); //상단 버튼 활성화 여부 (기본:0,조회:1,변경:2)
	ds_LOAD.ClearData();
	getFPQC100QR();
}


/********************************************************************** 
 * 내용설명 : 공통코드 조회
 * 주요변수 : 
 **********************************************************************/ 
function getDesign(){
	//MainGrid.ToolTipText = setPopMessage("2053");
	MainGrid.BkColor = G_ds_design.GetColumn(0,"BkColor");
	MainGrid.BkColor2 = G_ds_design.GetColumn(0,"BkColor2");
	MainGrid.BkSelColor = G_ds_design.GetColumn(0,"BkSelColor");
	MainGrid.Face3dColor = G_ds_design.GetColumn(0,"Face3dColor");
	MainGrid.BoldHead = G_ds_design.GetColumn(0,"BoldHead");
	MainGrid.HeadHeight = G_ds_design.GetColumn(0,"HeadHeight");
	MainGrid.Width = G_ds_design.GetColumn(0,"Width");
	//MainGrid.Top = G_ds_design.GetColumn(0,"Top");
}

/********************************************************************** 
 * 내용설명 : 화면조회
 * 주요변수 : 
 **********************************************************************/ 
function getFPQC100QR(){
	ds_LOAD.LoadXML(ds_SEL);

	var sKind		= "getFPQC100QR";						
	//var sMethodName = "service::psfaclib/selectFPQC100QR.do";     		// 서버에서 호출 될 Method 명
	var sMethodName = "service::barcode/selectFPQZ100Q/report";     		// 서버에서 호출 될 Method 명
	//var sMethodName = "service::barcode/selectFPQC100Q_report";     		// 서버에서 호출 될 Method 명
	var sInDataSet  = "ds_LOAD=ds_LOAD";               				// 자료 저장 시 보낼 DataSet 명칭
	var sOutDataSet = "ds_FPQC100QR=ds_FPQC100QR";    				// 조회 후 돌려 받을 DataSet 명칭
	var sArgument   = "";
	sArgument += " LIB1=" + quote(Lib1);
	sArgument += " LIB2=" + quote(Lib2);
	sArgument += " COMPS=" + quote(COMPS);
	sArgument += " PNYMD=" + quote(PNYMD);
	sArgument += " PR_GU=" + quote(PRGUB);  //조회화면에서의 발행 or 상세화면에서의 발행 구분
	sArgument += " TABLE=" + quote(TABLE);
	http.Sync 		= true;
	Transaction(sKind, sMethodName, sInDataSet, sOutDataSet, sArgument, "callback");
	http.Sync 		= false;
	
}

/********************************************************************** 
 * 내용설명 : Transaction 리턴후 실행 함수
 * 주요변수 : 
 * 			- sMethodName	Transaction 고유 ID
 * 			- ErrorCode 	에러코드
 * 			- ErrorMSG 		에러 메세지
 **********************************************************************/ 
function callback(svcId, rtnCd, rtnMsg){
	// tran 실패
	if(rtnCd<0){
		alert(setPopMessage("1002"));
		setMessage("1002");
	}else if(svcId=="getFPQC100QR"){
		var first_RDOGUB = left(RDOGUB,1);
		var last_RDOGUB = right(RDOGUB,1);
		switch (first_RDOGUB){
		case '1' :  //표준4매
			ds_FPQC100QR.AddColumn("DONGHI");
			for(var i=0; i<ds_FPQC100QR.rowcount;i++){
				//as400 db2에서 문자입력시 공백 입력되므로 1byte로 변경
				var tempFRERMG = midb(replace(replace(replace(replace(ds_FPQC100QR.GetColumn(i,"FRERMG"),"（","("),"）",")"),"　","")," ",""),0,8);
				var tempCode = null;
				var qrCD_donghi;
				var DtStr = 999;
				if(tempFRERMG == "동희산업"){
					tempCode = "1100:180001";
					DtStr = 2;
				}
				if(tempFRERMG == "(주)동희"){
					tempCode = "2100:180004";
					DtStr = 2;
				}
				if(tempFRERMG == "동희하이"){
					tempCode = "3100:0000190005";
					DtStr = 0;
				}
				if(tempFRERMG == "동희정공"){
					tempCode = "4200:0000696178";
					DtStr = 2;
				}
				if(tempFRERMG == "동희팔탄"){
					tempCode = "4200:0000696165";
					DtStr = 2;
				}
				if(DtStr != 999){ //동희관련업체는 qrcode를 하나더...
					qrCD_donghi =  
						tempCode + ":" + 
						ds_FPQC100QR.GetColumn(i,"FRERMJ") + ":" + 
						substr(ds_FPQC100QR.GetColumn(i,"PRODYT"),DtStr,8) + ":" + 
						ds_FPQC100QR.GetColumn(i,"ORCQY") + ":" + 
						substr(ds_FPQC100QR.GetColumn(i,"INSNOT"),4,3);
					ds_FPQC100QR.SetColumn(i,"DONGHI",qrCD_donghi); //동희관련업체 QR삽입
				}
				
			}

			Ubi0.setJrfFileDir(G_baseURL+"ui/BARCODE/REPORT/");
			if (last_RDOGUB == '0'){
				Ubi0.setJrfFileName("FPQC100Q4R_O.jrf");
			}else if (last_RDOGUB == '2'){
				Ubi0.setJrfFileName("FPQC100Q4R_B.jrf");    //표준4매 빈양식
			}
			Ubi0.SetDataset("ds_FPQC100QR", "ds_FPQC100QR");   
			Ubi0.SetArgument("CHKLOT",CHKLOT);	//lot number 발행할 것인가?
			Ubi0.Retrieve();	
			break;
		case '2' :  //표준6매 
			ds_FPQC100QR.AddColumn("DONGHI");
			for(var i=0; i<ds_FPQC100QR.rowcount;i++){
				//as400 db2에서 문자입력시 공백 입력되므로 1byte로 변경
				var tempFRERMG = midb(replace(replace(replace(replace(ds_FPQC100QR.GetColumn(i,"FRERMG"),"（","("),"）",")"),"　","")," ",""),0,8);
				var tempCode = null;
				var qrCD_donghi;
				var DtStr = 999;
				if(tempFRERMG == "동희산업"){
					tempCode = "1100:180001";
					DtStr = 2;
				}
				if(tempFRERMG == "(주)동희"){
					tempCode = "2100:180004";
					DtStr = 2;
				}
				if(tempFRERMG == "동희하이"){
					tempCode = "3100:0000190005";
					DtStr = 0;
				}
				if(tempFRERMG == "동희정공"){
					tempCode = "4200:0000696178";
					DtStr = 2;
				}
				if(tempFRERMG == "동희팔탄"){
					tempCode = "4200:0000696165";
					DtStr = 2;
				}
				if(DtStr != 999){ //동희관련업체는 qrcode를 하나더...
					qrCD_donghi =  
						tempCode + ":" + 
						ds_FPQC100QR.GetColumn(i,"FRERMJ") + ":" + 
						substr(ds_FPQC100QR.GetColumn(i,"PRODYT"),DtStr,8) + ":" + 
						ds_FPQC100QR.GetColumn(i,"ORCQY") + ":" + 
						substr(ds_FPQC100QR.GetColumn(i,"INSNOT"),4,3);
					ds_FPQC100QR.SetColumn(i,"DONGHI",qrCD_donghi); //동희관련업체 QR삽입
				}
				
			}
			Ubi0.setJrfFileDir(G_baseURL+"ui/BARCODE/REPORT/");
			if (last_RDOGUB == '0'){
				Ubi0.setJrfFileName("FPQC100Q6R_O.jrf");     //표준6매 접착
			}else if (last_RDOGUB == '1'){
				Ubi0.setJrfFileName("FPQC100Q6R_H.jrf");   //표준6매 홀더
			}else if (last_RDOGUB == '2'){
				Ubi0.setJrfFileName("FPQC100Q6R_B.jrf");   //표준6매 빈양식
			}
			
			Ubi0.SetDataset("ds_FPQC100QR", "ds_FPQC100QR");
			Ubi0.SetArgument("CHKLOT",CHKLOT); //lot number 발행할 것인가?
			Ubi0.SetArgument("CHKINSPEC",CHKINSPEC); //21.03.05 추가 : 검사유무기능 추가(기본:무검사, 체크시:유검사)
			//trace("CHKINSPEC : "+CHKINSPEC);
			Ubi0.Retrieve();
			break;
		case '3' : //랩도스4매
			ds_FPQC100QR.AddColumn("DONGHI");
			for(var i=0; i<ds_FPQC100QR.rowcount;i++){
				var tno = left(ds_FPQC100QR.GetColumn(i,"WKARE"),1);
				var a1 = decode(tno,"0","S096","1","P605","    "); 
				var a2 = left((replace(ds_FPQC100QR.GetColumn(i,"FRERMJ"),'-','') + '               '),15);
				var a3 = substr(ds_FPQC100QR.GetColumn(i,"ORCQYT"),2,5);
				var a4 = iif(CHKLOT == '1',left((ds_FPQC100QR.GetColumn(i,"BRDCD") + '   '),3),'   ');
				var a5 = substr(ds_FPQC100QR.GetColumn(i,"INSNOT"),3,4);
				ds_FPQC100QR.SetColumn(i,"DONGHI",a1+a2+a3+a4+a5); //바코드 code128삽입
			}
			Ubi0.setJrfFileDir(G_baseURL+"ui/BARCODE/REPORT/");
			if (last_RDOGUB == '0'){
				Ubi0.setJrfFileName("FPQC100QR4R_O.jrf");
			}else if (last_RDOGUB == '2'){
				Ubi0.setJrfFileName("FPQC100QR4R_B.jrf");    //랩도스4매 빈양식
			}
			Ubi0.SetDataset("ds_FPQC100QR", "ds_FPQC100QR");
			Ubi0.SetArgument("CHKLOT",CHKLOT);	//lot number 발행할 것인가?
			Ubi0.SetArgument("CHKBAR",CHKBAR);	//BARCODE128 발행할 것인가?
			Ubi0.SetArgument("CHKCHU",CHKCHU);	//중금속마크 발행할 것인가?
			Ubi0.Retrieve();
			break;
		case '4' :  //랩도스6매
			ds_FPQC100QR.AddColumn("DONGHI");
			for(var i=0; i<ds_FPQC100QR.rowcount;i++){
				var tno = left(ds_FPQC100QR.GetColumn(i,"WKARE"),1);
				var a1 = decode(tno,"0","S096","1","P605","    "); 
				var a2 = left((replace(ds_FPQC100QR.GetColumn(i,"FRERMJ"),'-','') + '               '),15);
				var a3 = substr(ds_FPQC100QR.GetColumn(i,"ORCQYT"),2,5);
				var a4 = iif(CHKLOT == '1',left((ds_FPQC100QR.GetColumn(i,"BRDCD") + '   '),3),'   ');
				var a5 = substr(ds_FPQC100QR.GetColumn(i,"INSNOT"),3,4);
				ds_FPQC100QR.SetColumn(i,"DONGHI",a1+a2+a3+a4+a5);  //바코드 code128삽입
			}
			Ubi0.setJrfFileDir(G_baseURL+"ui/BARCODE/REPORT/");
			if (last_RDOGUB == '0'){
				Ubi0.setJrfFileName("FPQC100QR6R_O.jrf");
			}else if (last_RDOGUB == '2'){
				Ubi0.setJrfFileName("FPQC100QR6R_B.jrf");    //랩도스6매 빈양식
			}
			
			Ubi0.SetDataset("ds_FPQC100QR", "ds_FPQC100QR");
			Ubi0.SetArgument("CHKLOT",CHKLOT);	//lot number 발행할 것인가?
			Ubi0.SetArgument("CHKBAR",CHKBAR);	//BARCODE128 발행할 것인가?
			Ubi0.SetArgument("CHKCHU",CHKCHU);	//중금속마크 발행할 것인가?
			Ubi0.Retrieve();
			break;
		case '5' :  //글로비스3매
			Ubi0.setJrfFileDir(G_baseURL+"ui/BARCODE/REPORT/");
			if (last_RDOGUB == '0'){
				Ubi0.setJrfFileName("FPQC100QG3R_O.jrf");
			}else if (last_RDOGUB == '2'){
				Ubi0.setJrfFileName("FPQC100QG3R_B.jrf");    //랩도스6매 빈양식
			}
			
			Ubi0.SetDataset("ds_FPQC100QR", "ds_FPQC100QR");
			Ubi0.SetArgument("GLONO",GLONO);	//글로비스오더번호 발행할 것인가?
			Ubi0.SetArgument("CHKLOT",CHKLOT);	//lot number 발행할 것인가?
			Ubi0.Retrieve();
			break;
		case '6' :  //글로비스5매
			Ubi0.setJrfFileDir(G_baseURL+"ui/BARCODE/REPORT/");
			if (last_RDOGUB == '0'){
				Ubi0.setJrfFileName("FPQC100QG5R_O.jrf");
			}else if (last_RDOGUB == '2'){
				Ubi0.setJrfFileName("FPQC100QG5R_B.jrf");    //랩도스6매 빈양식
			}
			Ubi0.SetDataset("ds_FPQC100QR", "ds_FPQC100QR");
			Ubi0.SetArgument("GLONO",GLONO);	//글로비스오더번호 발행할 것인가?
			Ubi0.SetArgument("CHKLOT",CHKLOT);	//lot number 발행할 것인가?
			Ubi0.Retrieve();
			break;
		case '8' :  //모비스4매
			var hmcQrSeq="";
			var hmcQrAsc="";
			var QR_MOBIS="";
			ds_FPQC100QR.AddColumn("BARCD2");  // 모비스QR 삽입
			for(var i=0; i<ds_FPQC100QR.rowcount;i++){
				//  Seq가 2 자리로 100 -> A0,  111 -> B1, 360 -> a0로 변환         알파벳으로 1~500까지만 이용 501, 1001, 1501은 1로 Reset
				hmcQrSeq = ((toNumber(ds_FPQC100QR.GetColumn(i,"INSNOT"))-1) % 500)+1;        //HmcQrSeq := FieldByName('INSNOT').AsInteger;
				                                                                              //HmcQrSeq := ((HmcQrSeq - 1) MOD 500) + 1;
				hmcQrAsc = toInteger(hmcQrSeq/10);
				if (hmcQrSeq > 359){
					hmcQrAsc = 61 + hmcQrAsc;
				}else if(hmcQrSeq > 99){
					hmcQrAsc = 55 + hmcQrAsc;
				}else{
					hmcQrAsc = 48 + hmcQrAsc;
				}
				hmcQrChar = chr(hmcQrAsc)+""+ toInteger(hmcQrSeq % 10);
				QR_MOBIS =  "QR*"+
							 ds_FPQC100QR.GetColumn(i,"PRODYT")+                     // 년월일(8)
							 hmcQrChar+                                              // SEQ(2)
							 right("00000"+ds_FPQC100QR.GetColumn(i,"ORCQY"),5)+     // 수량(5)
							 "0" + right(ds_FPQC100QR.GetColumn(i,"PRODYT"),6)+      // LOT NO(7)
							 "P605" +                                                // VAN ID(4)
							 replace(ds_FPQC100QR.GetColumn(i,"CPRTN"),"-","");     // 업체품번(18)
				ds_FPQC100QR.SetColumn(i,"BARCD2",QR_MOBIS); //Mobis QR삽입
			}
			Ubi0.setJrfFileDir(G_baseURL+"ui/BARCODE/REPORT/");
			if (last_RDOGUB == '0'){
				//Ubi0.setJrfFileName("FPQC100Q_MO4R_B.jrf");   사용안함. //모비스4매 빈양식 
			}else if (last_RDOGUB == '2'){
				Ubi0.setJrfFileName("FPQC100Q_MO4R_B.jrf");    
			}
			Ubi0.SetDataset("ds_FPQC100QR", "ds_FPQC100QR");
			Ubi0.SetArgument("CHKCHU",CHKCHU);	//중금속마크 발행할 것인가?
			Ubi0.Retrieve();
			break;
		case '7' :  //기아4매   -> COMP
			var kia_barcode="";
			ds_FPQC100QR.AddColumn("BARCD2");  // KIA 2D Matrix 삽입
			for(var i=0; i<ds_FPQC100QR.rowcount;i++){
				kia_barcode="P605"+   // VAN ID(4)
							 left(replace(ds_FPQC100QR.GetColumn(i,"CPRTN"),"-","")+space(15),15)+     // 업체품번(15)
							 right("00000"+ds_FPQC100QR.GetColumn(i,"ORCQY"),5)+     // 수량(5)
							 "P605"+  // VAN ID(4)
							 ds_FPQC100QR.GetColumn(i,"PRODYT")+                     // 년월일(8)
							 right("000000"+ds_FPQC100QR.GetColumn(i,"INSNOT"),6);   // 식별표발행순번
				ds_FPQC100QR.SetColumn(i,"BARCD2",kia_barcode); // KIA 2D Matrix 삽입
			}
			Ubi0.setJrfFileDir(G_baseURL+"ui/BARCODE/REPORT/");
			if (last_RDOGUB == '0'){
				Ubi0.setJrfFileName("FPQC100Q_KI4R_O.jrf");
			}else if (last_RDOGUB == '2'){
				Ubi0.setJrfFileName("FPQC100Q_KI4R_B.jrf");    //모비스4매 빈양식
			}
			Ubi0.SetDataset("ds_FPQC100QR", "ds_FPQC100QR");
			//Ubi0.SetArgument("CHKCHU",CHKCHU);	//중금속마크 발행할 것인가?
			Ubi0.Retrieve();
			break;
		case '9' :  // SHB 4매    -> ECM
			Ubi0.setJrfFileDir(G_baseURL+"ui/BARCODE/REPORT/");
			if (last_RDOGUB == '0'){
				Ubi0.setJrfFileName("FPQC100Q_SHB4R_B.jrf");
			}else if (last_RDOGUB == '2'){
				Ubi0.setJrfFileName("FPQC100Q_SHB4R_B.jrf");    //표준4매 빈양식
			}
			Ubi0.SetDataset("ds_FPQC100QR", "ds_FPQC100QR");   
			Ubi0.SetArgument("CHKLOT",CHKLOT);	//lot number 발행할 것인가?
			Ubi0.SetArgument("CHKLOT",CHKLOT);	// 워터마크 삽입
			Ubi0.Retrieve();	
			break;
		}
	}
}

function Ubi0_PrintEnd(obj)
{
	alert(Ubi0.getPrintStatus() + "-    -" +Ubi0.getTotalPage()+ "-    -"+Ubi0.getCurrPage()); 
	//getPrintStatus()  ==  0 :정상       1:실패          0보다작으면 취소
}
]]></Script>
</Window>