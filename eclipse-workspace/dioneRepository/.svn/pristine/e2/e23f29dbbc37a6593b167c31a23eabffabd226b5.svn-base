<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="624" Id="UserList" Left="8" OnFocus="menu_OnFocus" OnLoadCompleted="on_LoadCompleted" PidAttrib="7" Title="의료비신고파일생성" TooltipFont="Default,0" Top="8" Ver="1.0" Width="1062" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_ComCode_PLNT"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_uploadFile">
				<Contents>
					<colinfo id="chk" size="256" summ="default" type="STRING"/>
					<colinfo id="fullname" size="256" summ="default" type="STRING"/>
					<colinfo id="filename" size="256" summ="default" type="STRING"/>
					<colinfo id="prog_bar" size="256" summ="default" type="STRING"/>
					<colinfo id="filesize" size="256" summ="default" type="INT"/>
					<colinfo id="progsize" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_HAYZ206UC">
				<Contents>
					<colinfo id="SABUN" size="256" summ="default" type="INT"/>
					<colinfo id="KORNO" size="256" summ="default" type="STRING"/>
					<colinfo id="FORCDA" size="256" summ="default" type="STRING"/>
					<colinfo id="KORNM" size="256" summ="default" type="STRING"/>
					<colinfo id="HOPNO" size="256" summ="default" type="STRING"/>
					<colinfo id="HOPNM" size="256" summ="default" type="STRING"/>
					<colinfo id="HOPCD" size="256" summ="default" type="STRING"/>
					<colinfo id="HOPCNT" size="256" summ="default" type="STRING"/>
					<colinfo id="HOPMON" size="256" summ="default" type="STRING"/>
					<colinfo id="DFFCD" size="256" summ="default" type="STRING"/>
					<colinfo id="APPNO" size="256" summ="default" type="STRING"/>
					<colinfo id="FORCDB" size="256" summ="default" type="STRING"/>
					<colinfo id="APPCD" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Image FillType="STRETCH" Font="돋움,9,Bold" Height="28" Id="titleBar" ImageID="main_tit_bak" Left="-2" TabOrder="1" Width="1060"></Image>
		<Static Color="#333333" Font="돋움,9,Bold" Height="13" Id="title_text" Left="16" TabOrder="1" Top="8" Width="1032"></Static>
		<Static Align="Center" BKColor="thistle" Border="Flat" BorderColor="#b4b4b4" Font="Default,9,Bold" Height="26" Id="Static4" Left="4" TabOrder="3" Text="생&#32;성&#32;구&#32;분" Top="34" VAlign="Middle" Width="116"></Static>
		<Static Align="Center" BKColor="white" Border="Flat" BorderColor="#b4b4b4" Font="Default,14,Bold" Height="60" Id="searchBar" TabOrder="4" Top="32" VAlign="Middle" Width="1060"></Static>
		<File Bottom="24" Height="24" Id="ProFile" Left="872" Right="896" TabOrder="7" Width="24"></File>
		<FileDialog AppendExtDefault="TRUE" Bottom="24" FileNameList="|" Filter="ALL&#32;File(xls.*)|*.xls" Height="24" Id="FileDialog0" Left="944" Right="968" TabOrder="8" Type="Save" Width="24"></FileDialog>
		<File Bottom="24" Height="24" Id="File" Left="976" Right="1000" TabOrder="7" Width="24"></File>
		<CyHttpFile Height="24" Id="CyHttpFile0" Left="904" Width="24"></CyHttpFile>
		<Static Align="Center" BKColor="lightsalmon" Border="Flat" BorderColor="#b4b4b4" Font="Default,9,Bold" Height="26" Id="Static6" Left="6" TabOrder="5" Text="사&#32;&#32;&#32;업&#32;&#32;&#32;부" Top="34" VAlign="Middle" Width="116"></Static>
		<Static Border="Flat" BorderColor="#b4b4b4" Color="#333333" Font="굴림,9,Bold" Height="26" Id="Static11" Left="124" Style="static" TabOrder="5" Top="34" VAlign="Middle" Width="96"></Static>
		<Combo CodeColumn="code2" DataColumn="code_name" Height="19" Id="ComboBoxPlant" InnerDataset="ds_ComCode_PLNT" Left="128" OnChanged="common_OnChanged" TabOrder="5" Top="37" Width="88"></Combo>
		<Static Align="Center" Border="Flat" BorderColor="#b4b4b4" Font="굴림,9,Bold" Height="26" Id="Static28" Left="867" TabOrder="11" Top="34" VAlign="Middle" Width="96"></Static>
		<Static Align="Center" BKColor="lightsalmon" Border="Flat" BorderColor="#b4b4b4" Font="굴림,9,Bold" Height="26" Id="Static31" Left="751" TabOrder="10" Text="제&#32;출&#32;일&#32;자" Top="34" VAlign="Middle" Width="116"></Static>
		<Calendar Border="Flat" BorderColor="SCROLLBAR" Dateformat="yyyy-MM-dd" FocusIndex="0" Height="18" Id="cmb_SUBMISSION" Left="872" OnChanged="common_OnChanged" SaturdayTextColor="blue" SundayTextColor="red" TabOrder="9" Top="38" Value="TODAY" Width="88"></Calendar>
		<Static Align="Center" Border="Flat" BorderColor="#b4b4b4" Font="굴림,9,Bold" Height="26" Id="Static7" Left="341" TabOrder="14" Top="34" VAlign="Middle" Width="195"></Static>
		<Static Align="Center" BKColor="lightsalmon" Border="Flat" BorderColor="#b4b4b4" Font="굴림,9,Bold" Height="26" Id="Static8" Left="225" TabOrder="13" Text="기&#32;준&#32;년&#32;월" Top="34" VAlign="Middle" Width="116"></Static>
		<Calendar Border="Flat" BorderColor="SCROLLBAR" Dateformat="yyyy-MM" Enable="FALSE" FocusIndex="0" Height="18" Id="cmd_PTJYM_FR" Left="346" LeftMargin="10" OnChanged="common_OnChanged" SaturdayTextColor="blue" SundayTextColor="red" TabOrder="12" Top="38" Value="TODAY" Width="80"></Calendar>
		<Calendar Border="Flat" BorderColor="SCROLLBAR" Dateformat="yyyy-MM" Enable="FALSE" FocusIndex="0" Height="18" Id="cmd_PTJYM_TO" Left="450" LeftMargin="10" OnChanged="common_OnChanged" SaturdayTextColor="blue" SundayTextColor="red" TabOrder="15" Top="38" Value="TODAY" Width="80"></Calendar>
		<Static Align="Center" Height="11" Id="Static154" Left="430" TabOrder="16" Text="~" Top="42" VAlign="Middle" Width="15"></Static>
		<Button Height="26" Id="btn_write" ImageID="sum_생성" Left="975" OnClick="btn_write_OnClick" TabOrder="17" Text="File&#32;생성" Top="35" Width="70"></Button>
		<Static Align="Center" BKColor="lightsalmon" Border="Flat" BorderColor="#b4b4b4" Font="굴림,9,Bold" Height="26" Id="Static2" Left="541" TabOrder="18" Text="연&#32;말&#32;정&#32;산" Top="34" VAlign="Middle" Width="116"></Static>
		<Static Align="Center" Border="Flat" BorderColor="#b4b4b4" Font="굴림,9,Bold" Height="26" Id="Static1" Left="657" TabOrder="20" Top="34" VAlign="Middle" Width="88"></Static>
		<Calendar Border="Flat" BorderColor="SCROLLBAR" Dateformat="yyyy-MM" Enable="FALSE" FocusIndex="0" Height="18" Id="cmb_PTJYM" Left="662" LeftMargin="10" OnChanged="common_OnChanged" SaturdayTextColor="blue" SundayTextColor="red" TabOrder="19" Top="38" Value="TODAY" Width="80"></Calendar>
		<Button Height="25" Id="btnUpload" ImageID="btn2_search2" Left="880" OnClick="Div1_btn_FINDFILE_OnClick" TabOrder="21" Text="조회" Top="65" Width="75"></Button>
		<Static Border="Flat" BorderColor="#b4b4b4" Color="#333333" Font="굴림,9,Bold" Height="26" Id="Static16" Left="122" Style="static" TabOrder="22" Top="64" VAlign="Middle" Width="750"></Static>
		<Edit Border="Default" BorderColor="SCROLLBAR" Enable="FALSE" Height="20" Id="ed_path" ImeMode="none" Left="126" MaxLength="15" TabOrder="23" TabStop="FALSE" Top="67" UpperOnly="TRUE" Width="738"></Edit>
		<Static Align="Center" BKColor="thistle" Border="Flat" BorderColor="#b4b4b4" Font="Default,9,Bold" Height="26" Id="Static15" Left="4" TabOrder="24" Text="파&#32;일&#32;찿&#32;기" Top="64" VAlign="Middle" Width="116"></Static>
		<Grid AreaSelect="true" AutoFit="TRUE" AutoFitEndLine="Hide" BindDataset="ds_HAYZ206UC" BKColor="MENU" BkColor2="LIGHT3D" BkSelColor="lavender" BoldHead="true" Border="Flat" BorderColor="#888888" Bottom="489" CellMoving="TRUE" ColSelect="TRUE" ColSizing="TRUE" Enable="true" EndLineColor="default" Face3dColor="khaki" HeadBorder="Flat" HeadHeight="25" Height="349" Id="MainGrid" InputPanel="FALSE" LineColor="#888888" MinWidth="100" MultiSelect="TRUE" Right="1048" SelColor="black" TabOrder="24" TabStop="true" Top="140" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="1048">
			<contents>
				<format id="Default">
					<columns>
						<col width="33"/>
						<col width="60"/>
						<col width="100"/>
						<col width="50"/>
						<col width="80"/>
						<col width="95"/>
						<col width="100"/>
						<col width="80"/>
						<col width="80"/>
						<col width="80"/>
						<col width="60"/>
						<col width="100"/>
						<col width="50"/>
						<col width="80"/>
					</columns>
					<head>
						<cell bkcolor="#dfdfdf" col="0" display="text" rowspan="2" text="No"/>
						<cell bkcolor="#dfdfdf" col="1" display="text" rowspan="2" text="사번"/>
						<cell bkcolor="#dfdfdf" col="2" colspan="3" display="text" text="소득자"/>
						<cell bkcolor="#dfdfdf" col="5" colspan="3" display="text" text="지급처"/>
						<cell bkcolor="#dfdfdf" col="8" colspan="3" display="text" text="지급명세"/>
						<cell bkcolor="#dfdfdf" col="11" colspan="3" display="text" text="의료비&#32;공제&#32;대상자"/>
						<cell bkcolor="#dfdfdf" col="2" display="text" row="1" text="주민등록번호"/>
						<cell bkcolor="#dfdfdf" col="3" display="text" expr='&quot;내외국인\n구분&quot;' row="1" text="내외국인구분"/>
						<cell bkcolor="#dfdfdf" col="4" display="text" row="1" text="성명"/>
						<cell bkcolor="#dfdfdf" col="5" display="text" row="1" text="사업자등록번호"/>
						<cell bkcolor="#dfdfdf" col="6" display="text" row="1" text="상호"/>
						<cell bkcolor="#dfdfdf" col="7" display="text" row="1" text="의료증빙코드"/>
						<cell bkcolor="#dfdfdf" col="8" display="text" row="1" text="지급건수"/>
						<cell bkcolor="#dfdfdf" col="9" display="text" row="1" text="지급금액"/>
						<cell bkcolor="#dfdfdf" col="10" display="text" expr='&quot;난임수술비\n해당여부&quot;' row="1" text="난임수술비해당여부"/>
						<cell bkcolor="#dfdfdf" col="11" display="text" row="1" text="주민등록번호"/>
						<cell bkcolor="#dfdfdf" col="12" display="text" expr='&quot;내외국인\n구분&quot;' row="1" text="내외국인구분"/>
						<cell bkcolor="#dfdfdf" col="13" display="text" row="1" text="본인등여부"/>
					</head>
					<body>
						<cell align="right" col="0" display="text" expr="currow+1"/>
						<cell align="center" checklength="Byte" col="1" colid="SABUN" display="normal"/>
						<cell align="center" checklength="Byte" col="2" colid="KORNO" display="normal"/>
						<cell align="center" checklength="Byte" col="3" colid="FORCDA" display="number"/>
						<cell align="center" checklength="Byte" col="4" colid="KORNM" display="normal"/>
						<cell align="center" checklength="Byte" col="5" colid="HOPNO" display="normal"/>
						<cell align="center" checklength="Byte" col="6" colid="HOPNM" display="normal"/>
						<cell align="center" checklength="Byte" col="7" colid="HOPCD" display="normal"/>
						<cell align="right" checklength="Byte" col="8" colid="HOPCNT" display="number"/>
						<cell align="right" checklength="Byte" col="9" colid="HOPMON" display="number"/>
						<cell align="center" checklength="Byte" col="10" colid="DFFCD" display="normal"/>
						<cell align="center" checklength="Byte" col="11" colid="APPNO" display="normal"/>
						<cell align="center" checklength="Byte" col="12" colid="FORCDB" display="number"/>
						<cell align="center" checklength="Byte" col="13" colid="APPCD" display="normal"/>
					</body>
				</format>
			</contents>
		</Grid>
		<TextArea CheckLength="Byte" Height="120" HScroll="TRUE" Id="ta_RESULT" TabOrder="26" Top="489" VScroll="TRUE" Width="1048"></TextArea>
		<File Bottom="26" Height="24" Id="File0" Left="835" Right="859" TabOrder="26" Top="2" Width="24"></File>
		<Div Height="232" Id="Div2" Left="361" TabOrder="8" Text="Div2" Top="231" Visible="FALSE" Width="374">
			<Contents>
				<Static Align="Center" BKColor="lime" Border="Flat" Height="210" Id="Static0" Left="12" TabOrder="1" Text="DATA&#32;Check중입니다............" Top="1" VAlign="Middle" Width="351"></Static>
			</Contents>
		</Div>
		<Static Border="SunkenEdge" Font="Default,12,Bold" Height="48" Id="Static0" Left="1" TabOrder="27" Text="**&#32;레코드&#32;(집계)" Top="93" Width="1048"></Static>
		<Static Align="Center" Font="Default,10" Height="20" Id="Static21" Left="496" TabOrder="29" Text="지급&#32;건수&#32;:" Top="113" VAlign="Middle" Width="80"></Static>
		<Static Align="Center" Font="Default,10" Height="20" Id="Static22" Left="30" TabOrder="28" Text="총&#32;건수&#32;:" Top="113" VAlign="Middle" Width="80"></Static>
		<Static Align="Center" Font="Default,10" Height="20" Id="Static27" Left="704" TabOrder="31" Text="지급금액총계&#32;:" Top="113" VAlign="Middle" Width="109"></Static>
		<Static Align="Center" Font="Default,10" Height="20" Id="Static32" Left="264" TabOrder="30" Text="소득자&#32;건수&#32;:" Top="113" VAlign="Middle" Width="87"></Static>
		<MaskEdit Enable="FALSE" Height="22" Id="ed_RECCNT" Left="112" TabOrder="32" Top="112" Value="0" Width="120"></MaskEdit>
		<MaskEdit Enable="FALSE" Height="22" Id="ed_HOPCNT" Left="576" TabOrder="33" Top="112" Value="0" Width="120"></MaskEdit>
		<MaskEdit Enable="FALSE" Height="22" Id="ed_ACCOUNT" Left="352" TabOrder="34" Top="112" Value="0" Width="120"></MaskEdit>
		<MaskEdit Enable="FALSE" Height="22" Id="ed_COST" Left="816" TabOrder="35" Top="112" Value="0" Width="120"></MaskEdit>
	</Form>
	<Script><![CDATA[ /*--------------------------------------------------------------
 * @@version               : 1.0 
 * @@author                : JAE.H.B
 * @@see
 * ● SYSTEM NAME          : DIONE
 * ● PROGRAM NO.          : HAYZ206UC.xml
 * ● PROGRAM DESCRIPTION  : 연말정산 의료비 신고파일생성
 * ● DATE WRITTEN         : 2017.01.02
----------------------------------------------------------------*/

#include "script::lib_script_common.js";
#include "script::Grid_Script.js"
#include "script::spare_common.js";
#include "script::fileupdown.js"

var strSeparator = "	";

var Lib1 = G_ds_user.GetColumn(0,"LIB1");
var Lib2 = G_ds_user.GetColumn(0,"LIB2");
var Lib3 = G_ds_user.GetColumn(0,"LIB3");    //인사급여 LIBRARY(PSEDBLIB           PSCDBLIB.PSHDBLIB.PSSDBLIB)
//var	Lib3 = "PSDIOLIB";    //인사급여 LIBRARY(PSEDBLIB           PSCDBLIB.PSHDBLIB.PSSDBLIB)

var company = G_ds_user.GetColumn(0,"COMPANY");
var comps = G_ds_user.GetColumn(0,"PLANT_CD");

var file_name;
var result, SsId, BsId, Part, DName, TaxId, FileName, brandname;
var FrDate, ToDate;

//var gImgPath = ""; //연말정산 엑셀파일저장경로
//var imgVpath=G_baseURL+"DIONE_UPDOWN_FILE";//서버파일주소경로
var imgUPDOWNpath="C:/Program Files/Apache Software Foundation/Tomcat 6.0/webapps/DIONE_UPDOWN_FILE/";
//서버파일주소경로

/********************************************************************** 
 * 내용설명 : 화면로드
 * 주요변수 : 
 **********************************************************************/ 
function on_LoadCompleted(obj){
	getTitle();	
	getDesign();
	getComCode();
	gFcOnTopButtonColor("0"); //상단 버튼 활성화 여부 (기본:0,조회:1,변경:2)		
	setYYMM();//기준년월
}
/********************************************************************** 
 * 내용설명 : 사업부 선택 조회
 * 주요변수 : 
 **********************************************************************/ 
function getComCode(){

	http.Sync 	= true;

	var sKind		= "getComCode";						
	var sMethodName = "service::login/selectComCode.do"; 
	var sInDataSet  = "";
	var sOutDataSet = "ds_ComCode_PLNT=ds_ComCode_PLNT";
	var sArgument   = "";
		sArgument   += " CLASS='PLNT'";
		sArgument   += " CODE1=" + quote(company);		
	Transaction(sKind, sMethodName, sInDataSet, sOutDataSet, sArgument, "");
	ComboBoxPlant.Value = comps;
	ComboBoxPlant.Enable = false; 	
	http.Sync = false;
}
function getDesign(){

		
	MainGrid.BkColor = G_ds_design.GetColumn(0,"BkColor");
	MainGrid.BkColor2 = G_ds_design.GetColumn(0,"BkColor2");
	MainGrid.BkSelColor = G_ds_design.GetColumn(0,"BkSelColor");
	MainGrid.Face3dColor = G_ds_design.GetColumn(0,"Face3dColor");
	MainGrid.BoldHead = G_ds_design.GetColumn(0,"BoldHead");
	MainGrid.HeadHeight = G_ds_design.GetColumn(0,"HeadHeight");  //22
	MainGrid.Width = G_ds_design.GetColumn(0,"Width");            //1048
	MainGrid.UserData = MainGrid.Height;

	ta_RESULT.Width =G_ds_design.GetColumn(0,"Width");            //1048
	//searchBar.Width = G_ds_design.GetColumn(0,"Width");           //1048
	searchBar.Top = G_ds_design.GetColumn(0,"SBTop");	          //32
	//searchBar.Height = G_ds_design.GetColumn(0,"SBHeight");	      //29
}

/********************************************************************** 
 * 내용설명 : validation 체크
 **********************************************************************/ 
function validationChk(){

	var result = true;
	cmd_PTJYM_FR.BKColor="white";
	cmd_PTJYM_TO.BKColor="white";
	cmb_SUBMISSION.BKColor="white";

	if(cmd_PTJYM_FR.Value == ""){
		cmd_PTJYM_FR.BKColor="paleturquoise";
		alert("[확인] 기준년월을 확인하세요.");	
		cmd_PTJYM_FR.SetFocus();
		result = false;
	}else if(cmd_PTJYM_TO.Value == ""){
		cmd_PTJYM_TO.BKColor="paleturquoise";
		alert("[확인] 기준년월을 확인하세요.");	
		cmd_PTJYM_TO.SetFocus();
		result = false;
	}else if(cmb_SUBMISSION.Value == ""){
		cmb_SUBMISSION.BKColor="paleturquoise";
		alert("[확인] 제출일자를 확인하세요.");	
		cmb_SUBMISSION.SetFocus();
		result = false;
	}else if(cmd_PTJYM_FR.Value > cmd_PTJYM_TO.Value){
		cmd_PTJYM_FR.BKColor="paleturquoise";
		alert("[확인] 기준년월을 확인하세요.");	
		cmd_PTJYM_FR.SetFocus();
		result = false;
	}
	return result;
}
 
/********************************************************************** 
 * 내용설명 : Transaction 리턴후 실행 함수
 * 주요변수 : 
 * 			- sMethodName	Transaction 고유 ID
 * 			- ErrorCode 	에러코드
 * 			- ErrorMSG 		에러 메세지
 **********************************************************************/ 
function callback(svcId, rtnCd, rtnMsg){
	// tran 실패
	if(rtnCd<0){
		alert(setPopMessage("1002"));
		setMessage("1002");
		
	}else{
		alert(setPopMessage("1001"));
		setMessage("1001");	
	}
}	
/*--------------------------------------------------------------
 * 아래 함수는 콩통함수 이므로 모든 화면에 필요
 * 함수명 변경 불가
 * 버튼 컨트롤 함수들
----------------------------------------------------------------*/
function fn_Favorite()
{
	alert("fn_Favorite");
}

function fn_Search()
{
	alert(setPopMessage("9999"));
	setMessage("9999");
}

function fn_Input()
{
	alert(setPopMessage("9999"));
	setMessage("9999");
}

function fn_Delete()
{
	alert(setPopMessage("9999"));
	setMessage("9999");
}

function fn_Save()
{
	alert(setPopMessage("9999"));
	setMessage("9999");
}

function fn_print()
{
	alert(setPopMessage("9999"));
	setMessage("9999");
}

function fn_Excel()
{
	alert(setPopMessage("9999"));
	setMessage("9999");
}

function fn_Help()
{
	alert(setPopMessage("9999"));
	setMessage("9999");
}

function menu_OnFocus(obj)
{
	gFcOnTopButtonColor("0"); //상단 버튼 활성화 여부 (기본:0,조회:1,변경:2)	
}

function common_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
	ds_HAYZ206UC.ClearData();
}
//기준년월셋팅
function setYYMM(){
	if(parseInt(substr(today(),4,2)) < 4){
		cmd_PTJYM_FR.Value=parseInt(substr(today(),0,4))-1+"0101";
	}else{
		cmd_PTJYM_FR.Value=parseInt(substr(today(),0,4))+"0101";
	}
	if(parseInt(substr(today(),4,2)) < 4){
		cmd_PTJYM_TO.Value=parseInt(substr(today(),0,4))-1+"1231";
	}else{
		cmd_PTJYM_TO.Value=parseInt(substr(today(),0,4))+"1231";
	}
	if(parseInt(substr(today(),4,2)) < 4){
		//alert(parseInt(substr(today(),0,4))-1);
		cmb_PTJYM.Value=parseInt(substr(today(),0,4))-1+"1231";
	}
}

function rightb(strText, nSize)
{
	var tmp;
	if (lengthb(strText) < nSize) {
		nSize = lengthb(strText);
	}	
	tmp = midb(strText, lengthb(strText) - nSize, nSize);
	return tmp;
}

function leftb(strText, nSize)
{
	var tmp;
	if (lengthb(strText) < nSize) {
		nSize = lengthb(strText);
	}	
	tmp = midb(strText, 0, nSize);
	return tmp;
}

function btn_write_OnClick(obj)
{
	setHAYZ206UC();
}

function fn_write(obj)
{
	FileDialog0.Type = "SAVE";	

	FileDialog0.Filter = "ALL File(*.*)|*.*";	
	FileDialog0.FileName = FileName;
	FileDialog0.Open("C:\\");	
	File0.FileName = FileDialog0.FilePath + "\\" + FileName;	
	File0.Open ( "w+" );
	var len = File0.Write(result, 10000000000000);	
	//alert("len= "+len);
	File0.Close();
	

	if(!file_Upload()){
		//ds_uploadFile.DeleteAll();
		ds_uploadFile.ClearData();
		FileDialog0.FileName= "";
		alert("[알림]파일업로드중 오류가 발생하였습니다. 다시 시도해주시기 바랍니다.");
		return false;
	}
	else {
		FileDialog0.FileName= "";
	}
	
}

function Div1_btn_FINDFILE_OnClick(obj)
{
	//FileDialog0.Filter = "ALL File(.xls)|*.xls";
	FileDialog0.Filter = "ALL File(.xls;.xlsx)|*.xls;*.xlsx";	
	FileDialog0.Type = "OPEN";
	if (!FileDialog0.Open()) {
		alert(setPopMessage("1009"));	//  파일 선택 창을 여는데 실패하였습니다.
		return;
	} 

	ds_HAYZ206UC.ClearData();
	
	Div2.Visible = true;
	
	file_name = FileDialog0.FileName;
	var file_path = FileDialog0.FilePath;
	var path = file_path + "\\" + file_name;
	setMessageDirect(path);	
	ed_path.Text = path;
	
	ext_ExcelImportByIndex(path,2,"ds_HAYZ206UC",1,1,0,2);//upload4
	//trace(ds_HAYZ206UC.SaveXML());
	if (ds_HAYZ206UC.rowcount < 1){
		alert("[경고] 생성할 data가 없습니다. 확인바랍니다."); 
		return;	
	}
	//파일업로드관련 DATASET 및 파일명 생성
	//var imgName = "의료비명세서_"+comboBoxPlant.Text+"_"+substr(cmb_PTJYM.Value,0,4)+".xls";
	var imgName = "의료비명세서_"+comboBoxPlant.Text+"_"+substr(cmb_PTJYM.Value,0,4)+substr(file_name, indexOf(file_name,"."));
	//데이터셋에 로우 추가
	ds_uploadFile.addRow();
	//다이얼로그에서 선택한 파일의 경로명(파일명포함)을 데이터셋에 저장
	ds_uploadFile.SetColumn(ds_uploadFile.row,"fullname", path);
	//다이얼로그에서 선택한 파일명을 데이터셋에 저장
	ds_uploadFile.SetColumn(ds_uploadFile.row,"filename", imgName);	
	//END
	
	//DATA유효성검증
	chkExcelData();
	
	Div2.Visible = false;
}

//파일업로드
function file_Upload(obj)
{
	//연말정산파일저장경로는 년도별폴더/사업부 폴더에 저장한다.
	var gImgPath =substr(cmb_PTJYM.Value,0,4)+"Year/";

	if(ComboBoxPlant.Value =="E1"){
		 gImgPath = gImgPath + "KE/";
	}else if(ComboBoxPlant.Value =="C1"){
		 gImgPath = gImgPath + "KAC/";
	}else if(ComboBoxPlant.Value =="H1"){
		 gImgPath = gImgPath + "KAH/";
	}else if(ComboBoxPlant.Value =="S1"){
		 gImgPath = gImgPath + "KAS/";
	}
	
	var ret;
	//파일선택 버튼을 이용해서 선택된 파일이 없는 경우 처리 생략
	if(ds_uploadFile.rowcount != 0){
		//데이터셋 로우 수 만큼 루프
		for ( var i = 0 ; i < ds_uploadFile.rowcount ; i++ )
		{
			// 풀경로 취득
			var file_url = ds_uploadFile.getColumn(i,"fullname");		
			//로컬에서 선택한 파일명을 취득하여 변수에 설정
			var str_param = ds_uploadFile.getColumn(i,"filename");
			//업로드 할 서버 경로와 파일명
			//var str_param_server = imgUPDOWNpath + str_param;
			var str_param_server = imgUPDOWNpath + gImgPath + str_param;
			//스크립트 파일의 함수 호출 
			ret = gfn_FileWrite(CyHttpFile0, file_url, str_param_server, i, "prog_bar", CyHttpFile0);									
			//호출함수 리턴값 처리
			if ( ret[0] == "FAIL" )
			{
				alert(ret[1]);
				break;
			}
		}
	}
	return true;	
}

function setHAYZ206UC()
{
	if(!validationChk()){
		return;
	}
	errcnt=0;
	FrDate = substr(cmd_PTJYM_FR.Value,0,6); //기준년월(시작)
	ToDate = substr(cmd_PTJYM_TO.Value,0,6); //기준년월(종료)
	TotCnt=0;
	Recode_Cnt=0;
	ta_RESULT.Text="";
	
	if (ComboBoxPlant.Value = "E1") {										//PE
		brandname = "덴소코리아일렉트로닉스주식회사";  				//법인명(40)
		SsId = "6098101877"; 												//사업자등록번호
		BsId = "1942110000141";  											//법인번호
		TaxId = "DNPE538";  												//홈택스ID
		FileName = "CA6098101.877";
		//Lib1 ="PERESLIB";//cigma library
		//Lib2 ="PSEDBLIB";//회사 library
		//Lib3 ="PSEDBLIB";//사업부 library
	}else if (ComboBoxPlant.Value = "C1") {									//KA창원
		brandname = "덴소코리아오토모티브주식회사";  				//법인명(40)
		SsId = "2068128245";  												//사업자등록번호
		BsId = "1101112040585";  											//법인번호
		TaxId = "DNPS200";  												//홈택스ID
		FileName = "CA2068128.245";  										//"C"+사업자등록번호
		//Lib1 ="PSRESLIB";//cigma library
		//Lib2 ="PSCDBLIB";//회사 library
		//Lib3 ="PSCDBLIB";//사업부 library
	} else if (ComboBoxPlant.Value = "H1") {									//PS홍성
		brandname = "덴소코리아오토모티브주식회사"; 			 	//법인명(40)
		SsId = "3108509579"; 												//사업자등록번호
		BsId = "1101112040585";  											//법인번호
		TaxId = "DNPSHS";  													//홈택스ID
		FileName = "CA3108509.579";  										//"C"+사업자등록번호
		//Lib1 ="PSRESLIB";//cigma library
		//Lib2 ="PSCDBLIB";//회사 library
		//Lib3 ="PSHDBLIB";//사업부 library
	} else if (ComboBoxPlant.Value = "S1") {  								//PS화성
		brandname = "덴소코리아오토모티브주식회사"; 			 	//법인명(40)
		SsId = "1248561218"; 												//사업자등록번호
		BsId = "1101112040585";  											//법인번호
		TaxId = "";  														//홈택스ID      
		FileName = "CA1248561.218";  										//"C"+사업자등록번호
		//Lib1 ="PSRESLIB";//cigma library
		//Lib2 ="PSCDBLIB";//회사 library
		//Lib3 ="PSSDBLIB";//사업부 library		
	}
	
	ed_RECCNT.Text=ds_HAYZ206UC.rowcount;	//레코드총 건수
	ed_HOPCNT.Text=ds_HAYZ206UC.Sum("HOPCNT"); //총 지급건수
	ed_COST.Text=ds_HAYZ206UC.Sum("HOPMON"); //총 지급금액

	var cur_SABUN, aft_SABUN;
	var sabun_SEQ=1;//소득자별 일련번호(4번항목)
	
	var result_A="";
	for (i = 0; i < ds_HAYZ206UC.rowcount; i++) {
		result_A="";
		// [자료관리번호]  
		//  1.레코드구분 + 2.자료구분 + 3.세무서 +  4.일련번호9(6) +  5.제출일자 
		result_A = "A" + "26" + "609" +rightb("000000" + (i+1), 6) + cmb_SUBMISSION.Value;
		
		// [제출자] 
		//  6.사업자등록번호X(10) + 7.홈테스ID X(20) + 8.세무프로그램코드X(4)
		result_A += leftb(SsId + space(10), 10) + leftb(TaxId + space(20), 20) + "9000";
		
		// [원천징수의무자] 
		//  9.사업자등록번호X(10) +  10.상호X(40)
		result_A += leftb(SsId + space(10), 10) + leftb(brandname + space(40), 40);
		
		// [소득자(연말정산신청자)] 
		//result_A11.소득자주민등록번호X(13) + 12.내외국인코드 9(1) + 13.성명X(30)
		result_A += leftb(trim(ds_HAYZ206UC.GetColumn(i,"KORNO")) + space(13), 13) + 
				  rightb("0" + ds_HAYZ206UC.GetColumn(i,"FORCDA"), 1) + 
				  leftb(trim(ds_HAYZ206UC.GetColumn(i,"KORNM")) + space(30), 30);
		
		// [지급처] 
		//  14.지급처사업자등록번호X(10) + 15.지급처상호 X(40) + 16.의료증빙코드X(1)
		result_A += leftb(trim(ds_HAYZ206UC.GetColumn(i,"HOPNO")) + space(10), 10) + 
				  leftb(trim(ds_HAYZ206UC.GetColumn(i,"HOPNM")) + space(40), 40) + 
				  leftb(trim(ds_HAYZ206UC.GetColumn(i,"HOPCD")) + space(1), 1);
		
		// [지급명세] 
		//  17.건수9(5) + 18.금액 9(11) + 19.난임수술비해당여부X(1)
		result_A += rightb("00000" + ds_HAYZ206UC.GetColumn(i,"HOPCNT"), 5) +
				  rightb("00000000000" + ds_HAYZ206UC.GetColumn(i,"HOPMON"), 11) +
				  leftb(iif(ds_HAYZ206UC.GetColumn(i,"DFFCD") == "1","1","") + space(1), 1);
				  
		// [의료비공제대상자] 
		//  20.주민등록번호X(13) + 21.내외국인코드 9(1) + 22.본인등해당여부9(1) + 23.제출대상기간코드9(1) + 24.공란X(19)
		result_A += leftb(trim(ds_HAYZ206UC.GetColumn(i,"APPNO")) + space(13), 13) + 
				  rightb("0" + trim(ds_HAYZ206UC.GetColumn(i,"FORCDB")), 1) +
				  rightb("0" + trim(ds_HAYZ206UC.GetColumn(i,"APPCD")), 1) +
				  "1" +
				  space(19);
		if(lengthb(result_A) !=251 ) {
			//alert("result길이 error"+lengthb(result_A)+"=="+ds_HAYZ206UC.GetColumn(i,"SABUN")+"("+ds_HAYZ206UC.GetColumn(i,"APPNO")+")");
			trace("result길이 error"+lengthb(result_A)+"=="+ds_HAYZ206UC.GetColumn(i,"SABUN")+"("+ds_HAYZ206UC.GetColumn(i,"APPNO")+")");
			errcnt += 1;
			return;
		}
		result += result_A;
		result += "\r\n";
		Recode_Cnt += 1;
		TotCnt += 1;//총 row계산
		
		
		/*
		참고사항 START
		*/
		//현재조회중인 사번
		cur_SABUN=ds_HAYZ206UC.GetColumn(i,"SABUN");
		//사번이 변경되면 D레코드를 조회한다.!!!!
		aft_SABUN=ds_HAYZ206UC.GetColumn(i+1,"SABUN");
		if(cur_SABUN!=aft_SABUN){
			sabun_SEQ +=1;	// 중복을 제거한 소득자 수
		}
		
		/*
		참고사항 END
		*/
	}
		ed_ACCOUNT.Text=(sabun_SEQ-1);	//소득자건수 -'소득자 건수'는 중복을 소득자 수

		ta_RESULT.Text = result;
		
		if(length(trim(result))!=0){
			fn_write();
		}else{
			alert("[알림]생성할 DATA가 없습니다.");
		}
}
function chkExcelData(){

	//사번이 없는 DATA는 삭제
	for(i=ds_HAYZ206UC.rowcount; i>=0; i--){
		if(length(trim(ds_HAYZ206UC.GetColumn(i,"SABUN")))==0 || trim(ds_HAYZ206UC.GetColumn(i,"SABUN"))=0){
			ds_HAYZ206UC.DeleteRow(i);
		}
	}

	for(i=0; i<ds_HAYZ206UC.rowcount; i++){
		var p_FORCDA=trim(ds_HAYZ206UC.GetColumn(i,"FORCDA"));//소득자 내외국인 구분
		var p_HOPCD=trim(ds_HAYZ206UC.GetColumn(i,"HOPCD"));//의료증빙코드
		var p_FORCDB=trim(ds_HAYZ206UC.GetColumn(i,"FORCDB"));//의료비공제대상 내외국인 구분
		var p_APPCD=trim(ds_HAYZ206UC.GetColumn(i,"APPCD"));//본인등 여부
		if(p_FORCDA !=1 && p_FORCDA !=9){
			alert("[알림]"+(i+1)+"번째줄의 소득자 내외국인 구분코드를 확인하세요");
			return;
		}
		if(p_HOPCD !=0 && p_HOPCD !=1 && p_HOPCD !=2 && p_HOPCD !=3 && p_HOPCD !=4 && p_HOPCD !=5){
			alert("[알림]"+(i+1)+"번째줄의 의료증빙코드를 확인하세요");
			return;
		}
		if(p_FORCDB !=1 && p_FORCDB !=9){
			alert("[알림]"+(i+1)+"번째줄의 대상자 내외국인 구분코드를 확인하세요");
			return;
		}
		if(p_APPCD !=1 && p_APPCD !=2){
			alert("[알림]"+(i+1)+"번째줄의 본인등 여부를 확인하세요");
			return;
		}
	}
	ds_HAYZ206UC.Sort("SABUN");
}]]></Script>
</Window>