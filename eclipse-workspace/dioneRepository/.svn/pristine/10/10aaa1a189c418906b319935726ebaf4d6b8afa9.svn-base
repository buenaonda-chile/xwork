<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">
    
<sqlMap namespace="chart">

	<select id="selectChart01" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT B.COMPS, B.PROCS, B.PSPNO,
			SUM(B.AMT_01) AS AMT_01, SUM(B.AMT_02) AS AMT_02, SUM(B.AMT_03) AS AMT_03, 
			SUM(B.AMT_04) AS AMT_04, SUM(B.AMT_05) AS AMT_05, SUM(B.AMT_06) AS AMT_06, 
			SUM(B.AMT_07) AS AMT_07, SUM(B.AMT_08) AS AMT_08, SUM(B.AMT_09) AS AMT_09, 
			SUM(B.AMT_10) AS AMT_10, SUM(B.AMT_11) AS AMT_11, SUM(B.AMT_12) AS AMT_12
		FROM
		(
			SELECT A.COMPS, A.PROCS, A.PSPNO,
				CASE A.MONTH WHEN '01' THEN SUM(A.AMT) ELSE 0 END AMT_01,
				CASE A.MONTH WHEN '02' THEN SUM(A.AMT) ELSE 0 END AMT_02,
				CASE A.MONTH WHEN '03' THEN SUM(A.AMT) ELSE 0 END AMT_03,
				CASE A.MONTH WHEN '04' THEN SUM(A.AMT) ELSE 0 END AMT_04,
				CASE A.MONTH WHEN '05' THEN SUM(A.AMT) ELSE 0 END AMT_05,
				CASE A.MONTH WHEN '06' THEN SUM(A.AMT) ELSE 0 END AMT_06,
				CASE A.MONTH WHEN '07' THEN SUM(A.AMT) ELSE 0 END AMT_07,
				CASE A.MONTH WHEN '08' THEN SUM(A.AMT) ELSE 0 END AMT_08,
				CASE A.MONTH WHEN '09' THEN SUM(A.AMT) ELSE 0 END AMT_09,
				CASE A.MONTH WHEN '10' THEN SUM(A.AMT) ELSE 0 END AMT_10,
				CASE A.MONTH WHEN '11' THEN SUM(A.AMT) ELSE 0 END AMT_11,
				CASE A.MONTH WHEN '12' THEN SUM(A.AMT) ELSE 0 END AMT_12			
			FROM
			(
				SELECT 
					COMPS,
					PROCS,
					PSPNO,
					SUBSTR(CAST(TRNDT AS VARCHAR(8)), 5, 2) AS MONTH,
					PRTCS*PRTQY AS AMT
				FROM $LIB$.FMD101LF
				WHERE COMPS != ''
					<isNotEmpty prepend="AND" property="COMPS">
						COMPS = #COMPS#
					</isNotEmpty>	
					<isNotEmpty prepend="AND" property="TRNDT">
						CAST(TRNDT AS VARCHAR(8)) LIKE '$TRNDT$%'
					</isNotEmpty>
					<isNotEmpty prepend="AND" property="PSPNO">
						TRIM(PSPNO) = #PSPNO#
					</isNotEmpty>
			) A
			GROUP BY COMPS, PROCS, PSPNO, MONTH
		) B
		GROUP BY COMPS, PROCS, PSPNO
		ORDER BY COMPS, PROCS, PSPNO
	</select>
	
	<select id="selectChart02_0" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT COMPS, TRIM(C.CODE_NAME) AS COMPS_NAME, PRTQY, SILQY, (SILQY*100/PRTQY) AS PER
		FROM
		(		
			SELECT		
				COMPS,
				SUM(PRTQY) PRTQY,		
				SUM(SILQY) SILQY		
			FROM PSCDBLIB.FMD152PF
			WHERE COMPS != ''			
				<isNotEmpty prepend="AND" property="COMPS">
					COMPS = #COMPS#
				</isNotEmpty>	
				<isNotEmpty prepend="AND" property="PRTYM">
					CAST(PRTYM AS VARCHAR(8)) LIKE '$PRTYM$%'
				</isNotEmpty>						
				<isNotEmpty prepend="AND" property="PSPNO">
					TRIM(PSPNO) = #PSPNO#
				</isNotEmpty>
			GROUP BY COMPS		
		) A
		LEFT OUTER JOIN PSZDBLIB.M_COM_CDE C
		ON CLASS = 'PLNT' AND C.CODE2=A.COMPS	
	</select>
	
	<select id="selectChart02_1" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT B.COMPS, TRIM(MAX(C.CODE_NAME)) AS COMPS_NAME,
			SUM(B.PRTQY_01) AS PRTQY_01, SUM(B.PRTQY_02) AS PRTQY_02, SUM(B.PRTQY_03) AS PRTQY_03, 
			SUM(B.PRTQY_04) AS PRTQY_04, SUM(B.PRTQY_05) AS PRTQY_05, SUM(B.PRTQY_06) AS PRTQY_06, 
			SUM(B.PRTQY_07) AS PRTQY_07, SUM(B.PRTQY_08) AS PRTQY_08, SUM(B.PRTQY_09) AS PRTQY_09, 
			SUM(B.PRTQY_10) AS PRTQY_10, SUM(B.PRTQY_11) AS PRTQY_11, SUM(B.PRTQY_12) AS PRTQY_12,

			SUM(B.SILQY_01) AS SILQY_01, SUM(B.SILQY_02) AS SILQY_02, SUM(B.SILQY_03) AS SILQY_03, 
			SUM(B.SILQY_04) AS SILQY_04, SUM(B.SILQY_05) AS SILQY_05, SUM(B.SILQY_06) AS SILQY_06, 
			SUM(B.SILQY_07) AS SILQY_07, SUM(B.SILQY_08) AS SILQY_08, SUM(B.SILQY_09) AS SILQY_09, 
			SUM(B.SILQY_10) AS SILQY_10, SUM(B.SILQY_11) AS SILQY_11, SUM(B.SILQY_12) AS SILQY_12
		FROM
		(
			SELECT A.COMPS,
				CASE A.MONTH WHEN '01' THEN SUM(A.PRTQY) ELSE 0 END PRTQY_01,
				CASE A.MONTH WHEN '02' THEN SUM(A.PRTQY) ELSE 0 END PRTQY_02,
				CASE A.MONTH WHEN '03' THEN SUM(A.PRTQY) ELSE 0 END PRTQY_03,
				CASE A.MONTH WHEN '04' THEN SUM(A.PRTQY) ELSE 0 END PRTQY_04,
				CASE A.MONTH WHEN '05' THEN SUM(A.PRTQY) ELSE 0 END PRTQY_05,
				CASE A.MONTH WHEN '06' THEN SUM(A.PRTQY) ELSE 0 END PRTQY_06,
				CASE A.MONTH WHEN '07' THEN SUM(A.PRTQY) ELSE 0 END PRTQY_07,
				CASE A.MONTH WHEN '08' THEN SUM(A.PRTQY) ELSE 0 END PRTQY_08,
				CASE A.MONTH WHEN '09' THEN SUM(A.PRTQY) ELSE 0 END PRTQY_09,
				CASE A.MONTH WHEN '10' THEN SUM(A.PRTQY) ELSE 0 END PRTQY_10,
				CASE A.MONTH WHEN '11' THEN SUM(A.PRTQY) ELSE 0 END PRTQY_11,
				CASE A.MONTH WHEN '12' THEN SUM(A.PRTQY) ELSE 0 END PRTQY_12,
				
				CASE A.MONTH WHEN '01' THEN SUM(A.SILQY) ELSE 0 END SILQY_01,
				CASE A.MONTH WHEN '02' THEN SUM(A.SILQY) ELSE 0 END SILQY_02,
				CASE A.MONTH WHEN '03' THEN SUM(A.SILQY) ELSE 0 END SILQY_03,
				CASE A.MONTH WHEN '04' THEN SUM(A.SILQY) ELSE 0 END SILQY_04,
				CASE A.MONTH WHEN '05' THEN SUM(A.SILQY) ELSE 0 END SILQY_05,
				CASE A.MONTH WHEN '06' THEN SUM(A.SILQY) ELSE 0 END SILQY_06,
				CASE A.MONTH WHEN '07' THEN SUM(A.SILQY) ELSE 0 END SILQY_07,
				CASE A.MONTH WHEN '08' THEN SUM(A.SILQY) ELSE 0 END SILQY_08,
				CASE A.MONTH WHEN '09' THEN SUM(A.SILQY) ELSE 0 END SILQY_09,
				CASE A.MONTH WHEN '10' THEN SUM(A.SILQY) ELSE 0 END SILQY_10,
				CASE A.MONTH WHEN '11' THEN SUM(A.SILQY) ELSE 0 END SILQY_11,
				CASE A.MONTH WHEN '12' THEN SUM(A.SILQY) ELSE 0 END SILQY_12
			FROM
			(
				SELECT 
					COMPS,
					PRTQY,
					SILQY,
					SUBSTR(CAST(PRTYM AS VARCHAR(8)), 5, 2) AS MONTH
				FROM PSCDBLIB.FMD152PF
				WHERE COMPS != ''			
					<isNotEmpty prepend="AND" property="COMPS">
						COMPS = #COMPS#
					</isNotEmpty>	
					<isNotEmpty prepend="AND" property="PRTYM">
						CAST(PRTYM AS VARCHAR(8)) LIKE '$PRTYM$%'
					</isNotEmpty>		
					<isNotEmpty prepend="AND" property="PSPNO">
						TRIM(PSPNO) = #PSPNO#
					</isNotEmpty>
			) A
			GROUP BY COMPS, MONTH
		) B
		LEFT OUTER JOIN PSZDBLIB.M_COM_CDE C
		ON CLASS = 'PLNT' AND C.CODE2=B.COMPS		
		GROUP BY COMPS
		ORDER BY COMPS
	</select>
	
	<select id="selectChart03" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT		
			T.PYVND,		
			T.CUSNM,		
			ROUND(SUM(JPSAM_01)/10000, 0) JPSAM_01, ROUND(SUM(JPSAM_02)/10000, 0) JPSAM_02, ROUND(SUM(JPSAM_03)/10000, 0) JPSAM_03,		
			ROUND(SUM(JPSAM_04)/10000, 0) JPSAM_04, ROUND(SUM(JPSAM_05)/10000, 0) JPSAM_05, ROUND(SUM(JPSAM_06)/10000, 0) JPSAM_06, 		
			ROUND(SUM(JPSAM_07)/10000, 0) JPSAM_07, ROUND(SUM(JPSAM_08)/10000, 0) JPSAM_08, ROUND(SUM(JPSAM_09)/10000, 0) JPSAM_09,	
			ROUND(SUM(JPSAM_10)/10000, 0) JPSAM_10, ROUND(SUM(JPSAM_11)/10000, 0) JPSAM_11, ROUND(SUM(JPSAM_12)/10000, 0) JPSAM_12
		FROM		
		(		
			SELECT		
				Q.PYVND,		
				Q.CUSNM,		
				Q.MONTH,		
				CASE Q.MONTH WHEN '01' THEN Q.JPSAM ELSE 0 END JPSAM_01,		
				CASE Q.MONTH WHEN '02' THEN Q.JPSAM ELSE 0 END JPSAM_02,		
				CASE Q.MONTH WHEN '03' THEN Q.JPSAM ELSE 0 END JPSAM_03,		
				CASE Q.MONTH WHEN '04' THEN Q.JPSAM ELSE 0 END JPSAM_04,		
				CASE Q.MONTH WHEN '05' THEN Q.JPSAM ELSE 0 END JPSAM_05,		
				CASE Q.MONTH WHEN '06' THEN Q.JPSAM ELSE 0 END JPSAM_06,		
				CASE Q.MONTH WHEN '07' THEN Q.JPSAM ELSE 0 END JPSAM_07,		
				CASE Q.MONTH WHEN '08' THEN Q.JPSAM ELSE 0 END JPSAM_08,		
				CASE Q.MONTH WHEN '09' THEN Q.JPSAM ELSE 0 END JPSAM_09,		
				CASE Q.MONTH WHEN '10' THEN Q.JPSAM ELSE 0 END JPSAM_10,		
				CASE Q.MONTH WHEN '11' THEN Q.JPSAM ELSE 0 END JPSAM_11,		
				CASE Q.MONTH WHEN '12' THEN Q.JPSAM ELSE 0 END JPSAM_12		
			FROM		
			(		
				SELECT		
					A.PYVND,	
					B.CUSNM,		
					SUBSTR(VARCHAR(A.JPTDT), 5, 2) AS MONTH,		
					SUM(A.JPSAM) AS JPSAM		
				FROM PSCDBLIB.SMD110PF A, PSRESLIB.CUSMAS1 B		
				WHERE		
					A.PYVND = B.CUSNO
					<isNotEmpty prepend="AND" property="COMPS">
						COMPS = #COMPS#
					</isNotEmpty>
					<isNotEmpty prepend="AND" property="JPTDT">
						SUBSTR(VARCHAR(A.JPTDT), 1, 4) = #JPTDT#
					</isNotEmpty>
					<isNotEmpty prepend="AND" property="PRDCD_FROM">	
						PRDCD <![CDATA[>=]]> #PRDCD_FROM#
					</isNotEmpty>
					<isNotEmpty prepend="AND" property="PRDCD_TO">	
						PRDCD <![CDATA[<=]]> #PRDCD_TO#
					</isNotEmpty>
				GROUP BY A.PYVND, SUBSTR(VARCHAR(A.JPTDT), 5, 2), B.CUSNM		
			)Q		
		)T		
		GROUP BY T.PYVND, T.CUSNM
	</select>
	
	<select id="selectChart04" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT ORDAT, PROCS,
			PRD01*100/ATO01 AS F08T09F2030T2130,
			(CASE WHEN PRD02 = 0 OR  ATO02 = 0 THEN 0 ELSE (PRD01+PRD02)*100/(ATO01+ATO02) END) AS F09T10F2130T2300,
			(CASE WHEN PRD03 = 0 OR  ATO03 = 0 THEN 0 ELSE (PRD01+PRD02+PRD03)*100/(ATO01+ATO02+ATO03) END) AS F10T11F23T00,
			(CASE WHEN PRD04 = 0 OR  ATO04 = 0 THEN 0 ELSE (PRD01+PRD02+PRD03+PRD04)*100/(ATO01+ATO02+ATO03+ATO04) END) AS F11T12F00T02,
			(CASE WHEN PRD05 = 0 OR  ATO05 = 0 THEN 0 ELSE (PRD01+PRD02+PRD03+PRD04+PRD05)*100/(ATO01+ATO02+ATO03+ATO04+ATO05) END) AS F13T14F02T04,
			(CASE WHEN PRD06 = 0 OR  ATO06 = 0 THEN 0 ELSE (PRD01+PRD02+PRD03+PRD04+PRD05+PRD06)*100/(ATO01+ATO02+ATO03+ATO04+ATO05+ATO06) END) AS F14T15F04T05,
			(CASE WHEN PRD07 = 0 OR  ATO07 = 0 THEN 0 ELSE (PRD01+PRD02+PRD03+PRD04+PRD05+PRD06+PRD07)*100/(ATO01+ATO02+ATO03+ATO04+ATO05+ATO06+ATO07) END) AS F15T16F05T06,
			(CASE WHEN PRD08 = 0 OR  ATO08 = 0 THEN 0 ELSE (PRD01+PRD02+PRD03+PRD04+PRD05+PRD06+PRD07+PRD08)*100/(ATO01+ATO02+ATO03+ATO04+ATO05+ATO06+ATO07+ATO08) END) AS F16T17F06T07,
			(CASE WHEN PRD09 = 0 OR  ATO09 = 0 THEN 0 ELSE (PRD01+PRD02+PRD03+PRD04+PRD05+PRD06+PRD07+PRD08+PRD09)*100/(ATO01+ATO02+ATO03+ATO04+ATO05+ATO06+ATO07+ATO08+ATO09) END) AS F17T18F07T08,
			(CASE WHEN PRD10 = 0 OR  ATO10 = 0 THEN 0 ELSE (PRD01+PRD02+PRD03+PRD04+PRD05+PRD06+PRD07+PRD08+PRD09+PRD10)*100/(ATO01+ATO02+ATO03+ATO04+ATO05+ATO06+ATO07+ATO08+ATO09+ATO10) END) AS F18T19,
			(CASE WHEN PRD11 = 0 OR  ATO11 = 0 THEN 0 ELSE (PRD01+PRD02+PRD03+PRD04+PRD05+PRD06+PRD07+PRD08+PRD09+PRD10+PRD11)*100/(ATO01+ATO02+ATO03+ATO04+ATO05+ATO06+ATO07+ATO08+ATO09+ATO10+ATO11) END) AS F19T20,
			(CASE WHEN PRD12 = 0 OR  ATO12 = 0 THEN 0 ELSE (PRD01+PRD02+PRD03+PRD04+PRD05+PRD06+PRD07+PRD08+PRD09+PRD10+PRD11+PRD12)*100/(ATO01+ATO02+ATO03+ATO04+ATO05+ATO06+ATO07+ATO08+ATO09+ATO10+ATO11+ATO12) END) AS F20T21
		FROM PSEDBLIB.FGP250PF		
		WHERE COMPS = '$COMPS$' 
		AND DAYGU = '$DAYGU$'
		AND ORDAT = '$ORDAT$'		
		AND PROCS IN ( $ROWGB$ )	
		ORDER BY PROCS
	</select>
	
	<select id="selectChart05" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT
			MONTH,
			SUM(Q.PRTQY) PRTQY,		
			ROUND(SUM(Q.PRT_PRICE)/10000, 0) PRT_PRICE,
			SUM(Q.SILQY) SILQY,
			ROUND(SUM(Q.SIL_PRICE)/10000, 0) SIL_PRICE,
			(SUM(Q.SIL_PRICE)*100/SUM(Q.SIL_PRICE)) AS PER
		FROM
		(
			SELECT 		
				SUBSTR(CAST(A.PRTYM AS VARCHAR(8)), 5, 2) AS MONTH,		
				A.PRTQY,		
				A.PRTQY * B.PRICE AS PRT_PRICE,
				A.SILQY,					
				A.SILQY * B.PRICE AS SIL_PRICE
			FROM PSCDBLIB.FMD116PF A, PSRESLIB.EM001PR B
			WHERE A.PYVND = B.CUSNO
				AND A.PSPNO = B.PRTNO
				AND VARCHAR(A.PRTYM) = SUBSTR(VARCHAR(B.LDUPD), 1, 6)			
				<isNotEmpty prepend="AND" property="COMPS">
					A.COMPS = #COMPS#
				</isNotEmpty>	
				<isNotEmpty prepend="AND" property="PRTYM">
					CAST(A.PRTYM AS VARCHAR(8)) LIKE '$PRTYM$%'
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="PROCS_FROM">
					A.PROCS <![CDATA[>=]]> #PROCS_FROM#
				</isNotEmpty>	
				<isNotEmpty prepend="AND" property="PROCS_TO">
					A.PROCS <![CDATA[<=]]> #PROCS_TO#
				</isNotEmpty>		
		) Q
		GROUP BY Q.MONTH
		ORDER BY Q.MONTH
	</select>

</sqlMap>
