<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.globaldenso.dicas.business.dao.DeliveryDNKRRepairPartDao">

  <resultMap id="codeMap" type="com.globaldenso.dicas.business.dto.DeliveryDNKRRepairPartDto">
  		<id property="delvNo" column="DELV_NO" javaType="java.lang.String" />
		<result property="rgstrId" column="RGSTR_ID" javaType="java.lang.Long" />
		<result property="rgstDt" column="RGST_DT" javaType="java.time.LocalDateTime" />
		<result property="updtrId" column="UPDTR_ID" javaType="java.lang.Long" />
		<result property="updtDt" column="UPDT_DT" javaType="java.time.LocalDateTime" />
		<result property="delvDt" column="DELV_DT" javaType="java.lang.String" />
		<result property="partNo" column="PART_NO" javaType="java.lang.String" />
		<result property="partNm" column="ITEM_KOR_NM" javaType="java.lang.String" />
		<result property="custNm" column="CUST_NM" javaType="java.lang.String" />
		<result property="custId" column="CUST_ID" javaType="java.lang.Long" />
		<result property="custEmpId" column="DELV_EMP_SEQ" javaType="java.lang.Long" />
		<result property="custEmpNm" column="CUST_EMP_NM" javaType="java.lang.String" />
		<result property="admissStatus" column="ADMISS_STATUS" javaType="java.lang.String" />
		<result property="delvDiv" column="DELV_DIV" javaType="java.lang.String" />
		<result property="remark" column="ETC_CN" javaType="java.lang.String" />
		<result property="chk" column="CHK" javaType="java.lang.String" />
  </resultMap>

  <sql id="select_01">
  	select *
  	   from(
	 select  ID
			,RGSTR_ID
			,RGST_DT
			,UPDTR_ID
			,UPDT_DT
			,EDU_DIV
			,(SELECT CODE_KO_NM FROM TB_CM_CODE WHERE GRP_CD = 'EDUCATION' AND CODE_CD  = EDU_DIV) AS EDU_DIV_NM
			,EDU_NM
			,TO_CHAR(EDU_DT, 'YYYYMMDDHH24MI') AS EDU_DT
			,TO_CHAR(RECEIPT_END_DATE, 'YYYYMMDDHH24MI') AS RECEIPT_END_DATE
			,PERS_CNT
			,ONOFF_YN
			,USE_YN
			,REMARK
			,'' AS CHK
	   from TB_ED_EDUCATION_INFO
	   ) X
  </sql>

  <sql id="where_01">

	  <if test="criteria.eduDiv != null and criteria.eduDiv != ''">
		  AND EDU_DIV = UPPER(#{criteria.eduDiv})
	  </if>
	  
	  <if test="criteria.searchEduDtFr != null and criteria.searchEduDtFr != ''">
		  AND EDU_DT  &gt;=  #{criteria.searchEduDtFr}
	  </if>
	  <if test="criteria.searchEduDtTo != null and criteria.searchEduDtTo != ''">
		  AND EDU_DT  &lt;=  #{criteria.searchEduDtTo}  || '9999'
	  </if>

  </sql>

  <sql id="where_02">
  
	  <if test="criteria.eduDiv != null and criteria.eduDiv != ''">
		  AND EDU_DIV = UPPER(#{criteria.eduDiv})
	  </if>

	  <if test="criteria.searchEduDtFr != null and criteria.searchEduDtFr != ''">
		  AND EDU_DT  &gt;=  #{criteria.searchEduDtFr}
	  </if>
	  <if test="criteria.searchEduDtTo != null and criteria.searchEduDtTo != ''">
		  AND EDU_DT  &lt;=  #{criteria.searchEduDtTo}  || '9999'
	  </if>

  </sql>


  <!-- ?? SQL?????? -->
   <select id="searchByKey" resultMap="codeMap" parameterType="com.globaldenso.dicas.business.domain.DeliveryDNKRRepairPartDomain">

    SELECT *
    FROM TB_DELV_MST
    WHERE DELV_NO = #{delvNo}
	  AND ROWNUM = 1

  </select>
  
  
  	<select id="searchByCondition" resultMap="codeMap" parameterType="Map">
  		SELECT * FROM TB_DELV_MST
  		
	</select>
	
	<select id="searchCount" resultType="int" parameterType="Map">

    SELECT COUNT(DELV_NO) AS CNT
    FROM TB_DELV_MST

  </select>

  <insert id="create" parameterType="com.globaldenso.dicas.business.domain.DeliveryDNKRRepairPartDomain">

    INSERT INTO TB_DELV_MST(
			 RECT_NO
			,RGSTR_ID
			,RGST_DT
			,UPDTR_ID
			,UPDT_DT
			,RECT_DT
			,RECT_DIV
			,RECT_STATUS
			,RECT_EMP_SEQ
			,CUST_ID
			,CUST_EMP_NM
			,ADMISS_STATUS
			,ETC_CN
	)VALUES(
			 #{rectNo}
			,#{rgstrId}
			,#{rgstDt}
			,#{updtrId}
			,#{updtDt}
			,TO_DATE(#{rectDt}, 'YYYY-MM-DD')
			,'SD'
			,'S1'
			,'없음'
			,#{custId}
			,#{custEmpNm}
			,'대기'
			,#{remark}
	)

    <selectKey resultType="long" keyProperty="rectNo" order="BEFORE">
      SELECT SEQ_TB_RECT_MST.NEXTVAL FROM DUAL
    </selectKey>

  </insert>

  <update id="update" parameterType="com.globaldenso.dicas.business.domain.DeliveryDNKRRepairPartDomain">

    UPDATE TB_DELV_MST
     SET UPDTR_ID = #{updtrId}
		,UPDT_DT = #{updtDt}
		,RECT_DT = TO_DATE(#{rectDt}, 'YYYY-MM-DD')
		,CUST_ID = #{custId}
		,CUST_EMP_NM = #{custEmpNm}
		,ETC_CN = #{remark}
 	WHERE DELV_NO = #{delvNo}

  </update>

  <delete id="delete" parameterType="com.globaldenso.dicas.business.domain.DeliveryDNKRRepairPartDomain">

    DELETE FROM TB_DELV_MST
    WHERE DELV_NO = #{delvNo}

  </delete>


</mapper>
