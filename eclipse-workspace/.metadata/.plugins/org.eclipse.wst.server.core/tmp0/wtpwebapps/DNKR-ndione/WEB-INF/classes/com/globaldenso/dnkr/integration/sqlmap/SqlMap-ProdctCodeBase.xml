<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.globaldenso.dnkr.integration.dao.ProdctCodeBaseDao">

<!-- 検索結果をMapで受け取る -->
    <resultMap id="prodctCodeBase" type="ProdctCodeBaseDomain">
        <result property="prdtCode" column="PRDT_CODE" />
        <result property="prdtNm" column="PRDT_NM" />
        <result property="startDe" column="START_DE" />
        <result property="endDe" column="END_DE" />
        <result property="refrn" column="REFRN" />
        <result property="regUser" column="REG_USER" />        
        <result property="regDate" column="REG_DATE" />
        <result property="modUser" column="MOD_USER" />
        <result property="modDate" column="MOD_DATE" /> 
        
        <result property="oldPrdtCode" column="OLD_PRDT_CODE" />        
        <result property="oldStartDe" column="OLD_START_DE" />
        <result property="oldEndDe" column="OLD_END_DE" />  
    </resultMap>
    <!-- 検索 SQL文（任意条件） -->
    <select id="searchByCondition" resultMap="prodctCodeBase" parameterType="ProdctCodeBaseDomain">
		SELECT 
			 TRIM(PRDT_CODE) AS PRDT_CODE
			,TRIM(PRDT_NM) AS PRDT_NM
			,(SUBSTR(START_DE,1,4) || '-' || SUBSTR(START_DE,5,2) || '-' || SUBSTR(START_DE,7,2)) AS START_DE  
			,(SUBSTR(END_DE,1,4) || '-' || SUBSTR(END_DE,5,2) || '-' || SUBSTR(END_DE,7,2)) AS END_DE  				
			,TRIM(REFRN) AS REFRN
			,REG_USER
			,REG_DATE
			,MOD_USER
			,MOD_DATE
			,TRIM(PRDT_CODE) AS OLD_PRDT_CODE 	
			,START_DE AS OLD_START_DE 	
			,END_DE AS OLD_END_DE 				
		FROM   PSZDBLIB.FHP040PF
		WHERE 1 = 1
		<if test='prdtCode != null and !prdtCode.equalsIgnoreCase("")'>
			AND PRDT_CODE like '%' || '${prdtCode}' || '%'
		</if> 		
		<if test='prdtNm != null and !prdtNm.equalsIgnoreCase("")'>
			AND PRDT_NM like '%' || '${prdtNm}' || '%'
		</if> 
		<if test='startDe != null and !startDe.equalsIgnoreCase("")'>
			AND #{startDe} BETWEEN START_DE AND END_DE
		</if> 			
				
		ORDER BY PRDT_CODE
		
    </select>
    
    <!-- 検索 SQL文（任意条件 件数取得） -->
    <select id="searchCount" resultType="java.lang.Integer" parameterType="ProdctCodeBaseDomain">
        SELECT 
              COUNT(*) CNT 
        FROM 
             PSZDBLIB.FHP040PF
        WHERE PRDT_CODE = #{prdtCode}
        AND START_DE = #{startDe}
        
    </select>
    
    <!-- 検索 SQL文（任意条件 件数取得） -->
    <select id="searchCount2" resultType="java.lang.Integer" parameterType="ProdctCodeBaseDomain">
        SELECT 
              COUNT(*) CNT 
        FROM 
             PSZDBLIB.FHP040PF
        WHERE PRDT_CODE = #{oldPrdtCode}
        AND START_DE = #{oldStartDe}
    </select>    


    <!-- 検索 SQL文（任意条件 件数取得） -->
    <select id="searchCount3" resultType="java.lang.Integer" parameterType="ProdctCodeBaseDomain">
        SELECT 
              COUNT(*) CNT 
        FROM 
             PSZDBLIB.FHP040PF
        WHERE PRDT_CODE = #{prdtCode}
        AND #{startDe} BETWEEN START_DE AND END_DE
        
    </select>
    
    <!-- 検索 SQL文（任意条件 件数取得） -->
    <select id="searchCount4" resultType="java.lang.Integer" parameterType="ProdctCodeBaseDomain">
        SELECT 
              COUNT(*) CNT 
        FROM 
             PSZDBLIB.FHP040PF
        WHERE PRDT_CODE = #{prdtCode}
        AND #{endDe} BETWEEN START_DE AND END_DE
        
    </select>
    
    <!-- 検索 SQL文（任意条件 件数取得） -->
    <select id="searchCount5" resultType="java.lang.Integer" parameterType="ProdctCodeBaseDomain">
        SELECT 
              COUNT(*) CNT 
        FROM 
             PSZDBLIB.FHP040PF
        WHERE PRDT_CODE = #{oldPrdtCode}
        AND START_DE <![CDATA[<>]]> '${oldStartDe}'
        AND END_DE <![CDATA[<>]]> '${oldEndDe}'        
        AND #{startDe} BETWEEN START_DE AND END_DE
        
    </select>
    
    <!-- 検索 SQL文（任意条件 件数取得） -->
    <select id="searchCount6" resultType="java.lang.Integer" parameterType="ProdctCodeBaseDomain">
        SELECT 
              COUNT(*) CNT 
        FROM 
             PSZDBLIB.FHP040PF
        WHERE PRDT_CODE = #{oldPrdtCode}
        AND START_DE <![CDATA[<>]]> '${oldStartDe}'
        AND END_DE <![CDATA[<>]]> '${oldEndDe}'          
        AND #{endDe} BETWEEN START_DE AND END_DE
        
    </select>             
        
    <!-- 登録 SQL文 -->
    <insert id="create" parameterType ="ProdctCodeBaseDomain">
        INSERT INTO  PSZDBLIB.FHP040PF (
				 PRDT_CODE
				,PRDT_NM
				,START_DE
				,END_DE
				,REFRN
				,REG_USER
				,REG_DATE
        ) values (
                #{prdtCode}
               ,#{prdtNm}
               ,#{startDe}
               ,#{endDe}
               ,#{refrn}
               ,#{regUser}               
               ,REPLACE(CHAR(DATE(CURRENT DATE), ISO), '-','')
        )
    </insert>

	<!-- 更新 SQL文（主キー） -->
    <update id="update" parameterType="ProdctCodeBaseDomain">
        UPDATE 
               PSZDBLIB.FHP040PF
        SET
        	  PRDT_CODE = #{prdtCode}
			 ,PRDT_NM = #{prdtNm}
			 ,START_DE = #{startDe}
			 ,END_DE = #{endDe}
			 ,REFRN = #{refrn}
         	 ,MOD_USER = #{modUser}
             ,MOD_DATE = REPLACE(CHAR(DATE(CURRENT DATE), ISO), '-','')
        WHERE   PRDT_CODE = #{oldPrdtCode}
        AND START_DE = #{oldStartDe}             
    </update>

    <!-- 削除 SQL文（主キー） -->
    <delete id="delete" parameterType="ProdctCodeBaseDomain">
        DELETE 
        FROM 
             PSZDBLIB.FHP040PF
        WHERE   PRDT_CODE = #{prdtCode}
        AND START_DE = #{startDe}        
    </delete>
    
    

</mapper>