<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.globaldenso.dnkr.integration.dao.LosExcIndTmDao">

<!-- 検索結果をMapで受け取る -->
    <resultMap id="LosExcIndTmInput" type="LosExcIndTmDomain">
        <result property="clsCode" column="CLS_CODE" />		<!-- 사업부코드 -->
        <result property="locCode" column="LOC_CODE" />		<!-- 부서코드 -->
        <result property="lineCode" column="LINE_CODE" />	<!-- 라인코드 -->
        <result property="lineNm" column="LINE_NM" /> 		<!-- 라인명 -->
        <result property="code" column="CODE" />			<!-- 작업코드 -->
        <result property="codeNm" column="CODE_NM" /> 		<!-- 작업코드명 -->
        <result property="se" column="SE" />			<!-- 작업코드 -->
        <result property="seNm" column="SE_NM" /> 		<!-- 작업코드명 -->
        <result property="hrMnt" column="HR_MNT" /> 		<!-- 작업코드명 -->
        <result property="regUser" column="REG_USER" />		<!-- 등록자 -->
        <result property="regDate" column="REG_DATE" />		<!-- 등록일 -->
        <result property="modUser" column="MOD_USER" />		<!-- 수정자 -->
        <result property="modDate" column="MOD_DATE" />		<!-- 수정일 -->
             
    </resultMap>

	<select id="searchLineList" resultMap="LosExcIndTmInput" parameterType="LosExcIndTmDomain">
		SELECT 
		    CLS_CODE
		    , LINE_CODE
		    , LINE_NM
		    , LOC_CODE
		FROM PSZDBLIB.FHP010PF
		WHERE 1=1
		<if test='clsCode != null and !clsCode.equalsIgnoreCase("")'>
		  AND CLS_CODE = #{clsCode}
		</if>
		<if test='locCode != null and !locCode.equalsIgnoreCase("")'>
		  AND LOC_CODE = #{locCode}
		</if>
	</select>

	<select id="searchLineValues" resultMap="LosExcIndTmInput" parameterType="LosExcIndTmDomain">
		SELECT 
		    OPERT_DE
		    , CLS_CODE
		    , LOC_CODE
		    , LINE_CODE
		    , SE
		    , CODE
		    , HR_MNT
		FROM PSZDBLIB.FHP130PF
		WHERE 1=1
		  AND OPERT_DE  = #{opertDe}
		<if test='clsCode != null and !clsCode.equalsIgnoreCase("")'>
		  AND CLS_CODE  = #{clsCode}
		</if>
		<if test='locCode != null and !locCode.equalsIgnoreCase("")'>
		  AND LOC_CODE  = #{locCode}
		</if>
	</select>

    <!-- 検索 SQL文（任意条件） -->
    <select id="searchByCondition" resultMap="LosExcIndTmInput" parameterType="LosExcIndTmDomain">
		
		SELECT DISTINCT * FROM (
              SELECT CLS_CODE,
                     SE,
                     CODE,
                     CODE_NM,
                     3 AS CODE_ORD,
                     '손실시간' AS SE_NM
              FROM PSZDBLIB.FHP020PF
              WHERE SE = 'D' 
              UNION ALL
              SELECT CLS_CODE,
                     SE,
                     CODE,
                     CODE_NM,
                     1 AS CODE_ORD,
                     '제외시간' AS SE_NM
              FROM PSZDBLIB.FHP020PF
              WHERE SE = 'B' 
              UNION ALL
              SELECT CLS_CODE,
                     SE,
                     CODE,
                     CODE_NM,
                     2 AS CODE_ORD,
                     '간접시간' AS SE_NM
              FROM PSZDBLIB.FHP020PF
              WHERE SE = 'C' 
         ) AS A
         WHERE 1=1
         <if test='clsCode != null and !clsCode.equalsIgnoreCase("")'>
           AND A.CLS_CODE = #{clsCode}
         </if>
         <if test='locCode != null and !locCode.equalsIgnoreCase("")'>
		   AND 1=1
		 </if>
         ORDER BY A.CODE_ORD ASC, A.CODE ASC
    </select>
    
    <!-- 検索 SQL文（任意条件 件数取得） -->
  	<select id="searchCount" resultType="java.lang.Integer" parameterType="LosExcIndTmDomain">
       
        SELECT 
              COUNT(*) AS CNT 
        FROM 
             PSZDBLIB.FHP130PF
        WHERE 1=1
        AND   OPERT_DE  = #{opertDe}
        AND   CLS_CODE  = #{clsCode}
        AND   LINE_CODE = #{lineCode}
        AND   LOC_CODE  = #{locCode}
        AND   SE 	    = #{se}
        AND   CODE 	    = #{code}
		
    </select>
    
   <!--  登録 SQL文 -->
    <insert id="create" parameterType ="LosExcIndTmDomain">
        INSERT INTO  PSZDBLIB.FHP130PF (
				OPERT_DE 
				, CLS_CODE
				, LOC_CODE
				, LINE_CODE
				, SE
				, CODE
				, HR_MNT
				, REG_USER
				, REG_DATE
        ) values (
        		#{opertDe}
               , #{clsCode}
               , #{locCode}
               , #{lineCode}
               , #{se}
               , #{code}
               , #{hrMnt}    
               , #{regUser}
               , REPLACE(CHAR(DATE(CURRENT DATE), ISO), '-','')
        )
    </insert>

	<!-- 更新 SQL文（主キー） -->
    <update id="update" parameterType="LosExcIndTmDomain">
        UPDATE 
               PSZDBLIB.FHP130PF
        SET
        	HR_MNT = #{hrMnt}
			, MOD_USER  = #{modUser}
            , MOD_DATE  = REPLACE(CHAR(DATE(CURRENT DATE), ISO), '-','')
        WHERE 1=1
        AND   OPERT_DE  = #{opertDe}
        AND   CLS_CODE  = #{clsCode}
        AND   LINE_CODE = #{lineCode}
        AND   LOC_CODE  = #{locCode}
        AND   SE 	    = #{se}
        AND   CODE 	    = #{code}
    </update>

   <!--  削除 SQL文（主キー） -->
    <delete id="delete" parameterType="LosExcIndTmDomain">
        DELETE 
        FROM 
             PSZDBLIB.FHP130PF
        WHERE 1=1
        AND   OPERT_DE  = #{opertDe}
        AND   CLS_CODE  = #{clsCode}
        AND   LINE_CODE = #{lineCode}
        AND   LOC_CODE  = #{locCode}
        AND   SE 	    = #{se}
        AND   CODE 	    = #{code}
    </delete>

</mapper>