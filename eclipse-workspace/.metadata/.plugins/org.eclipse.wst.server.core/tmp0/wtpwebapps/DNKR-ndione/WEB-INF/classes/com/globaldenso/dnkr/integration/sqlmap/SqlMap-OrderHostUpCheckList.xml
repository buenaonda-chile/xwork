<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.globaldenso.dnkr.integration.dao.OrderHostUpCheckListDao">

<!-- 検索結果をMapで受け取る -->
    <resultMap id="OrderHostUpCheckList" type="OrderHostUpCheckListDomain">
        <result property="selchk" column="SELCHK" />
        <result property="comps" column="COMPS" />
        <result property="dumym" column="DUMYM" />        
        <result property="pyvnd" column="PYVND" />        
        <result property="dumcb" column="DUMCB" />        
        <result property="gubcd" column="GUBCD" />
        
        <result property="cusnm" column="CUSNM" />
        <result property="dfacd" column="DFACD" />
        <result property="dmkcr" column="DMKCR" />
        <result property="dsecd" column="DSECD" />
        <result property="dseno" column="DSENO" />
        <result property="cprtn" column="CPRTN" />
        <result property="pspno" column="PSPNO" />
        <result property="itdsc" column="ITDSC" />
        <result property="oemjg" column="OEMJG" />
        <result property="sane" column="SANE" />
        <result property="sawe" column="SAWE" />       
        <result property="mohtq" column="MOHTQ" />
        <result property="culjis" column="CULJIS" />        
        <result property="trimd" column="TRIMD" />
        <result property="pbsqy" column="PBSQY" />
        <result property="patqy" column="PATQY" />
        <result property="wbsqy" column="WBSQY" />
        <result property="pbs" column="PBS" />
		
		<result property="d0t01" column="D0T01" />
		<result property="d0t02" column="D0T02" />
		<result property="d0t03" column="D0T03" />
		<result property="d0t04" column="D0T04" />
		<result property="d0t05" column="D0T05" />
		<result property="d0t06" column="D0T06" />
		<result property="d0t07" column="D0T07" />
		<result property="d0t08" column="D0T08" />
		<result property="d0t09" column="D0T09" />
		<result property="d0t10" column="D0T10" />
		<result property="d0tqy" column="D0TQY" />
		<result property="d1t01" column="D1T01" />
		<result property="d1t02" column="D1T02" />
		<result property="d1t03" column="D1T03" />
		<result property="d1t04" column="D1T04" />
		<result property="d1t05" column="D1T05" />
		<result property="d1t06" column="D1T06" />
		<result property="d1t07" column="D1T07" />
		<result property="d1t08" column="D1T08" />
		<result property="d1t09" column="D1T09" />
		<result property="d1t10" column="D1T10" />
		<result property="d1tqy" column="D1TQY" />
		<result property="d2t01" column="D2T01" />
		<result property="d2t02" column="D2T02" />
		<result property="d2t03" column="D2T03" />
		<result property="d2t04" column="D2T04" />
		<result property="d2t05" column="D2T05" />
		<result property="d2t06" column="D2T06" />
		<result property="d2t07" column="D2T07" />
		<result property="d2t08" column="D2T08" />
		<result property="d2t09" column="D2T09" />
		<result property="d2t10" column="D2T10" />
		<result property="d2tqy" column="D2TQY" />
		<result property="d3t01" column="D3T01" />
		<result property="d3t02" column="D3T02" />
		<result property="d3t03" column="D3T03" />
		<result property="d3t04" column="D3T04" />
		<result property="d3t05" column="D3T05" />
		<result property="d3t06" column="D3T06" />
		<result property="d3t07" column="D3T07" />
		<result property="d3t08" column="D3T08" />
		<result property="d3t09" column="D3T09" />
		<result property="d3t10" column="D3T10" />
		<result property="d3tqy" column="D3TQY" />
		<result property="d4t01" column="D4T01" />
		<result property="d4t02" column="D4T02" />
		<result property="d4t03" column="D4T03" />
		<result property="d4t04" column="D4T04" />
		<result property="d4t05" column="D4T05" />
		<result property="d4t06" column="D4T06" />
		<result property="d4t07" column="D4T07" />
		<result property="d4t08" column="D4T08" />
		<result property="d4t09" column="D4T09" />
		<result property="d4t10" column="D4T10" />
		<result property="d4tqy" column="D4TQY" />		
		<result property="remqy" column="REMQY" />
		<result property="grtot" column="GRTOT" />
		
		<result property="sm0qy" column="SM0QY" />
		<result property="jpsqy" column="JPSQY" />
		<result property="prtqy" column="PRTQY" />
		<result property="ilonjs" column="ILONJS" />

		<result property="dat00" column="DAT00" />
		<result property="dat01" column="DAT01" />
		<result property="dat02" column="DAT02" />
		<result property="dat03" column="DAT03" />
		<result property="dat04" column="DAT04" />
		<result property="dat05" column="DAT05" />
		<result property="dat06" column="DAT06" />
		<result property="dat07" column="DAT07" />
		<result property="dat08" column="DAT08" />
		<result property="dat09" column="DAT09" />
		<result property="dat10" column="DAT10" />
		<result property="dat11" column="DAT11" />
		<result property="dat12" column="DAT12" />	
		
		<result property="okqty" column="OKQTY" />
		<result property="mitqy" column="MITQY" />
		<result property="prseq" column="PRSEQ" />
		<result property="miqqy" column="MIQQY" />
		<result property="mioqy" column="MIOQY" />
		
		<result property="dtq01" column="DTQ01" />
		<result property="dtq02" column="DTQ02" />
		<result property="dtq03" column="DTQ03" />
		<result property="dtq04" column="DTQ04" />
		<result property="dtq05" column="DTQ05" />
		<result property="dtq06" column="DTQ06" />
		<result property="dtq07" column="DTQ07" />
		<result property="dtq08" column="DTQ08" />
		<result property="dtq09" column="DTQ09" />
		<result property="dtq10" column="DTQ10" />
		<result property="dtq11" column="DTQ11" />
		<result property="dtq12" column="DTQ12" />
		<result property="dtq13" column="DTQ13" />
		<result property="dtq14" column="DTQ14" />
		<result property="silqty" column="SILQTY" />

		<result property="dtt01" column="DTT01" />
		<result property="dtt02" column="DTT02" />
		<result property="dtt03" column="DTT03" />
		<result property="dtt04" column="DTT04" />
		<result property="dtt05" column="DTT05" />
		<result property="dtt06" column="DTT06" />
		<result property="dtt07" column="DTT07" />
		<result property="dtt08" column="DTT08" />
		<result property="dtt09" column="DTT09" />
		<result property="dtt10" column="DTT10" />
		
        <result property="lib1" column="lib1" />
        <result property="lib2" column="lib2" />
        <result property="lib3" column="lib3" />     
    </resultMap>
    
    <!-- 検索 SQL文（任意条件） -->
    <select id="searchByCondition" resultMap="OrderHostUpCheckList" parameterType="OrderHostUpCheckListDomain">
    	<if test='selchk.equals("P6")'>
			SELECT 
				A.PYVND,C.CUSNM,A.DFACD,A.DMKCR,A.DSECD,A.DSENO,D.CPRTN,A.PSPNO,B.ITDSC,
				COALESCE(E.OEMJG,0) AS OEMJG,
				COALESCE(F.SANE,0) AS SANE,COALESCE(F.SAWE,0) AS SAWE,COALESCE(F.MOHTQ,0) AS MOHTQ,
				COALESCE(E.CULJIS,0) AS CULJIS,
				A.TRIMD,A.PBSQY,A.PATQY,A.WBSQY,(A.PBSQY+A.PATQY+A.WBSQY) AS PBS,
				A.D0T01,A.D0T02,A.D0T03,A.D0T04,A.D0T05,A.D0T06,A.D0T07,A.D0T08,A.D0T09,A.D0T10,A.D0TQY,
				A.D1T01,A.D1T02,A.D1T03,A.D1T04,A.D1T05,A.D1T06,A.D1T07,A.D1T08,A.D1T09,A.D1T10,A.D1TQY,
				A.D2T01,A.D2T02,A.D2T03,A.D2T04,A.D2T05,A.D2T06,A.D2T07,A.D2T08,A.D2T09,A.D2T10,A.D2TQY,
				A.D3T01,A.D3T02,A.D3T03,A.D3T04,A.D3T05,A.D3T06,A.D3T07,A.D3T08,A.D3T09,A.D3T10,A.D3TQY,
				A.D4T01,A.D4T02,A.D4T03,A.D4T04,A.D4T05,A.D4T06,A.D4T07,A.D4T08,A.D4T09,A.D4T10,A.D4TQY,
				A.REMQY,A.GRTOT,
				COALESCE(I.SM0QY,0) AS SM0QY,COALESCE(G.JPSQY,0) AS JPSQY,COALESCE(H.PRTQY,0) AS PRTQY,
				COALESCE(F.SAWE-E.CULJIS,0) AS ILONJS,
				COALESCE(COALESCE(E.OEMJG,0)-(A.PBSQY+A.PATQY+A.WBSQY),0) AS DTQ01,
				COALESCE(COALESCE(E.OEMJG,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.D0TQY,0) AS DTQ02,
				COALESCE(COALESCE(E.OEMJG,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.D0TQY-A.D1TQY,0) AS DTQ03,
				COALESCE(COALESCE(E.OEMJG,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.D0TQY-A.D1TQY-A.D2TQY,0) AS DTQ04,
				COALESCE(COALESCE(E.OEMJG,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.D0TQY-A.D1TQY-A.D2TQY-A.D3TQY,0) AS DTQ05,
				COALESCE(COALESCE(E.OEMJG,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.D0TQY-A.D1TQY-A.D2TQY-A.D3TQY-A.D4TQY,0) AS DTQ06,
				
				<!-- Grid cell expr 부분. (SVHE310Q.xml) -->
				COALESCE(COALESCE(E.OEMJG,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.D0T01,0) AS DTT01,
				COALESCE(COALESCE(E.OEMJG,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.D0T01-A.D0T02,0) AS DTT02,
				COALESCE(COALESCE(E.OEMJG,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.D0T01-A.D0T02-A.D0T03,0) AS DTT03,
				COALESCE(COALESCE(E.OEMJG,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.D0T01-A.D0T02-A.D0T03-A.D0T04,0) AS DTT04,
				COALESCE(COALESCE(E.OEMJG,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.D0T01-A.D0T02-A.D0T03-A.D0T04-A.D0T05,0) AS DTT05,
				COALESCE(COALESCE(E.OEMJG,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.D0T01-A.D0T02-A.D0T03-A.D0T04-A.D0T05-A.D0T06,0) AS DTT06,
				COALESCE(COALESCE(E.OEMJG,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.D0T01-A.D0T02-A.D0T03-A.D0T04-A.D0T05-A.D0T06-A.D0T07,0) AS DTT07,
				COALESCE(COALESCE(E.OEMJG,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.D0T01-A.D0T02-A.D0T03-A.D0T04-A.D0T05-A.D0T06-A.D0T07-A.D0T08,0) AS DTT08,
				COALESCE(COALESCE(E.OEMJG,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.D0T01-A.D0T02-A.D0T03-A.D0T04-A.D0T05-A.D0T06-A.D0T07-A.D0T08-A.D0T09,0) AS DTT09,
				COALESCE(COALESCE(E.OEMJG,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.D0T01-A.D0T02-A.D0T03-A.D0T04-A.D0T05-A.D0T06-A.D0T07-A.D0T08-A.D0T09-A.D0T10,0) AS DTT10

			FROM 
				PSZDBLIB.SVH310PF A
				LEFT OUTER JOIN ${lib1}.BM008PR B ON A.PSPNO=B.ITNBR
				LEFT OUTER JOIN ${lib1}.CUSMAS C ON A.PYVND=C.CUSNO
				LEFT OUTER JOIN 
				(
				SELECT X.CUSNO, X.CPRTN, X.PRTNO, X.EDATM	
				FROM ${lib1}.EM000PR X 
				WHERE X.EDATM = (SELECT MAX(Y.EDATM) FROM ${lib1}.EM000PR Y WHERE X.CUSNO=Y.CUSNO AND X.PRTNO=Y.PRTNO)
				) D ON A.PYVND=D.CUSNO AND A.PSPNO=D.PRTNO
				LEFT OUTER JOIN 
				(
				SELECT PYVND,PSPNO,SUM(MKHAD+GIVQY) AS OEMJG,SUM(GIVQY) AS CULJIS FROM ${lib2}.SAL200PF WHERE COMPS = #{comps} AND MKHAD+GIVQY>0 GROUP BY PYVND,PSPNO
				) E ON A.PYVND=E.PYVND AND A.PSPNO=E.PSPNO 
				LEFT OUTER JOIN
				(
				SELECT 
					COMPS,ITNBR,
					SUM(CASE WHEN HOUSE='1' THEN MOHTQ ELSE 0 END) AS SANE,
					SUM(CASE WHEN HOUSE<![CDATA[<>]]>'1' THEN MOHTQ ELSE 0 END) AS SAWE,
					SUM(MOHTQ) AS MOHTQ
				FROM ${lib2}.BDD100PF 
				WHERE COMPS = #{comps} AND HOUSE IN (SELECT SUBSTR(MAJCD,6,1) FROM ${lib2}.MST040PF WHERE MAJCD like 'HOUSE%')
				GROUP BY COMPS,ITNBR
				) F ON A.PSPNO=F.ITNBR 
				LEFT OUTER JOIN
				(
				SELECT PYVND,PSPNO,SUM(JPSQY) JPSQY FROM ${lib2}.SMD113LF WHERE COMPS = #{comps} AND JPYYM = #{dumym} GROUP BY PYVND,PSPNO
				) G ON A.PYVND=G.PYVND AND A.PSPNO=G.PSPNO
				LEFT OUTER JOIN
				(
				SELECT PYVND,PSPNO,SUM(PRTQY) PRTQY FROM ${lib2}.FMD106LF WHERE COMPS = #{comps} AND TRYYM = #{dumym} GROUP BY PYVND,PSPNO
				) H ON A.PYVND=H.PYVND AND A.PSPNO=H.PSPNO
				LEFT OUTER JOIN
				(
				SELECT PYVND,PSPNO,SM0QY FROM ${lib2}.SPM110PF WHERE COMPS = #{comps} AND PLNYM = #{dumym}
				) I ON A.PYVND=I.PYVND AND A.PSPNO=I.PSPNO
			WHERE 
			      'SqlMap-OrderHostUpCheckList.searchByCondition' = 'SqlMap-OrderHostUpCheckList.searchByCondition'
		     <if test="comps != null and comps !='' ">	
		   	  AND A.COMPS = #{comps}	
			 </if>
		     <if test="pyvnd != null and pyvnd !='' ">	
		   	  AND A.PYVND = #{pyvnd}	
			 </if>
		     <if test="dumcb != null and dumcb !='' ">
		      AND A.DUMCB = #{dumcb}
			 </if>
			ORDER BY
				A.PYVND,A.DFACD,A.DMKCR,A.DSECD,A.PSPNO
		</if>
		
		<if test='selchk.equals("P7")'>
			SELECT 
					A.PYVND,C.CUSNM,A.DFACD,A.DMKCR,A.DSECD,A.DSENO,D.CPRTN,A.PSPNO,B.ITDSC,
					COALESCE(E.OEMJG,0) AS OEMJG,
					COALESCE(F.SANE,0) AS SANE,COALESCE(F.SAWE,0) AS SAWE,COALESCE(F.MOHTQ,0) AS MOHTQ,
					COALESCE(E.CULJIS,0) AS CULJIS,
					A.TRIMD,A.PBSQY,A.PATQY,A.WBSQY,(A.PBSQY+A.PATQY+A.WBSQY) AS PBS,
					A.DAT00,A.DAT01,A.DAT02,A.DAT03,A.DAT04,A.DAT05,A.DAT06,A.DAT07,A.DAT08,A.DAT09,A.DAT10,A.DAT11,A.DAT12,
					A.REMQY,A.OKQTY,A.MITQY,A.PRSEQ,A.MIQQY,A.MIOQY,A.GRTOT,
					COALESCE(I.SM0QY,0) AS SM0QY,COALESCE(G.JPSQY,0) AS JPSQY,COALESCE(H.PRTQY,0) AS PRTQY,
					COALESCE(F.SAWE-E.CULJIS,0) AS ILONJS,
					<if test='gubcd.equals("0")'>  <!-- Denso재고미반영 -->  
					COALESCE(COALESCE(E.OEMJG,0)-(A.PBSQY+A.PATQY+A.WBSQY),0) AS DTQ01, <!-- (OEM재고)-(대기댓수+도장댓수+비축댓수) -->
					COALESCE(COALESCE(E.OEMJG,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00,0) AS DTQ02,
					COALESCE(COALESCE(E.OEMJG,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00-A.DAT01,0) AS DTQ03,
					COALESCE(COALESCE(E.OEMJG,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00-A.DAT01-A.DAT02,0) AS DTQ04,
					COALESCE(COALESCE(E.OEMJG,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00-A.DAT01-A.DAT02-A.DAT03,0) AS DTQ05,
					COALESCE(COALESCE(E.OEMJG,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00-A.DAT01-A.DAT02-A.DAT03-A.DAT04,0) AS DTQ06,
					COALESCE(COALESCE(E.OEMJG,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00-A.DAT01-A.DAT02-A.DAT03-A.DAT04-A.DAT05,0) AS DTQ07,
					COALESCE(COALESCE(E.OEMJG,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00-A.DAT01-A.DAT02-A.DAT03-A.DAT04-A.DAT05-A.DAT06,0) AS DTQ08,
					COALESCE(COALESCE(E.OEMJG,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00-A.DAT01-A.DAT02-A.DAT03-A.DAT04-A.DAT05-A.DAT06-A.DAT07,0) AS DTQ09,
					COALESCE(COALESCE(E.OEMJG,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00-A.DAT01-A.DAT02-A.DAT03-A.DAT04-A.DAT05-A.DAT06-A.DAT07-A.DAT08,0) AS DTQ10,
					COALESCE(COALESCE(E.OEMJG,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00-A.DAT01-A.DAT02-A.DAT03-A.DAT04-A.DAT05-A.DAT06-A.DAT07-A.DAT08-A.DAT09,0) AS DTQ11,
					COALESCE(COALESCE(E.OEMJG,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00-A.DAT01-A.DAT02-A.DAT03-A.DAT04-A.DAT05-A.DAT06-A.DAT07-A.DAT08-A.DAT09-A.DAT10,0) AS DTQ12,
					COALESCE(COALESCE(E.OEMJG,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00-A.DAT01-A.DAT02-A.DAT03-A.DAT04-A.DAT05-A.DAT06-A.DAT07-A.DAT08-A.DAT09-A.DAT10-A.DAT11,0) AS DTQ13,
					COALESCE(COALESCE(E.OEMJG,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00-A.DAT01-A.DAT02-A.DAT03-A.DAT04-A.DAT05-A.DAT06-A.DAT07-A.DAT08-A.DAT09-A.DAT10-A.DAT11-A.DAT12,0) AS DTQ14,
					0 AS SILQTY
					</if>
					<if test='gubcd.equals("1")'>  <!-- 생산실적 반영 -->  
					COALESCE(COALESCE(E.OEMJG,0)+COALESCE(F.SANE,0)+COALESCE(F.SAWE,0)+COALESCE(J.SILQTY,0)-(A.PBSQY+A.PATQY+A.WBSQY),0) AS DTQ01, <!-- (OEM재고+사내재고+사외재고+생산실적)-(대기댓수+도장댓수+비축댓수) -->
					COALESCE(COALESCE(E.OEMJG,0)+COALESCE(F.SANE,0)+COALESCE(F.SAWE,0)+COALESCE(J.SILQTY,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00,0) AS DTQ02,
					COALESCE(COALESCE(E.OEMJG,0)+COALESCE(F.SANE,0)+COALESCE(F.SAWE,0)+COALESCE(J.SILQTY,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00-A.DAT01,0) AS DTQ03,
					COALESCE(COALESCE(E.OEMJG,0)+COALESCE(F.SANE,0)+COALESCE(F.SAWE,0)+COALESCE(J.SILQTY,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00-A.DAT01-A.DAT02,0) AS DTQ04,
					COALESCE(COALESCE(E.OEMJG,0)+COALESCE(F.SANE,0)+COALESCE(F.SAWE,0)+COALESCE(J.SILQTY,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00-A.DAT01-A.DAT02-A.DAT03,0) AS DTQ05,
					COALESCE(COALESCE(E.OEMJG,0)+COALESCE(F.SANE,0)+COALESCE(F.SAWE,0)+COALESCE(J.SILQTY,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00-A.DAT01-A.DAT02-A.DAT03-A.DAT04,0) AS DTQ06,
					COALESCE(COALESCE(E.OEMJG,0)+COALESCE(F.SANE,0)+COALESCE(F.SAWE,0)+COALESCE(J.SILQTY,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00-A.DAT01-A.DAT02-A.DAT03-A.DAT04-A.DAT05,0) AS DTQ07,
					COALESCE(COALESCE(E.OEMJG,0)+COALESCE(F.SANE,0)+COALESCE(F.SAWE,0)+COALESCE(J.SILQTY,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00-A.DAT01-A.DAT02-A.DAT03-A.DAT04-A.DAT05-A.DAT06,0) AS DTQ08,
					COALESCE(COALESCE(E.OEMJG,0)+COALESCE(F.SANE,0)+COALESCE(F.SAWE,0)+COALESCE(J.SILQTY,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00-A.DAT01-A.DAT02-A.DAT03-A.DAT04-A.DAT05-A.DAT06-A.DAT07,0) AS DTQ09,
					COALESCE(COALESCE(E.OEMJG,0)+COALESCE(F.SANE,0)+COALESCE(F.SAWE,0)+COALESCE(J.SILQTY,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00-A.DAT01-A.DAT02-A.DAT03-A.DAT04-A.DAT05-A.DAT06-A.DAT07-A.DAT08,0) AS DTQ10,
					COALESCE(COALESCE(E.OEMJG,0)+COALESCE(F.SANE,0)+COALESCE(F.SAWE,0)+COALESCE(J.SILQTY,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00-A.DAT01-A.DAT02-A.DAT03-A.DAT04-A.DAT05-A.DAT06-A.DAT07-A.DAT08-A.DAT09,0) AS DTQ11,
					COALESCE(COALESCE(E.OEMJG,0)+COALESCE(F.SANE,0)+COALESCE(F.SAWE,0)+COALESCE(J.SILQTY,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00-A.DAT01-A.DAT02-A.DAT03-A.DAT04-A.DAT05-A.DAT06-A.DAT07-A.DAT08-A.DAT09-A.DAT10,0) AS DTQ12,
					COALESCE(COALESCE(E.OEMJG,0)+COALESCE(F.SANE,0)+COALESCE(F.SAWE,0)+COALESCE(J.SILQTY,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00-A.DAT01-A.DAT02-A.DAT03-A.DAT04-A.DAT05-A.DAT06-A.DAT07-A.DAT08-A.DAT09-A.DAT10-A.DAT11,0) AS DTQ13,
					COALESCE(COALESCE(E.OEMJG,0)+COALESCE(F.SANE,0)+COALESCE(F.SAWE,0)+COALESCE(J.SILQTY,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00-A.DAT01-A.DAT02-A.DAT03-A.DAT04-A.DAT05-A.DAT06-A.DAT07-A.DAT08-A.DAT09-A.DAT10-A.DAT11-A.DAT12,0) AS DTQ14,
					COALESCE(J.SILQTY,0) AS SILQTY
					</if>
					<if test='gubcd.equals("2")'>  <!-- 생산실적 미반영 -->
					COALESCE(COALESCE(E.OEMJG,0)+COALESCE(F.SANE,0)+COALESCE(F.SAWE,0)-(A.PBSQY+A.PATQY+A.WBSQY),0) AS DTQ01, <!-- (OEM재고+사내재고+사외재고)-(대기댓수+도장댓수+비축댓수) -->
					COALESCE(COALESCE(E.OEMJG,0)+COALESCE(F.SANE,0)+COALESCE(F.SAWE,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00,0) AS DTQ02,
					COALESCE(COALESCE(E.OEMJG,0)+COALESCE(F.SANE,0)+COALESCE(F.SAWE,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00-A.DAT01,0) AS DTQ03,
					COALESCE(COALESCE(E.OEMJG,0)+COALESCE(F.SANE,0)+COALESCE(F.SAWE,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00-A.DAT01-A.DAT02,0) AS DTQ04,
					COALESCE(COALESCE(E.OEMJG,0)+COALESCE(F.SANE,0)+COALESCE(F.SAWE,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00-A.DAT01-A.DAT02-A.DAT03,0) AS DTQ05,
					COALESCE(COALESCE(E.OEMJG,0)+COALESCE(F.SANE,0)+COALESCE(F.SAWE,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00-A.DAT01-A.DAT02-A.DAT03-A.DAT04,0) AS DTQ06,
					COALESCE(COALESCE(E.OEMJG,0)+COALESCE(F.SANE,0)+COALESCE(F.SAWE,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00-A.DAT01-A.DAT02-A.DAT03-A.DAT04-A.DAT05,0) AS DTQ07,
					COALESCE(COALESCE(E.OEMJG,0)+COALESCE(F.SANE,0)+COALESCE(F.SAWE,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00-A.DAT01-A.DAT02-A.DAT03-A.DAT04-A.DAT05-A.DAT06,0) AS DTQ08,
					COALESCE(COALESCE(E.OEMJG,0)+COALESCE(F.SANE,0)+COALESCE(F.SAWE,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00-A.DAT01-A.DAT02-A.DAT03-A.DAT04-A.DAT05-A.DAT06-A.DAT07,0) AS DTQ09,
					COALESCE(COALESCE(E.OEMJG,0)+COALESCE(F.SANE,0)+COALESCE(F.SAWE,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00-A.DAT01-A.DAT02-A.DAT03-A.DAT04-A.DAT05-A.DAT06-A.DAT07-A.DAT08,0) AS DTQ10,
					COALESCE(COALESCE(E.OEMJG,0)+COALESCE(F.SANE,0)+COALESCE(F.SAWE,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00-A.DAT01-A.DAT02-A.DAT03-A.DAT04-A.DAT05-A.DAT06-A.DAT07-A.DAT08-A.DAT09,0) AS DTQ11,
					COALESCE(COALESCE(E.OEMJG,0)+COALESCE(F.SANE,0)+COALESCE(F.SAWE,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00-A.DAT01-A.DAT02-A.DAT03-A.DAT04-A.DAT05-A.DAT06-A.DAT07-A.DAT08-A.DAT09-A.DAT10,0) AS DTQ12,
					COALESCE(COALESCE(E.OEMJG,0)+COALESCE(F.SANE,0)+COALESCE(F.SAWE,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00-A.DAT01-A.DAT02-A.DAT03-A.DAT04-A.DAT05-A.DAT06-A.DAT07-A.DAT08-A.DAT09-A.DAT10-A.DAT11,0) AS DTQ13,
					COALESCE(COALESCE(E.OEMJG,0)+COALESCE(F.SANE,0)+COALESCE(F.SAWE,0)-(A.PBSQY+A.PATQY+A.WBSQY)-A.DAT00-A.DAT01-A.DAT02-A.DAT03-A.DAT04-A.DAT05-A.DAT06-A.DAT07-A.DAT08-A.DAT09-A.DAT10-A.DAT11-A.DAT12,0) AS DTQ14,
					0 AS SILQTY
					</if>
			FROM 
				PSZDBLIB.SVH320PF A
				LEFT OUTER JOIN ${lib1}.BM008PR B ON A.PSPNO=B.ITNBR
				LEFT OUTER JOIN ${lib1}.CUSMAS C ON A.PYVND=C.CUSNO
				LEFT OUTER JOIN 
				(
				SELECT X.CUSNO, X.CPRTN, X.PRTNO, X.EDATM	
				FROM ${lib1}.EM000PR X 
				WHERE X.EDATM = (SELECT MAX(Y.EDATM) FROM ${lib1}.EM000PR Y WHERE X.CUSNO=Y.CUSNO AND X.PRTNO=Y.PRTNO)
				) D ON A.PYVND=D.CUSNO AND A.PSPNO=D.PRTNO
				LEFT OUTER JOIN 
				(
				SELECT PYVND,PSPNO,SUM(MKHAD+GIVQY) AS OEMJG,SUM(GIVQY) AS CULJIS FROM ${lib2}.SAL200PF WHERE COMPS = #{comps} AND MKHAD+GIVQY>0 GROUP BY PYVND,PSPNO
				) E ON A.PYVND=E.PYVND AND A.PSPNO=E.PSPNO 
				LEFT OUTER JOIN
				(
				SELECT 
					COMPS,ITNBR,
					SUM(CASE WHEN HOUSE='1' THEN MOHTQ ELSE 0 END) AS SANE,
					SUM(CASE WHEN HOUSE<![CDATA[<>]]>'1' THEN MOHTQ ELSE 0 END) AS SAWE,
					SUM(MOHTQ) AS MOHTQ
				FROM ${lib2}.BDD100PF 
				WHERE COMPS = #{comps} AND HOUSE IN (SELECT SUBSTR(MAJCD,6,1) FROM ${lib2}.MST040PF WHERE MAJCD like 'HOUSE%')
				GROUP BY COMPS,ITNBR
				) F ON A.PSPNO=F.ITNBR 
				LEFT OUTER JOIN
				(
				SELECT PYVND,PSPNO,SUM(JPSQY) JPSQY FROM ${lib2}.SMD113LF WHERE COMPS = #{comps} AND JPYYM = #{dumym} GROUP BY PYVND,PSPNO
				) G ON A.PYVND=G.PYVND AND A.PSPNO=G.PSPNO
				LEFT OUTER JOIN
				(
				SELECT PYVND,PSPNO,SUM(PRTQY) PRTQY FROM ${lib2}.FMD106LF WHERE COMPS = #{comps} AND TRYYM = #{dumym} GROUP BY PYVND,PSPNO
				) H ON A.PYVND=H.PYVND AND A.PSPNO=H.PSPNO
				LEFT OUTER JOIN
				(
				SELECT PYVND,PSPNO,SM0QY FROM ${lib2}.SPM110PF WHERE COMPS = #{comps} AND PLNYM = #{dumym}
				) I ON A.PYVND=I.PYVND AND A.PSPNO=I.PSPNO
				<if test='gubcd.equals("1")'> <!-- 생산실적 반영 -->
				LEFT OUTER JOIN
				(
				SELECT
					X.PRTNO,
					SUM(CASE WHEN X.TRCOD = 'IS41' THEN X.TRQTY*-1
								WHEN X.TRCOD <![CDATA[<>]]>'IS41' THEN X.TRQTY
								ELSE 0
						 END) AS SILQTY
				FROM
					(SELECT 
						A.PRTNO,SUBSTR(A.SLPNO,1,3) AS SLP,A.QTYCD,
						CASE 
							WHEN B.ITTYP='9' AND A.TCODE='IS' AND A.TRNNO='41' AND C.VNDNR<![CDATA[<>]]>'' <!-- 자재불량처리 -->
								THEN 'IS41'
							WHEN A.TCODE='RC' AND A.TRNNO='06' <!-- 생산실적 -->
								THEN 'RC06'
							WHEN B.ITTYP='9' AND A.TCODE='RP' AND A.TRNNO='01' <!-- A PART 자재입고 -->
								THEN 'RP01' 
							WHEN B.ITTYP='9' AND A.TCODE='RC' AND A.TRNNO='02' <!-- A PART 자재검사 -->
								THEN 'RC02' 
							ELSE 'ZZZZ' 
						END TRCOD,
						A.TRQTY 
					FROM 
						${lib1}.HD020LR4 A 
						LEFT OUTER JOIN ${lib1}.BM008PR B ON A.PRTNO=B.ITNBR
						LEFT OUTER JOIN ${lib1}.VENNAM C ON SUBSTR(A.SLPNO,1,3)=C.VNDNR
					WHERE
						((A.TCODE = 'RC' AND A.TRNNO = '02') OR (A.TCODE = 'RP' AND A.TRNNO = '01') OR (A.TCODE = 'RC' AND A.TRNNO = '06') OR (A.TCODE = 'IS' AND A.TRNNO = '41'))
						<!-- RP 01: 자재입고             RC 02:자재검사결과          RC 06:생산실적          IS 41:양품반납 -->
						AND A.TRNDT = #{dumcb}
					)X 
				WHERE
					X.TRCOD <![CDATA[<>]]> 'ZZZZ'
				GROUP BY
					X.PRTNO
				) J ON A.PSPNO=J.PRTNO
				</if>
			WHERE
			      'SqlMap-OrderHostUpCheckList.searchByCondition' = 'SqlMap-OrderHostUpCheckList.searchByCondition'
		     <if test="comps != null and comps !='' ">	
		   	  AND A.COMPS = #{comps}	
			 </if>
		     <if test="pyvnd != null and pyvnd !='' ">	
		   	  AND A.PYVND = #{pyvnd}	
			 </if>
		     <if test="dumcb != null and dumcb !='' ">
		      AND A.DUMCB = #{dumcb}
			 </if>
			ORDER BY
				A.PYVND,A.DFACD,A.DMKCR,A.DSECD,A.PSPNO
		</if>	
    </select>

</mapper>