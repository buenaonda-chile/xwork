<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.globaldenso.dicas.business.dao.PhenomenonDao">

  <resultMap id="codeMap" type="com.globaldenso.dicas.business.dto.PhenomenonDto">
		<id property="id" column="ID" javaType="java.lang.Long" />
		<result property="vinno" column="VINNO" javaType="java.lang.String" />
		<result property="manageNo" column="MANAGE_NO" javaType="java.lang.String" />
		<result property="serviceDegree" column="SERVICE_DEGREE" javaType="java.lang.Long" />
		<result property="phenomenonDegree" column="PHENOMENON_DEGREE" javaType="java.lang.Long" />
		<result property="mainCategory" column="MAIN_CATEGORY" javaType="java.lang.String" />
		<result property="smallCategory" column="SMALL_CATEGORY" javaType="java.lang.String" />
		<result property="div" column="DIV" javaType="java.lang.String" />
		<result property="autoinsert" column="AUTOINSERT" javaType="java.sql.Date" />
		<result property="masterState" column="MASTER_STATE" javaType="java.lang.String" />
		<result property="rgstrId" column="RGSTR_ID" javaType="java.lang.Long" />
		<result property="rgstDt" column="RGST_DT" javaType="java.time.LocalDateTime" />
		<result property="updtrId" column="UPDTR_ID" javaType="java.lang.Long" />
		<result property="updtDt" column="UPDT_DT" javaType="java.time.LocalDateTime" />
		<result property="cateChkYn" column="CATE_CHK_YN" javaType="java.lang.String" />
		<result property="cateSubTranYn" column="CATE_SUB_TRAN_YN" javaType="java.lang.String" />
		<result property="mainCategoryNm" column="MAIN_CATEGORY_NM" javaType="java.lang.String" />
		<result property="smallCategoryNm" column="SMALL_CATEGORY_NM" javaType="java.lang.String" />

  </resultMap>

  <sql id="select_01">

    SELECT
		ID
		,VINNO
		,MANAGE_NO
		,SERVICE_DEGREE
		,PHENOMENON_DEGREE
		,MAIN_CATEGORY
        ,(SELECT B.MAIN_CATEGORY_NM FROM TB_BA_MAIN_CATEGORY B WHERE B.MAIN_CATEGORY = A.MAIN_CATEGORY) AS MAIN_CATEGORY_NM
		,SMALL_CATEGORY
		,(SELECT B.SMALL_CATEGORY_NM FROM TB_BA_SUB_CATEGORY B WHERE B.SMALL_CATEGORY = A.SMALL_CATEGORY) AS SMALL_CATEGORY_NM
        ,DIV
		,AUTOINSERT
		,MASTER_STATE
		,RGSTR_ID
		,RGST_DT
		,UPDTR_ID
		,UPDT_DT
		,CATE_CHK_YN
		,CATE_SUB_TRAN_YN

    FROM TB_DC_PHENOMENON_MASTER A

  </sql>

  <sql id="where_01">

	  <if test="criteria.manageNo != null and criteria.manageNo != ''">
		  AND MANAGE_NO = #{criteria.manageNo}
	  </if>

  </sql>

  <!-- ?? SQL?????? -->
  <select id="searchByKey" resultMap="codeMap" parameterType="com.globaldenso.dicas.business.domain.PhenomenonDomain">

    SELECT *
    FROM (
    <include refid="select_01"/>
    ) AA
    WHERE AA.ID = #{id}

  </select>

  <select id="searchByCondition" resultMap="codeMap" parameterType="Map">

    SELECT *
    FROM (
         SELECT ROWNUM AS RN, A.*
          FROM (
          <include refid="select_01" />
          <where>
            <include refid="where_01"/>
          </where>
          ) A
          ORDER BY A.ID
     ) AA

    <if test="pageable != null">
      WHERE RN BETWEEN ((${pageable.pageNumber} - 1) * ${pageable.pageSize}) + 1 AND ${pageable.offset}
    </if>
    ORDER BY RN

  </select>

   <select id="searchCount" resultType="int" parameterType="Map">

    SELECT COUNT(ID) AS CNT
    FROM (
      <include refid="select_01" />
      <where>
        <include refid="where_01"/>
      </where>
     ) AA

  </select>

  <insert id="create" parameterType="com.globaldenso.dicas.business.domain.PhenomenonDomain">

    INSERT INTO TB_DC_PHENOMENON_MASTER (
		ID
		,VINNO
		,MANAGE_NO
		,SERVICE_DEGREE
		,PHENOMENON_DEGREE
		,MAIN_CATEGORY
		,SMALL_CATEGORY
		,DIV
		,AUTOINSERT
		,MASTER_STATE
		,RGSTR_ID
		,RGST_DT
		,UPDTR_ID
		,UPDT_DT
		,CATE_CHK_YN
		,CATE_SUB_TRAN_YN

    ) VALUES (
		#{id}
		,UPPER(#{vinno})
		,#{manageNo}
		,#{serviceDegree}
		,#{phenomenonDegree}
		,#{mainCategory}
		,#{smallCategory}
		,#{div}
		,#{autoinsert}
		,#{masterState}
		,#{rgstrId}
		,#{rgstDt}
		,#{updtrId}
		,#{updtDt}
		,#{cateChkYn}
		,#{cateSubTranYn}

    )

    <selectKey resultType="long" keyProperty="id" order="BEFORE">
      SELECT SEQ_TB_DC_PHENOMENON_MASTER.NEXTVAL FROM DUAL
    </selectKey>

  </insert>

  <update id="update" parameterType="com.globaldenso.dicas.business.domain.PhenomenonDomain">

    UPDATE TB_DC_PHENOMENON_MASTER SET
		VINNO = UPPER(#{vinno})
		,MANAGE_NO = #{manageNo}
		,SERVICE_DEGREE = #{serviceDegree}
		,PHENOMENON_DEGREE = #{phenomenonDegree}
		,MAIN_CATEGORY = #{mainCategory}
		,SMALL_CATEGORY = #{smallCategory}
		,DIV = #{div}
		,AUTOINSERT = #{autoinsert}
		,MASTER_STATE = #{masterState}
		,UPDTR_ID = #{updtrId}
		,UPDT_DT = #{updtDt}
		,CATE_CHK_YN = #{cateChkYn}
		,CATE_SUB_TRAN_YN = #{cateSubTranYn}

    WHERE ID = #{id}

  </update>

  <delete id="delete" parameterType="com.globaldenso.dicas.business.domain.PhenomenonDomain">

    DELETE FROM TB_DC_PHENOMENON_MASTER
    WHERE ID = #{id}

  </delete>


</mapper>
